add_namespace = xian

#inspect xian
country_event = {
	id = xian.1
	title = xian.1.t
	desc = {
		text = xian.1.d
		trigger = {
			has_global_flag = KMT_zxl_stopped_attack
		}
	}
	desc = {
		text = xian.1.d_2
		trigger = {
			NOT = { has_global_flag = KMT_zxl_stopped_attack }
		}
	}
	picture = GFX_report_event_chinese_soldiers_02

	trigger = {
		tag = event_target:KMT_central_gov_tag
		OR = {
			has_country_flag = {
				flag = KMT_chiang_vowed_to_destroy_commies
				days > 50
			}
			date > 1936.12.10
		}
		NOT = { has_completed_focus = KMT_external_defense }
		ZXL = {
			exists = yes
			is_subject_of = ROOT
			is_neighbor_of = PRC
			has_cosmetic_tag = NWBSHQ
		}
	}
	
	fire_only_once = yes
	
	immediate = { set_global_flag = KMT_xian1_fired }
	
	mean_time_to_happen = { 
		days = 30 
		
		modifier = {
			factor = 0.1
			date > 1936.12.10
		}
		
		modifier = {
			factor = 0
			event_target:KMT_central_gov_tag = {
				focus_progress = {
					focus = KMT_strike_PRC
					progress > 0.7
				}
			}
		}
	}
	
	option = {
		ai_chance = { base = 100 }
		name = xian.1.a
		custom_effect_tooltip = KMT_will_force_zxl_to_launch_attack_tt
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			ZXL = {
				country_event = { id = xian.2 }
				activate_mission = KMT_all_out_assault
				set_country_flag = KMT_zxl_arrest_flag
			}
		}
	}
	
	option = {
		name = xian.1.b
		add_political_power = -300
		add_stability = -0.1
	}
}

#inspect xian
country_event = {
	id = xian.2
	title = xian.2.t
	desc = xian.2.d
	picture = GFX_report_event_chinese_soldiers_02

	is_triggered_only = yes
	
	option = {
		name = xian.2.a
		effect_tooltip = { activate_mission = KMT_all_out_assault }
	}
}

#Chiang held hostage
country_event = {
	id = xian.3
	title = xian.3.t
	desc = xian.3.d
	picture = GFX_report_event_dead_soldiers

	is_triggered_only = yes
	
	trigger = {
		event_target:KMT_central_gov_tag = {
			NOT = {
				has_country_flag = KMT_pro_japanese_coup
				has_country_flag = KMT_red_coup_finish
			}
		}
	}
	
	immediate = {
		every_unit_leader = {
			limit = { 
				OR = {
					has_id = 1001
					has_id = 1018
					has_id = 2103
					has_id = 2107
					has_id = 1061
				}
			}
			add_unit_leader_trait = KMT_held_hostage
		}
	}
	
	option = {
		ai_chance = { factor = 100 }
		name = xian.3.a
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			ZXL = { country_event = { id = xian.4 }}
			if = {
				limit = {
					PRC = {
						has_war_with = event_target:KMT_central_gov_tag
					}
				}
				622 = {
					set_demilitarized_zone = yes
				}
			}
			set_global_flag = xian_incident
			activate_mission = KMT_xian_incident_negotiate_mission
			ZXL = { activate_mission = KMT_xian_incident_negotiate_mission_zxl }
		}
	}
	
	option = {
		name = xian.3.b
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			ZXL = { country_event = { id = xian.5 }}
			end_puppet = ZXL
			declare_war_on = {
				target = ZXL
				type = take_core_state
			}
		}
	}
	
	option = {
		name = xian.3.c
		trigger = {
			focus_progress = {
				focus = KMT_support_pro_japanese_faction
				progress > 0
			}
			NOT = {
				has_completed_focus = KMT_support_pro_japanese_faction
				has_country_flag = KMT_pro_japanese_coup
			}
		}
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			if = {
				limit = {
					OR = {
						NOT = {
							focus_progress = {
								focus = KMT_support_pro_japanese_faction
								progress > 0
							}
						}
						has_completed_focus = KMT_support_pro_japanese_faction
					}
				}
			}else = {
				set_country_flag = KMT_xian_CHI_kill_chiang
				set_global_flag = cks_killed_xian
				custom_effect_tooltip = KMT_xian_choose_to_kill_chiang_tt
				hidden_effect = {
					random_country = {
						limit = {
							any_unit_leader = {
								has_trait = KMT_held_hostage
							}
						}
						every_unit_leader = {
							limit = {
								has_trait = KMT_held_hostage
							}
							remove_unit_leader_trait = KMT_held_hostage
						}
					}
					KMT_pro_jap_finish = yes
				}
			}
		}
	}
	
	option = { 
		name = xian.3.c
		trigger = {
			has_global_flag = KMT_finished_a_communist_focus
			NOT = {
				has_government = communism
				has_country_flag = KMT_red_coup_finish
			}
		}
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			set_country_flag = KMT_xian_CHI_kill_chiang
			set_global_flag = cks_killed_xian
			custom_effect_tooltip = KMT_xian_choose_to_kill_chiang_commie_tt
			set_global_flag = KMT_bypass_some_commie_focus
			hidden_effect = {
				random_country = {
					limit = {
						any_unit_leader = {
							has_trait = KMT_held_hostage
						}
					}
					every_unit_leader = {
						limit = {
							has_trait = KMT_held_hostage
						}
						remove_unit_leader_trait = KMT_held_hostage
					}
				}
			}
			KMT_red_coup_effect = yes
		}
	}
}

#Chiang held hostage
country_event = {
	id = xian.4
	title = xian.4.t
	desc = xian.4.d
	picture = GFX_report_event_china_politicians_captured

	is_triggered_only = yes
	
	trigger = {
		event_target:KMT_central_gov_tag = {
			NOT = {
				has_country_flag = KMT_pro_japanese_coup
				has_country_flag = KMT_red_coup_finish
			}
		}
	}
	
	immediate = {
		ZXL = {
			custom_effect_tooltip = KMT_will_release_chiang_tt
		}
		event_target:KMT_central_gov_tag = {
			custom_effect_tooltip = KMT_will_stop_civil_war_tt
		}
	}
	
	option = {
		ai_chance = { factor = 100 }
		name = xian.4.a
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			event_target:KMT_central_gov_tag = {
				country_event = { id = xian.100 days = 10 }
			}
			set_global_flag = KMT_chi_stop_civil_war_demand
			set_global_flag = KMT_zxl_release_chiang_demand
		}
	}
}

#event_target:KMT_central_gov_tag launches offensive
country_event = {
	id = xian.5
	title = xian.5.t
	desc = xian.5.d
	picture = GFX_report_event_chinese_soldiers_fighting

	is_triggered_only = yes
	
	trigger = {
		event_target:KMT_central_gov_tag = {
			NOT = {
				has_country_flag = KMT_pro_japanese_coup
				has_country_flag = KMT_red_coup_finish
			}
		}
	}
	
	option = {
		ai_chance = { factor = 1 }
		name = xian.5.a
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			effect_tooltip = {
				FROM = {
					declare_war_on = {
						target = ROOT
						type = take_core_state
					}
				}
			}
		}
	}
	
	option = {
		ai_chance = { factor = 99 }
		custom_effect_tooltip = KMT_civil_war_tt
		name = xian.2.c
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			add_political_power = -300
			event_target:KMT_central_gov_tag = {
				effect_tooltip = {
					kill_country_leader = yes
				}
				end_puppet = ROOT
				country_event = { id = xian.14 }
			}
			effect_tooltip = {
				FROM = {
					declare_war_on = {
						target = ROOT
						type = take_core_state
					}
				}
			}
		}
	}
}

#SOV reaction
country_event = {
	id = xian.6
	title = xian.6.t
	desc = xian.6.d
	picture = GFX_report_event_china_politicians_captured

	is_triggered_only = yes
	
	option = {
		ai_chance = { factor = 100 }
		name = xian.6.a
		add_opinion_modifier = {
			target = ZXL
			modifier = KMT_xian_incident_sov_neg
		}
		add_opinion_modifier = {
			target = ZXL
			modifier = KMT_xian_incident_sov_neg_trade
		}
		ZXL = {
			country_event = { id = xian.8 hours = 5 }
		}
	}
	
	option = {
		name = xian.6.b
		add_opinion_modifier = {
			target = ZXL
			modifier = KMT_xian_incident_sov_pos
		}
		add_opinion_modifier = {
			target = ZXL
			modifier = KMT_xian_incident_sov_pos_trade
		}
		ZXL = {
			country_event = { id = xian.9 hours = 5 }
		}
	}
}

#PRC reaction
country_event = {
	id = xian.7
	title = xian.6.t
	desc = xian.7.d
	picture = GFX_report_event_china_politicians_captured

	is_triggered_only = yes
	
	option = {
		name = xian.7.a
		custom_effect_tooltip = PRC_xian_tt
	}
}

#SOV dislike
country_event = {
	id = xian.8
	title = xian.8.t
	desc = xian.8.d
	picture = GFX_report_event_stalin_01

	is_triggered_only = yes
	
	option = {
		name = xian.8.a
		effect_tooltip = {
			SOV = {
				add_opinion_modifier = {
					target = ZXL
					modifier = KMT_xian_incident_sov_neg
				}
				add_opinion_modifier = {
					target = ZXL
					modifier = KMT_xian_incident_sov_neg_trade
				}
			}
		}
	}
}

#SOV ik
country_event = {
	id = xian.9
	title = xian.9.t
	desc = xian.9.d
	picture = GFX_report_event_stalin_01

	is_triggered_only = yes
	
	option = {
		name = xian.9.a
		effect_tooltip = {
			SOV = {
				add_opinion_modifier = {
					target = ZXL
					modifier = KMT_xian_incident_sov_pos
				}
				add_opinion_modifier = {
					target = ZXL
					modifier = KMT_xian_incident_sov_pos_trade
				}
			}
		}
	}
}

#ZXL failed
country_event = {
	id = xian.10
	title = xian.10.t
	desc = xian.10.d
	picture = GFX_report_event_chinese_soldiers_fighting

	trigger = {
		event_target:KMT_central_gov_tag = {
			NOT = {
				has_country_flag = KMT_pro_japanese_coup
				has_country_flag = KMT_red_coup_finish
			}
		}
		tag = ZXL
		has_country_flag = {
			flag = ZXL_restart_war
			days > 90
		}
	}
	
	mean_time_to_happen = { days = 3 }
	
	fire_only_once = yes
	
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					event_target:KMT_central_gov_tag = {
						NOT = {
							has_country_flag = KMT_pro_japanese_coup
							has_country_flag = KMT_red_coup_finish
						}
					}
				}
				event_target:KMT_central_gov_tag = {
					country_event = { id = xian.11 hours = 1 }
				}
			}
		}
	}
	
	option = {
		name = xian.10.a
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			effect_tooltip = {
				event_target:KMT_central_gov_tag = {
					annex_country = {
						target = ROOT
						transfer_troops = yes
					}
					declare_war_on = {
						target = PRC
						type = civil_war
					}
				}
			}
		}
	}
}

#ZXL failed
country_event = {
	id = xian.11
	title = xian.11.t
	desc = xian.11.d
	picture = GFX_report_event_chinese_soldiers_fighting

	is_triggered_only = yes
	
	trigger = {
		event_target:KMT_central_gov_tag = {
			NOT = {
				has_country_flag = KMT_pro_japanese_coup
				has_country_flag = KMT_red_coup_finish
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			hidden_effect = {
				annex_country = {
					target = ZXL
					transfer_troops = yes
				}
				declare_war_on = {
					target = PRC
					type = civil_war
				}
			}
		}
	}
	
	option = {
		name = xian.10.a
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			effect_tooltip = {
				annex_country = {
					target = ZXL
					transfer_troops = yes
				}
				declare_war_on = {
					target = PRC
					type = civil_war
				}
			}
		}
	}
}

#arrest Zhang?
country_event = {
	id = xian.12
	title = xian.12.t
	desc = xian.12.d
	picture = GFX_report_event_china_politicians_captured

	trigger = {
		event_target:KMT_central_gov_tag = {
			NOT = {
				has_country_flag = KMT_pro_japanese_coup
				has_country_flag = KMT_red_coup_finish
			}
		}
		NOT = { has_global_flag = KMT_chi_no_prosecution_demand }
		has_global_flag = xian_resolved
		tag = event_target:KMT_central_gov_tag
		country_exists = ZXL
	}
	
	mean_time_to_happen = { days = 3 }
	
	fire_only_once = yes
	
	option = {
		ai_chance = {
			factor = 100
		}
		name = xian.12.a
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			ZXL = {
				hidden_effect = {
					ZXL_zhang_xueliang = { set_nationality = ZZZ }
					ZXL_yang_hucheng = { set_nationality = ZZZ }
				}
				effect_tooltip = { retire_country_leader = yes }
			}
			add_political_power = 75
			set_global_flag = zxl_arrested
			if = {
				limit = {
					ZXL = { is_ai = yes }
				}
				hidden_effect = {
					ZXL = { 
						every_unit_leader = { set_character_flag = KMT_temp_sn_flag }
						every_character = { 
							limit = { has_character_flag = KMT_temp_sn_flag }
							set_nationality = CHI 
						}
					}
					event_target:KMT_central_gov_tag = {
						set_country_flag = zxl_sumitted
					}
				}
				annex_country = {
					target = ZXL
					transfer_troops = yes
				}
			}
		}
	}
	
	option = {
		name = xian.12.b
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			add_stability = 0.05
		}
	}
}

#chiang back
country_event = {
	id = xian.13
	title = xian.13.t
	desc = xian.13.d
	picture = GFX_report_event_china_politicians_captured
	
	trigger = {
		event_target:KMT_central_gov_tag = {
			NOT = {
				has_country_flag = KMT_pro_japanese_coup
				has_country_flag = KMT_red_coup_finish
			}
		}
		tag = event_target:KMT_central_gov_tag
		ZXL = {
			OR = {
				exists = no
				has_capitulated = yes
			}
		}
		has_global_flag = cks_held
		NOT = {
			has_global_flag = cks_killed_xian
			has_global_flag = xian_zxl_won
		}
	}
	
	mean_time_to_happen = { days = 3 }
	
	immediate = {
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			every_unit_leader = {
				limit = {
					has_trait = KMT_held_hostage
				}
				remove_unit_leader_trait = KMT_held_hostage
			}
			clr_global_flag = cks_held
		}
		hidden_effect = {
			news_event = { id = kns.25 }
		}
	}
	
	option = {
		name = xian.13.a
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			custom_effect_tooltip = KMT_chiang_returns_tt
		}
	}
}

#chiang killed
country_event = {
	id = xian.14
	title = xian.14.t
	desc = xian.14.d
	picture = GFX_report_event_china_politicians_captured

	is_triggered_only = yes
	
	trigger = {
		event_target:KMT_central_gov_tag = {
			NOT = {
				has_country_flag = KMT_pro_japanese_coup
				has_country_flag = KMT_red_coup_finish
			}
		}
	}
	
	immediate = {
		set_global_flag = cks_killed_xian
		clr_global_flag = cks_held
		hidden_effect = {
			if = {
				limit = {
					event_target:KMT_central_gov_tag = {
						NOT = {
							has_country_flag = KMT_pro_japanese_coup
							has_country_flag = KMT_red_coup_finish
						}
					}
				}
				dismantle_faction = yes
				every_country = {
					limit = {
						is_puppet_of = ROOT
					}
					ROOT = {
						end_puppet = PREV
					}
				}
				MEN = {
					set_cosmetic_tag = MMGmen
				}
				set_global_flag = xian_civil_war
				kill_country_leader = yes
				every_unit_leader = {
					limit = {
						has_trait = KMT_held_hostage
					}
					custom_effect_tooltip = KMT_will_be_killed_tt
				}
				every_unit_leader = {
					limit = {
						has_trait = KMT_held_hostage
					}
					set_character_flag = KMT_temp_sn_flag
					set_nationality = ZZZ 
				}
				every_character = {
					limit = { has_character_flag = KMT_temp_sn_flag }
					retire = yes
					clr_character_flag = KMT_temp_sn_flag
				}
				news_event = { id = kns.26 }
			}
		}
	}
	
	option = {
		name = xian.14.a	#support wang jingwei
		ai_chance = { factor = 100 }
		trigger = {
			NOT = {
				has_government = communism
				has_global_flag = KMT_finished_a_communist_focus
				has_government = communism
				has_country_flag = KMT_red_coup_finish
			}
		}
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			hidden_effect = {
				retire_character = CHI_chiang_kaishek
			}
			if = {
				limit = { focus_progress = { focus = KMT_support_pro_japanese_faction progress > 0 }}
				set_politics = { ruling_party = fascism }
				set_party_name = { ideology = fascism long_name = KMT_kmt_party_name name = KMT_kmt_party_name }
				CHI_wang_jingwei = { promote_character = { ideology = pan_asianism }}
			}else = {
				CHI_wang_jingwei = { promote_character = { ideology = the_peoples_tutelage }}
				CHI_wang_jingwei = { promote_character = { ideology = constitutionalism }}
			}
			hidden_effect = {
				if = {
					limit = {
						has_idea = KMT_pro_jap_propaganda
					}
					remove_ideas = KMT_pro_jap_propaganda
				}
				if = {
					limit = {
						has_idea = KMT_pro_jap_propaganda_2
					}
					remove_ideas = KMT_pro_jap_propaganda_2
				}
				#country_event = { id = loop.1 }
				start_civil_war = {
					ideology = neutrality
					size = 0.5
					every_unit_leader = {
						set_character_flag = KMT_temp_sn_flag
						set_nationality = HYQ
					}
					every_character = {
						limit = { has_character_flag = KMT_temp_sn_flag }
						set_nationality = HYQ
						clr_character_flag = KMT_temp_sn_flag
					}
					HYQ = {
						annex_country = { 
							target = PREV 
							transfer_troops = yes
						}
					}
				}
				every_character = { 
					limit = { has_character_flag = KMT_hyq_flag }
					set_nationality = HYQ 
				}
				if = { limit = { has_character = CHI_he_yingqin } CHI_he_yingqin = { set_nationality = HYQ }}
				division_template = {
					name = "Luchün Shih"			
					regiments = {
						infantry = { x = 0 y = 0 }
						infantry = { x = 0 y = 1 }
						infantry = { x = 1 y = 0 }
						infantry = { x = 1 y = 1 }
						infantry = { x = 2 y = 0 }
						infantry = { x = 2 y = 1 }
						infantry = { x = 3 y = 0 }
						infantry = { x = 3 y = 1 }
					}
				}
				every_state = {
					limit = {
						owner = { tag = ROOT }
					}
					create_unit = { 
						division = "name = \"Lin-shih Pu-tui\" division_template = \"Luchün Shih\" start_experience_factor = 0.4" 
						owner = ROOT
					}
				}
				CHI = { CHI_he_yingqin = { set_nationality = HYQ }}
				HYQ = {
					set_politics = { ruling_party = neutrality }
					set_party_name = { ideology = neutrality long_name = KMT_hyq name = KMT_hyq }
					add_popularity = { ideology = neutrality popularity = 0.75 }
					CHI_he_yingqin = { promote_character = { ideology = the_peoples_tutelage }}
					division_template = {
						name = "Luchün Shih"			

						regiments = {
							infantry = { x = 0 y = 0 }
							infantry = { x = 0 y = 1 }
							infantry = { x = 0 y = 2 }
							infantry = { x = 1 y = 0 }
							infantry = { x = 1 y = 1 }
							infantry = { x = 1 y = 2 }
						}
						support = {
							engineer = { x = 0 y = 0 } 
							recon = { x = 0 y = 1 }  
						}
					}
					set_equipment_fraction = 1.12
					add_popularity = {
						ideology = neutrality
						popularity = 1
					}
#						every_unit_leader = {
#							limit = { 
#								OR = {
#									has_id = 1002
#									has_id = 1003
#									has_id = 1004
#									has_id = 1005
#									has_id = 1006
#									has_id = 1007
#									has_id = 1008
#									has_id = 1009
#									has_id = 1010
#									has_id = 1011
#									has_id = 1012
#									has_id = 1013
#									has_id = 1014
#									has_id = 1015
#									has_id = 1018
#									has_id = 1020
#									has_id = 1021
#									has_id = 1022
#									has_id = 1023
#									has_id = 1024
#								}
#							}
#							set_nationality = ROOT
#							set_character_flag = KMT_temp_sn_flag
#						}
#						every_character = {
#							limit = { has_character_flag = KMT_temp_sn_flag }
#							set_nationality = ROOT
#							clr_character_flag = KMT_temp_sn_flag
#						}
				}
				every_state = {
					limit = {
						owner = { tag = HYQ }
					}
					create_unit = { 
						division = "name = \"Ho Ying-chin Bu\" division_template = \"Luchün Shih\" start_experience_factor = 0.3" 
						owner = HYQ
					}
					create_unit = { 
						division = "name = \"Ho Ying-chin Bu\" division_template = \"Luchün Shih\" start_experience_factor = 0.3" 
						owner = HYQ
					}
				}
				HYQ = {
					declare_war_on = {	
						target = ROOT
						type = civil_war
					}
				}
				hidden_effect = {
					if = { limit = { CHI = { has_character = CHI_he_yingqin }} CHI = { CHI_he_yingqin = { set_nationality = HYQ }}}
					HYQ = { CHI_he_yingqin = { promote_character = { ideology = the_peoples_tutelage }}}
				}
			}
			every_state = {
				limit = {
					is_claimed_by = event_target:KMT_central_gov_tag
				}
				add_claim_by = HYQ
			}
			every_state = {
				limit = {
					is_core_of = event_target:KMT_central_gov_tag
				}
				add_core_of = HYQ
			}
			#every_state = {
			#	limit = { 
			#		is_owned_by = HYQ 
			#		is_core_of = event_target:KMT_central_gov_tag
			#	}
			#	remove_core_of = event_target:KMT_central_gov_tag
			#	add_claim_by = event_target:KMT_central_gov_tag
			#}
			hidden_effect = {
				#if = {
				#	limit = {
				#		PRC = { 
				#			exists = yes
				#			NOT = {
				#				has_war_together_with = event_target:KMT_central_gov_tag
				#				has_war_together_with = HYQ
				#				is_in_faction_with = event_target:KMT_central_gov_tag
				#				is_in_faction_with = HYQ
				#				has_war_with = event_target:KMT_central_gov_tag
				#				has_war_with = HYQ
				#			}
				#		}
				#	}
				#	PRC = { country_event = { id = xian.15 hours = 5 }}
				#}
				if = {
					limit = {
						JAP = {
							exists = yes
							NOT = {
								has_war_together_with = event_target:KMT_central_gov_tag
								has_war_together_with = HYQ
								is_in_faction_with = event_target:KMT_central_gov_tag
								is_in_faction_with = HYQ
								has_war_with = event_target:KMT_central_gov_tag
								has_war_with = HYQ
							}
						}
					}
					JAP = { country_event = { id = xian.15 hours = 5 }}
				}
				every_country = {
					limit = { 
						OR = {
							is_valid_power_struggle_participant = yes
							original_tag = PRC
						}
						exists = yes
						NOT = {
							is_in_faction_with = event_target:KMT_central_gov_tag
							is_in_faction_with = HYQ
							has_war_with = event_target:KMT_central_gov_tag
							has_war_with = HYQ
							tag = CHI
							tag = HYQ
						}
						NOT = {
							is_puppet_of = JAP
							is_puppet_of = event_target:KMT_central_gov_tag
							is_puppet_of = HYQ
						}
					}
					country_event = { id = xian.15 hours = 5 }
				}
				if = {
					limit = {
						has_government = fascism
					}
					remove_opinion_modifier = {
						modifier = hostile_status
						target = JAP
					}
					JAP = {
						remove_opinion_modifier = {
							modifier = hostile_status
							target = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					has_country_leader = {
						character = CHI_wang_jingwei
						ruling_only = yes
					}
					NOT = { has_government = fascism }
				}
				set_country_flag = KMT_supported_fyx_in_xian_incident_chaing_killed_event
				add_ideas = KMT_xian_firm_stance
			}
			if = {
				limit = { has_country_leader = { character = CHI_he_yingqin }}
				create_faction = KMT_xian_hyq_faction
				HYQ = { create_faction = KMT_xian_fyx_faction }
			}else = {
				create_faction = KMT_xian_fyx_faction
				HYQ = { create_faction = KMT_xian_hyq_faction }
			}
			set_country_flag = KMT_xian_faction_leader
			HYQ = { set_country_flag = KMT_xian_faction_leader }
		}
		add_ideas = KMT_civil_war_chi
		HYQ = { add_ideas = KMT_civil_war_hyq }
	}
	
	option = {
		name = xian.14.b	#suppoert he yingqin
		trigger = {
			NOT = {
				has_government = communism
				has_global_flag = KMT_finished_a_communist_focus
				has_government = communism
				has_country_flag = KMT_red_coup_finish
				focus_progress = { focus = KMT_support_pro_japanese_faction progress > 0 }
			}
		}
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			retire_character = CHI_chiang_kaishek
			#set_politics = {
			#	ruling_party = fascism
			#}
			set_party_name = { ideology = neutrality long_name = KMT_hyq name = KMT_hyq }
			add_popularity = { ideology = neutrality popularity = 0.75 }
			division_template = {
				name = "Luchün Shih"			
				regiments = {
					infantry = { x = 0 y = 0 }
					infantry = { x = 0 y = 1 }
					infantry = { x = 1 y = 0 }
					infantry = { x = 1 y = 1 }
					infantry = { x = 2 y = 0 }
					infantry = { x = 2 y = 1 }
					infantry = { x = 3 y = 0 }
					infantry = { x = 3 y = 1 }
				}
			}
			every_state = {
				limit = {
					owner = { tag = ROOT }
				}
				create_unit = { 
					division = "name = \"Ho Ying-chin Pu\" division_template = \"Luchün Shih\" start_experience_factor = 0.4" 
					owner = ROOT
				}
			}
			#unlock_national_focus = KMT_support_pro_japanese_faction
			hidden_effect = {
				if = {
					limit = {
						has_idea = KMT_pro_jap_propaganda
					}
					remove_ideas = KMT_pro_jap_propaganda
				}
				if = {
					limit = {
						has_idea = KMT_pro_jap_propaganda_2
					}
					remove_ideas = KMT_pro_jap_propaganda_2
				}
				#country_event = { id = loop.2 }
				start_civil_war = {
					ideology = neutrality
					size = 0.5
					keep_unit_leaders = { 1017 }
					keep_unit_leaders_trigger = { has_character_flag = KMT_hyq_flag }
					every_unit_leader = {
						set_character_flag = KMT_temp_sn_flag
						set_nationality = HYQ
					}
					every_character = {
						limit = { has_character_flag = KMT_temp_sn_flag }
						set_nationality = HYQ
						clr_character_flag = KMT_temp_sn_flag
					}
					HYQ = {
						annex_country = { 
							target = PREV 
							transfer_troops = yes
						}
					}
				}
				CHI = { CHI_wang_jingwei = { set_nationality = HYQ }}
				HYQ = {
					division_template = {
						name = "Luchün Shih"			
						regiments = {
							infantry = { x = 0 y = 0 }
							infantry = { x = 0 y = 1 }
							infantry = { x = 1 y = 0 }
							infantry = { x = 1 y = 1 }
							infantry = { x = 2 y = 0 }
							infantry = { x = 2 y = 1 }
							infantry = { x = 3 y = 0 }
							infantry = { x = 3 y = 1 }
						}
					}
					every_state = {
						limit = {
							owner = { tag = HYQ }
						}
						create_unit = { 
							division = "name = \"Lin-shih Pu-tui\" division_template = \"Luchün Shih\" start_experience_factor = 0.4" 
							owner = HYQ
						}
					}
					set_equipment_fraction = 3
					add_popularity = {
						ideology = neutrality
						popularity = 1
					}
					CHI_wang_jingwei = { promote_character = { ideology = the_peoples_tutelage }}
					CHI_wang_jingwei = { promote_character = { ideology = constitutionalism }}
					set_politics = {
						ruling_party = neutrality
					}
					declare_war_on = {	
						target = ROOT
						type = civil_war
					}
				}
				hidden_effect = {
					if = { limit = { HYQ = { has_character = CHI_he_yingqin }} HYQ = { CHI_he_yingqin = { set_nationality = CHI }}}
					CHI_he_yingqin = { promote_character = { ideology = the_peoples_tutelage }}
				}
				every_character = {
					limit = { has_character_flag = WJW_potential_defectors }
					set_nationality = HYQ
				}
			}
			every_state = {
				limit = {
					is_claimed_by = event_target:KMT_central_gov_tag
				}
				add_claim_by = HYQ
			}
			every_state = {
				limit = {
					is_core_of = event_target:KMT_central_gov_tag
				}
				add_core_of = HYQ
			}
			#every_state = {
			#	limit = { 
			#		is_owned_by = HYQ 
			#		is_core_of = event_target:KMT_central_gov_tag
			#	}
			#	remove_core_of = event_target:KMT_central_gov_tag
			#	add_claim_by = event_target:KMT_central_gov_tag
			#}
			hidden_effect = {
				#if = {
				#	limit = {
				#		PRC = { 
				#			exists = yes
				#			NOT = {
				#				is_in_faction_with = event_target:KMT_central_gov_tag
				#				is_in_faction_with = HYQ
				#				has_war_with = event_target:KMT_central_gov_tag
				#				has_war_with = HYQ
				#			}
				#		}
				#	}
				#	PRC = { country_event = { id = xian.15 hours = 2 }}
				#}
				if = {
					limit = {
						JAP = { 
							exists = yes
							NOT = {
								is_in_faction_with = event_target:KMT_central_gov_tag
								is_in_faction_with = HYQ
								has_war_with = event_target:KMT_central_gov_tag
								has_war_with = HYQ
							}
						}
					}
					JAP = { country_event = { id = xian.15 hours = 2 }}
				}
				every_country = {
					limit = { 
						OR = {
							is_valid_power_struggle_participant = yes
							original_tag = PRC
						}
						exists = yes
						NOT = {
							is_in_faction_with = event_target:KMT_central_gov_tag
							is_in_faction_with = HYQ
							has_war_with = event_target:KMT_central_gov_tag
							has_war_with = HYQ
							tag = CHI
							tag = HYQ
						}
					}
					country_event = { id = xian.15 hours = 2 }
				}
				if = {
					limit = {
						has_government = fascism
					}
					remove_opinion_modifier = {
						modifier = hostile_status
						target = JAP
					}
					JAP = {
						remove_opinion_modifier = {
							modifier = hostile_status
							target = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					has_country_leader = {
						character = CHI_wang_jingwei
						ruling_only = yes
					}
				}
				set_country_flag = KMT_supported_fyx_in_xian_incident_chaing_killed_event
			}
			if = {
				limit = { has_country_leader = { character = CHI_he_yingqin }}
				create_faction = KMT_xian_hyq_faction
				HYQ = { create_faction = KMT_xian_fyx_faction }
			}else = {
				create_faction = KMT_xian_fyx_faction
				HYQ = { create_faction = KMT_xian_hyq_faction }
			}
			set_country_flag = KMT_xian_faction_leader
			HYQ = { set_country_flag = KMT_xian_faction_leader }
		}
		add_ideas = KMT_civil_war_chi
		HYQ = { add_ideas = KMT_civil_war_hyq }
	}
	
	option = { 
		name = xian.14.c	#instant red coup
		ai_chance = {
			factor = 1000
		}
		trigger = {
			has_global_flag = KMT_finished_a_communist_focus
			NOT = {
				has_government = communism
				has_country_flag = KMT_red_coup_finish
			}
		}
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			set_country_flag = KMT_xian_CHI_kill_chiang
			set_global_flag = cks_killed_xian
			custom_effect_tooltip = KMT_xian_choose_to_kill_chiang_commie_tt
			set_global_flag = KMT_bypass_some_commie_focus
			KMT_red_coup_effect = yes
		}
	}
	
	option = { 
		name = xian.14.e	#we communist, we dont care
		ai_chance = {
			factor = 1000
		}
		trigger = {
			has_government = communism
		}
		add_political_power = 50
	}
}

#reaction to chiang killed
country_event = {
	id = xian.15
	title = xian.15.t
	desc = xian.15.d
	picture = GFX_report_event_china_politicians_captured

	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_leader = {
				character = CHI_wang_jingwei
				ruling_only = yes
			}
			has_country_leader = {
				character = CHI_he_yingqin
				ruling_only = yes
			}
		}
	}
	
	option = {
		name = xian.15.a_hyq
		ai_chance = {
			base = 2
			modifier = {
				factor = 0
				tag = PRC
			}
			modifier = {
				add = 100
				tag = XIA
			}
			modifier = {
				add = 20
				tag = SDC
			}
		}
		random_country = {
			limit = {
				has_country_leader = {
					character = CHI_he_yingqin
					ruling_only = yes
				}
			}
			country_event = { id = xian.16 }
		}
	}
	
	option = {
		name = xian.15.a_fyx
		ai_chance = {
			base = 10
			modifier = {
				factor = 0
				tag = JAP
			}
			modifier = {
				factor = 0
				tag = PRC
			}
			modifier = {
				factor = 0
				tag = MEN
			}
		}
		random_country = {
			limit = {
				has_country_leader = {
					character = CHI_wang_jingwei
					ruling_only = yes
				}
			}
			country_event = { id = xian.16 }
		}
	}
	
	option = {
		ai_chance = {
			base = 0
			modifier = {
				add = 1
				is_valid_power_struggle_participant = yes
			}
			modifier = {
				add = 50
				tag = PRC
			}
		}
		name = xian.15.b
		declare_war_on = {
			target = event_target:KMT_central_gov_tag
			type = civil_war
		}
		declare_war_on = {
			target = HYQ
			type = civil_war
		}
		event_target:KMT_central_gov_tag = {
			country_event = { id = xian.19 }
		}
		HYQ = {
			country_event = { id = xian.19 }
		}
	}
	
	option = {
		ai_chance = {
			base = 1
			modifier = {
				add = 50
				tag = JAP
			}
			modifier = {
				add = 50
				tag = PGR
			}
			modifier = {
				add = 50
				tag = MEN
			}
			modifier = {
				add = 20
				tag = NSM
			}
			modifier = {
				add = 20
				tag = XSM
			}
			modifier = {
				add = 50
				tag = YUN
			}
			modifier = {
				add = 50
				tag = SIK
			}
			modifier = {
				add = 10
				tag = SHX
			}
			modifier = {
				factor = 0
				tag = PRC
			}
		}
		name = xian.15.c
		set_country_flag = PRC_observe_xian
		if = {
			limit = { tag = JAP has_government = fascism }
			hidden_effect = { country_event = { id = xian.27 days = 15 }}
		}
	}
	
	option = {
		ai_chance = {
			base = 1000
		}
		trigger = {
			tag = SIK
			has_country_leader = {
				character = SIK_sheng_shicai
				ruling_only = yes
			}
			SOV = {
				exists = yes
				has_government = communism
			}
		}
		name = xian.15.e
		SOV = {
			country_event = { id = xian.20 }
		}
	}
}

#FROM try to join us
country_event = {
	id = xian.16
	title = xian.16.t
	desc = xian.16.d
	picture = GFX_report_event_china_politicians_captured

	is_triggered_only = yes
	
	option = {
		name = xian.16.a
		ai_chance = {
			factor = 80
		}
		FROM = {
			country_event = { id = xian.17 hours = 1 }
		}
		if = {
			limit = { has_war_with = FROM }
			white_peace = FROM
		}
		if = {
			limit = { has_country_leader = { character = CHI_wang_jingwei ruling_only = yes }}
			random_country = {
				limit = { has_country_leader = { character = CHI_he_yingqin ruling_only = yes }}
				FROM = { declare_war_on = { target = PREV type = topple_government}}
			}
		}else_if = {
			limit = { has_country_leader = { character = CHI_he_yingqin ruling_only = yes }}
			random_country = {
				limit = { has_country_leader = { character = CHI_wang_jingwei ruling_only = yes }}
				FROM = { declare_war_on = { target = PREV type = topple_government}}
			}
		}
		every_country = {
			limit = {
				has_war_together_with = ROOT
			}
			FROM = {
				give_military_access = PREV
			}
			give_military_access = FROM
		}
		give_military_access = FROM
		FROM = {
			give_military_access = ROOT
		}
		if = {
			limit = { is_in_faction = no }
			if = {
				limit = { has_country_leader = { character = CHI_he_yingqin }}
				create_faction = KMT_xian_hyq_faction
				HYQ = { create_faction = KMT_xian_fyx_faction }
			}else_if = {
				limit = { has_country_leader = { character = CHI_chiang_kaishek }}
				create_faction = KMT_xian_cks_faction
				HYQ = { create_faction = KMT_xian_cks_faction }
			}else = {
				create_faction = KMT_xian_fyx_faction
				HYQ = { create_faction = KMT_xian_hyq_faction }
			}
		}
		if = {
			limit = { 
				FROM = { is_in_faction = no }
			}
			add_to_faction = FROM
		}
	}
	
	option = {
		ai_chance = {
			factor = 0
		}
		name = xian.16.b
		FROM = {
			country_event = { id = xian.18 }
		}
	}
}

#FROM join ok
country_event = {
	id = xian.17
	title = xian.17.t
	desc = xian.17.d
	picture = GFX_report_event_china_politicians_captured

	is_triggered_only = yes
	
	option = {
		name = xian.17.a
		effect_tooltip = {
			if = {
				limit = {
					FROM = { tag = event_target:KMT_central_gov_tag }
				}
				add_to_war = {
					targeted_alliance = FROM
					enemy = HYQ
				}
			}
			if = {
				limit = {
					FROM = { tag = HYQ }
				}
				add_to_war = {
					targeted_alliance = FROM
					enemy = event_target:KMT_central_gov_tag
				}
			}
		}
	}
}

#FROM join rejected
country_event = {
	id = xian.18
	title = xian.18.t
	desc = xian.18.d
	picture = GFX_report_event_china_politicians_captured

	is_triggered_only = yes
	
	option = {
		name = xian.18.a
	}
}

#FROM declared war
country_event = {
	id = xian.19
	title = xian.19.t
	desc = xian.19.d
	picture = GFX_report_event_china_politicians_captured

	is_triggered_only = yes
	
	option = {
		name = xian.19.a
		effect_tooltip = {
			FROM = {
				declare_war_on = {
					target = ROOT
				}
			}
		}
	}
}

#sik want to join us
country_event = {
	id = xian.20
	title = xian.20.t
	desc = xian.20.d
	picture = GFX_report_event_china_politicians_captured

	is_triggered_only = yes
	
	option = {
		name = xian.20.a
		ai_chance = {
			base = 100
		}
		SOV = { puppet = SIK }
		SIK = { 
			country_event = { id = xian.21 }
			set_cosmetic_tag = SIKssr
		}
		if = {
			limit = {
				has_event_target = KMT_central_gov_tag
				country_exists = event_target:KMT_central_gov_tag
			}
			event_target:KMT_central_gov_tag = { country_event = { id = xian.23 }}
		}
	}
	
	option = {
		name = xian.20.b
		ai_chance = {
			base = 0
		}
		FROM = { country_event = { id = xian.22 }}
	}
}

#joined sov
country_event = {
	id = xian.21
	title = xian.21.t
	desc = xian.21.d
	picture = GFX_report_event_china_politicians_captured

	is_triggered_only = yes
	
	option = {
		name = xian.21.a
		effect_tooltip = {
			SOV = {
				set_autonomy = {
					target = SIK
					autonomy_state = puppet
				}
			}
		}
	}
}

#sov rejected
country_event = {
	id = xian.22
	title = xian.22.t
	desc = xian.22.d
	picture = GFX_report_event_china_politicians_captured

	is_triggered_only = yes
	
	option = {
		name = xian.22.a
	}
}

#sov puppeted sik
country_event = {
	id = xian.23
	title = xian.23.t
	desc = xian.23.d
	picture = GFX_report_event_china_politicians_captured

	is_triggered_only = yes
	
	option = {
		name = xian.23.a
		effect_tooltip = {
			FROM = {
				set_autonomy = {
					target = SIK
					autonomy_state = puppet
				}
			}
		}
	}
}

#chiang vow to destroy commies
country_event = {
	id = xian.24
	title = xian.24.t
	desc = xian.24.d
	picture = GFX_report_event_china_politicians_captured
	
	trigger = {
		NOT = {
			has_country_flag = KMT_pro_japanese_coup
			has_country_flag = KMT_red_coup_finish
			has_global_flag = KMT_xian_incident_fired
			OR = {
				has_war_with = JAP
				has_global_flag = CHI_warred_with_JAP
			}
		}
		tag = event_target:KMT_central_gov_tag
		OR = {
			AND = {
				NOT = { has_global_flag = liangguang_incident }
				has_global_flag = KMT_zxl_stopped_attack
			}
			date > 1936.10.8
		}
		NOT = { has_war_with = PRC }
		country_exists = PRC
		NOT = {
			event_target:KMT_central_gov_tag = {
				has_completed_focus = KMT_external_defense
			}
		}
	}
	
	fire_only_once = yes
	
	mean_time_to_happen = { 
		days = 30 
		modifier = {
			factor = 0.2
			date > 1936.11.15
		}
		
		modifier = {
			factor = 0
			event_target:KMT_central_gov_tag = {
				focus_progress = {
					focus = KMT_strike_PRC
					progress > 0.3
				}
			}
		}
	}
	
	immediate = {
		hidden_effect = {
			set_country_flag = KMT_chiang_vowed_to_destroy_commies
			if = {
				limit = { country_exists = ZXL }
				ZXL = { country_event = { id = prc.25 }}
			}
		}
	}
	
	option = {
		name = xian.24.a
	}
}

#chiang vow to destroy commies
country_event = {
	id = xian.25
	title = xian.24.t
	desc = xian.24.d
	picture = GFX_report_event_china_politicians_captured
	
	is_triggered_only = yes
	
	option = {
		name = xian.25.a
	}
}

#inspect xian
country_event = {
	id = xian.26
	title = xian.26.t
	desc = xian.26.d
	picture = GFX_report_event_chinese_soldiers_02

	is_triggered_only = yes
	
	option = {
		name = xian.2.a
		effect_tooltip = { activate_mission = KMT_all_out_assault }
	}
}

#jap recruit north china neutral ppl
country_event = {
	id = xian.27
	title = xian.27.t
	desc = xian.27.d
	picture = GFX_report_event_chinese_soldiers_02

	is_triggered_only = yes
	
	trigger = {
		OR = {
			SDC = { has_country_flag = PRC_observe_xian }
			SHX = { has_country_flag = PRC_observe_xian }
			MEN = { has_country_flag = PRC_observe_xian }
			PGR = { has_country_flag = PRC_observe_xian }
		}
	}
	
	fire_only_once = yes
	
	option = {
		name = xian.27.a	#send invitation
		ai_chance = { base = 100 }
		every_other_country = {
			limit = { 
				OR = {
					tag = SDC
					tag = SHX
					tag = MEN
					tag = PGR
				}
				has_country_flag = PRC_observe_xian
			}
			country_event = { id = xian.28 }
		}
	}
	
	option = {
		name = xian.27.b	#no send invitation
		ai_chance = { base = 0 }
	}
}

#jap recruit us
country_event = {
	id = xian.28
	title = xian.28.t
	desc = xian.28.d
	picture = GFX_report_event_chinese_soldiers_02

	is_triggered_only = yes
	
	option = {
		name = xian.28.a	#we align with japan
		ai_chance = { 
			base = 10 
			modifier = {
				tag = MEN
				add = 20
			}
			modifier = {
				tag = SHX
				factor = 0.01
			}
			modifier = {
				tag = SDC
				factor = 0.1
			}
		}
		JAP = {
			country_event = { id = xian.29 }
			set_autonomy = {
				target = ROOT
				autonomous_state = autonomy_wtt_imperial_protectorate
			}
		}
		if = {
			limit = { tag = MEN }
			if = {
				limit = {
					country_exists = ECR
				}
				annex_country = {
					target = ECR
					transfer_troops = yes
				}
				793 = {
					remove_core_of = ECR
				}
			}
			hidden_effect = {
				add_popularity = {
					ideology = fascism
					popularity = 1
				}
				add_popularity = {
					ideology = neutrality
					popularity = 0.1
				}
				ECR = {
					every_unit_leader = { 
						#effect_tooltip = { set_nationality = ROOT }
						set_character_flag = KMT_temp_sn_flag
					}
					every_character = {
						limit = { has_character_flag = KMT_temp_sn_flag }
						set_nationality = HYQ
						clr_character_flag = KMT_temp_sn_flag
					}
				}
			}
			MEN_Yondonwangchug = { promote_character = { ideology = rexism }}
			if = {
				limit = {
					NOT = {
						has_government = fascism
					}
				}
				set_politics = {
					ruling_party = fascism
				}
			}
			set_cosmetic_tag = MMGmen
		}
		if = {
			limit = { tag = PGR }
			set_global_flag = KMT_PGR_established
			add_state_claim = 609
			add_state_claim = 608
			add_state_claim = 614
			add_state_claim = 597
			add_state_claim = 615
			add_state_claim = 939
			add_state_claim = 743
			set_capital = { state = 608 }
			EHA = {
				country_event = { id = jap.4 days = 1 }
			}
			set_cosmetic_tag = JAP_kahoku_autonomy
		}
		HYQ = { country_event = { id = xian.31 }}
		event_target:KMT_central_gov_tag = { country_event = { id = xian.31 }}
		hidden_effect = {
			remove_ideas = cg_warlords
			if = {
				limit = { has_focus_tree = KMT_warlord_generic_focus }
				load_focus_tree = {
					tree = generic_focus
					keep_completed = no
				}
			}
			if = {
				limit = { has_character = SHX_yan_xishan }
				set_cosmetic_tag = JAP_sansei_autonomy
				SHX_yan_xishan = {
					add_country_leader_role = {
						promote_leader = yes
						country_leader = {
							ideology = pan_asianism
							expire = "1965.1.1.1"
							traits = {
							}
						}
					}
				}
			}
			if = {
				limit = { has_character = SDC_han_fuju }
				set_cosmetic_tag = JAP_santou_autonomy
				SDC_han_fuju = {
					add_country_leader_role = {
						promote_leader = yes
						country_leader = {
							ideology = pan_asianism
							expire = "1965.1.1.1"
							traits = {
							}
						}
					}
				}
			}
		}
		JAP = { 
			set_country_flag = JAP_xian_recruit_north_china_splinter_successful 
			if = {
				limit = { NOT = { has_country_flag = JAP_military_satisfied }}
				set_country_flag = JAP_military_satisfied
			}else = {
				add_to_variable = { JAP.JAP_military_satisfied_duration = 90 }
			}
		}
	}
	
	option = {
		name = xian.28.b	#we do not align with japn
		ai_chance = { base = 10 }
		JAP = {
			country_event = { id = xian.30 }
		}
	}
}

#from join us
country_event = {
	id = xian.29
	title = xian.29.t
	desc = xian.29.d
	picture = GFX_report_event_chinese_soldiers_02

	is_triggered_only = yes
	
	option = {
		name = xian.29.a
		effect_tooltip = { puppet = FROM }
	}
}

#from no join us
country_event = {
	id = xian.30
	title = xian.30.t
	desc = xian.30.d
	picture = GFX_report_event_chinese_soldiers_02

	is_triggered_only = yes
	
	option = {
		name = xian.30.a
	}
}

#from joins japan
country_event = {
	id = xian.31
	title = xian.31.t
	desc = xian.31.d
	picture = GFX_report_event_chinese_soldiers_02

	is_triggered_only = yes
	
	option = {
		name = xian.31.a
		effect_tooltip = { JAP = { puppet = FROM }}
	}
}


#__________________________________________________________________________________________________________________________________________
#__________________________________________________________________________________________________________________________________________

#demand event
country_event = {
	id = xian.100
	title = demand.t
	desc = demand.d
	
	picture = GFX_report_event_generic_sign_treaty2
	
	is_triggered_only = yes
	
	trigger = {
		always = no
		event_target:KMT_central_gov_tag = {
			NOT = {
				has_country_flag = KMT_pro_japanese_coup
				has_country_flag = KMT_red_coup_finish
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			if = {
				limit = {
					has_global_flag = KMT_chi_stop_civil_war_demand_rejected
				}
				custom_effect_tooltip = KMT_chi_stop_civil_war_demand_rejected_tt
			}
			if = {
				limit = {
					has_global_flag = KMT_zxl_submit_demand_flag
				}
				custom_effect_tooltip = KMT_chi_demand_submission_tt
			}
			if = {
				limit = {
					has_global_flag = KMT_zxl_submit_demand_rejected
				}
				custom_effect_tooltip = KMT_chi_demand_submission_rejected_tt
			}
			if = {
				limit = {
					has_global_flag = KMT_chi_stop_civil_war_demand_again
				}
				custom_effect_tooltip = KMT_chi_stop_civil_war_demand_again_tt
			}
			custom_effect_tooltip = KMT_ZXL_NAME_TT
			if = {
				limit = {
					has_global_flag = KMT_zxl_release_chiang_demand 
				}
				custom_effect_tooltip = KMT_will_release_chiang_tt
			}
			if = {
				limit = {
					has_global_flag = KMT_zxl_submit_demand 
				}
				custom_effect_tooltip = KMT_will_submit_to_chiang_tt
			}
			custom_effect_tooltip = KMT_CHI_NAME_TT
			if = {
				limit = {
					has_global_flag = KMT_chi_stop_civil_war_demand 
				}
				custom_effect_tooltip = KMT_will_stop_civil_war_tt
			}
		}
	}
	
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				tag = ZXL
				has_global_flag = KMT_chi_stop_civil_war_demand
			}
			modifier = {
				factor = 100
				tag = event_target:KMT_central_gov_tag
			}
		}
		name = accept_all_demand
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			set_global_flag = xian_resolved
			clr_global_flag = xian_incident
			set_global_flag = PRC_yes_truce
					log = "[GetDate]: [Root.GetName] PRC_yes_truce"
					set_variable = { global.PRC_past_month_ire = global.PRC_expansion_ire }
			if = {
				limit = {
					has_global_flag = KMT_zxl_release_chiang_demand
				}
				event_target:KMT_central_gov_tag = {
					custom_effect_tooltip = KMT_chiang_return_tt
					every_unit_leader = {
						limit = {
							has_trait = KMT_held_hostage
						}
						remove_unit_leader_trait = KMT_held_hostage
					}
				}
			}
			if = {
				limit = {
					has_global_flag = KMT_zxl_submit_demand
				}
				event_target:KMT_central_gov_tag = {
					annex_country = {
						target = ZXL
						transfer_troops = yes
					}
				}
			}
			if = {
				limit = {
					has_global_flag = KMT_chi_stop_civil_war_demand
				}
				set_global_flag = KMT_united_front_enabled
				clr_global_flag = KMT_first_chinese_civil_war
				custom_effect_tooltip = KMT_enables_united_front_tt
				if = {
					limit = {
						any_country = {
							OR = {
								tag = PRC
								has_country_flag = is_warlords
							}
							has_war_with = event_target:KMT_central_gov_tag
						}
					}
					every_country = {
						limit = {
							OR = {
								has_country_flag = is_warlords
								tag = PRC
							}	
						}
						event_target:KMT_central_gov_tag = {
							white_peace = PREV
						}
					}
				}
				every_country = {
					limit = {
						OR = {
							has_country_flag = is_warlords
							tag = PRC
						}	
					}
					event_target:KMT_central_gov_tag = {
						diplomatic_relation = {
							country = PREV
							relation = non_aggression_pact
							active = yes
						}
						remove_wargoal = { target = PREV type = all }
					}
				}
			}
			hidden_effect = {
				country_event = { id = xian.102 }
				FROM = {
					country_event = { id = xian.102 }
				}
			}
			clr_global_flag = liangguang_incident
			set_global_flag = liangguang_solved
			clr_global_flag = KMT_chi_stop_civil_war_demand_rejected
			clr_global_flag = KMT_zxl_submit_demand_flag
			clr_global_flag = KMT_zxl_submit_demand_rejected
			clr_global_flag = KMT_chi_stop_civil_war_demand_again
			clr_global_flag = cks_held
		}
		622 = { set_demilitarized_zone = no }
	}
	
	option = {
		name = reject_all_demand_and_war
		ai_chance = {
			factor = 1
			modifier = {
				add = 10
				has_global_flag = {
					flag = KMT_xian_rejected_num
					value > 0
				}
			}
			modifier = {
				add = 10
				has_global_flag = {
					flag = KMT_xian_rejected_num
					value > 1
				}
			}
			modifier = {
				add = 10
				has_global_flag = {
					flag = KMT_xian_rejected_num
					value > 2
				}
			}
			modifier = {
				add = 10
				has_global_flag = {
					flag = KMT_xian_rejected_num
					value > 3
				}
			}
			modifier = {
				add = 10
				has_global_flag = {
					flag = KMT_xian_rejected_num
					value > 4
				}
			}
			modifier = {
				add = 10
				has_global_flag = {
					flag = KMT_xian_rejected_num
					value > 5
				}
			}
			modifier = {
				add = 10
				has_global_flag = {
					flag = KMT_xian_rejected_num
					value > 6
				}
			}
			modifier = {
				add = 10
				has_global_flag = {
					flag = KMT_xian_rejected_num
					value > 7
				}
			}
			modifier = {
				add = 10
				has_global_flag = {
					flag = KMT_xian_rejected_num
					value > 8
				}
			}
			modifier = {
				add = 10
				has_global_flag = {
					flag = KMT_xian_rejected_num
					value > 9
				}
			}
			modifier = {
				add = 10
				has_global_flag = {
					flag = KMT_xian_rejected_num
					value > 10
				}
			}
			modifier = {
				add = 10
				has_global_flag = {
					flag = KMT_xian_rejected_num
					value > 11
				}
			}
			modifier = {
				add = 10
				has_global_flag = {
					flag = KMT_xian_rejected_num
					value > 12
				}
			}
			modifier = {
				add = 10
				has_global_flag = {
					flag = KMT_xian_rejected_num
					value > 13
				}
			}
			modifier = {
				add = 10
				has_global_flag = {
					flag = KMT_xian_rejected_num
					value > 14
				}
			}
			modifier = {
				add = 10
				has_global_flag = {
					flag = KMT_xian_rejected_num
					value > 15
				}
			}
			modifier = {
				add = 25
				has_global_flag = {
					flag = KMT_xian_rejected_num
					days > 10
				}
			}
			modifier = {
				add = 50
				has_global_flag = {
					flag = KMT_xian_rejected_num
					days > 15
				}
			}
			modifier = {
				add = 100
				has_global_flag = {
					flag = KMT_xian_rejected_num
					days > 20
				}
			}
			modifier = {
				add = 1000
				has_global_flag = {
					flag = KMT_xian_rejected_num
					days > 25
				}
			}
		}
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			clr_global_flag = xian_incident
			event_target:KMT_central_gov_tag = {
				end_puppet = ZXL
			}
			hidden_effect = {
				if = {
					limit = {
						ZXL = {
							has_war_together_with = event_target:KMT_central_gov_tag
						}
					}
					ZXL = {
						#country_event = { id = wd.1 }
					}
				}
			}
			declare_war_on = { 
				target = FROM
				type = annex_everything
			}
			FROM = {
				country_event = { id = xian.101 }
			}
			clr_global_flag = KMT_chi_stop_civil_war_demand_rejected
			clr_global_flag = KMT_zxl_submit_demand_flag
			clr_global_flag = KMT_zxl_submit_demand_rejected
			clr_global_flag = KMT_chi_stop_civil_war_demand_again
		}
		622 = { set_demilitarized_zone = no }
	}
	
	option = {
		name = xian.100.a
		ai_chance = { factor = 0 }
		trigger = { 
			tag = event_target:KMT_central_gov_tag
			has_global_flag = KMT_chi_stop_civil_war_demand
		}
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			FROM = {
				country_event = { id = xian.100 hours = 10 }
			}
			set_global_flag = KMT_chi_stop_civil_war_demand_rejected
			clr_global_flag = KMT_chi_stop_civil_war_demand
			clr_global_flag = KMT_zxl_submit_demand_flag
			clr_global_flag = KMT_zxl_submit_demand_rejected
			clr_global_flag = KMT_chi_stop_civil_war_demand_again
			if = {
				limit = {
					OR = {
						NOT = { has_country_flag = KMT_xian_rejected_num }
						has_country_flag = {
							flag = KMT_xian_rejected_num
							value < 1
						}
					}
				}
				set_country_flag = {
					flag = KMT_xian_rejected_num
					value = 1
				}
				else = {
					modify_country_flag = {
						flag = KMT_xian_rejected_num
						value = 1
					}
				}
			}
			else = {
				622 = { set_demilitarized_zone = no }
			}
		}
	}
	
	option = {
		name = xian.100.b
		ai_chance = { factor = 0 }
		trigger = { 
			tag = event_target:KMT_central_gov_tag
		}
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			FROM = {
				country_event = { id = xian.100 hours = 10 }
			}
			set_global_flag = KMT_zxl_submit_demand
			set_global_flag = KMT_zxl_submit_demand_flag
			clr_global_flag = KMT_chi_stop_civil_war_demand_rejected
			clr_global_flag = KMT_zxl_submit_demand_rejected
			clr_global_flag = KMT_chi_stop_civil_war_demand_again
			if = {
				limit = {
					OR = {
						NOT = { has_global_flag = KMT_xian_rejected_num }
						has_global_flag = {
							flag = KMT_xian_rejected_num
							value < 1
						}
					}
				}
				set_global_flag = {
					flag = KMT_xian_rejected_num
					value = 1
				}
				else = {
					modify_global_flag = {
						flag = KMT_xian_rejected_num
						value = 1
					}
				}
			}
			else = {
				622 = { set_demilitarized_zone = no }
			}
		}
	}
	
	option = {
		ai_chance = {
			factor = 0
		}
		name = xian.100.c
		trigger = { 
			tag = ZXL
			has_global_flag = KMT_zxl_submit_demand
		}
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			FROM = {
				country_event = { id = xian.100 hours = 10 }
			}
			clr_global_flag = KMT_zxl_submit_demand
			set_global_flag = KMT_zxl_submit_demand_rejected
			clr_global_flag = KMT_chi_stop_civil_war_demand_rejected
			clr_global_flag = KMT_zxl_submit_demand_flag
			clr_global_flag = KMT_chi_stop_civil_war_demand_again
			if = {
				limit = {
					OR = {
						NOT = { has_global_flag = KMT_xian_rejected_num }
						has_global_flag = {
							flag = KMT_xian_rejected_num
							value < 1
						}
					}
				}
				set_global_flag = {
					flag = KMT_xian_rejected_num
					value = 1
				}
				else = {
					modify_global_flag = {
						flag = KMT_xian_rejected_num
						value = 1
					}
				}
			}
			else = { 622 = { set_demilitarized_zone = no }}
		}
	}
	
	option = {
		name = xian.100.d
		ai_chance = {
			factor = 50
		}
		trigger = { 
			tag = ZXL
			NOT = { has_global_flag = KMT_chi_stop_civil_war_demand }
		}
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			FROM = {
				country_event = { id = xian.100 hours = 10 }
			}
			set_global_flag = KMT_chi_stop_civil_war_demand
			set_global_flag = KMT_chi_stop_civil_war_demand_again
			clr_global_flag = KMT_chi_stop_civil_war_demand_rejected
			clr_global_flag = KMT_zxl_submit_demand_flag
			clr_global_flag = KMT_zxl_submit_demand_rejected
			if = {
				limit = {
					OR = {
						NOT = { has_global_flag = KMT_xian_rejected_num }
						has_global_flag = {
							flag = KMT_xian_rejected_num
							value < 1
						}
					}
				}
				set_global_flag = {
					flag = KMT_xian_rejected_num
					value = 1
				}
				else = {
					modify_global_flag = {
						flag = KMT_xian_rejected_num
						value = 1
					}
				}
			}
			else = { 622 = { set_demilitarized_zone = no }}
		}
	}
}

#rejected and war
country_event = {
	id = xian.101
	title = demand_rejected_war.t
	desc = demand_rejected_war.d
	
	picture = GFX_report_event_chinese_soldiers_fighting
	
	is_triggered_only = yes
	
	option = {
		name = demand_rejected_war.a
		effect_tooltip = {
			FROM = {
				declare_war_on = { 
					target = ROOT
					type = annex_everything
				}
			}
		}
	}
}

#resolved
country_event = {
	id = xian.102
	title = resolved.t
	desc = resolved.d
	
	picture = GFX_report_event_generic_sign_treaty2
	
	is_triggered_only = yes
	
	trigger = {
		event_target:KMT_central_gov_tag = {
			NOT = {
				has_country_flag = KMT_pro_japanese_coup
				has_country_flag = KMT_red_coup_finish
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			if = {
				limit = {
					has_global_flag = KMT_chi_stop_civil_war_demand_rejected
				}
				custom_effect_tooltip = KMT_chi_stop_civil_war_demand_rejected_tt
				clr_global_flag = KMT_chi_stop_civil_war_demand_rejected
			}
			if = {
				limit = {
					has_global_flag = KMT_zxl_submit_demand_flag
				}
				custom_effect_tooltip = KMT_chi_demand_submission_tt
				clr_global_flag = KMT_zxl_submit_demand_flag
			}
			if = {
				limit = {
					has_global_flag = KMT_zxl_submit_demand_rejected
				}
				custom_effect_tooltip = KMT_chi_demand_submission_rejected_tt
				clr_global_flag = KMT_zxl_submit_demand_rejected
			}
			custom_effect_tooltip = KMT_ZXL_NAME_TT
			if = {
				limit = {
					has_global_flag = KMT_zxl_release_chiang_demand 
				}
				custom_effect_tooltip = KMT_will_release_chiang_tt
				hidden_effect = {
					event_target:KMT_central_gov_tag = {
						every_unit_leader = {
							limit = {
								has_trait = KMT_held_hostage
							}
							remove_unit_leader_trait = KMT_held_hostage
						}
					}
				}
			}
			if = {
				limit = {
					has_global_flag = KMT_zxl_submit_demand 
				}
				custom_effect_tooltip = KMT_will_submit_to_chiang_tt
			}
			custom_effect_tooltip = KMT_CHI_NAME_TT
			if = {
				limit = {
					has_global_flag = KMT_chi_stop_civil_war_demand 
				}
				custom_effect_tooltip = KMT_will_stop_civil_war_tt
			}
			if = {
				limit = {
					has_global_flag = KMT_chi_no_prosecution_demand
				}
				custom_effect_tooltip = KMT_will_not_prosecute_tt
			}
		}
		hidden_effect = { 
			if = {
				limit = {
					PRC = {
						exists = yes
						has_government = communism
						is_subject = no
					}
				}
				set_variable = { global.KMT_prc_owned_states_at_xian_truce = PRC.num_owned_states }
			}
			if = {
				limit = { PRC = { NOT = { has_dynamic_modifier = { modifier = PRC_national_defence_government_legitimacy }}}}
				PRC = { country_event = { id = prc.206 }}
			}else_if = {
				limit = { 
					SOV = {
						exists = yes
						has_government = communism
						is_subject = no
					}
					PRC = {
						exists = yes
						has_government = communism
						OR = {
							is_subject = no
							is_subject_of = SOV
						}
						NOT = { has_country_flag = PRC_broken_tie_with_SOV }
					}
				}
				SOV = {
					country_event = { id = prc.288 }
				}
			}else = {
				if = {
					limit = { NOT = { has_global_flag = PRC_sian_event_fired }}
					set_global_flag = PRC_sian_event_fired
					PRC = { country_event = { id = prc.293 }}
				}
			}
		}
		if = {
			limit = { NOT = { has_global_flag = xian_global_news24_fired }}
			set_global_flag = xian_global_news24_fired
			news_event = { id = kns.24 }
		}
	}
	
	option = {
		if = {
			limit = {
				event_target:KMT_central_gov_tag = {
					NOT = {
						has_country_flag = KMT_pro_japanese_coup
						has_country_flag = KMT_red_coup_finish
					}
				}
			}
			effect_tooltip = {
				if = {
					limit = {
						has_global_flag = KMT_zxl_release_chiang_demand
					}
					event_target:KMT_central_gov_tag = {
						custom_effect_tooltip = KMT_chiang_return_tt
						every_unit_leader = {
							limit = {
								has_trait = KMT_held_hostage
							}
							remove_unit_leader_trait = KMT_held_hostage
						}
					}
				}
				if = {
					limit = {
						has_global_flag = KMT_zxl_submit_demand
					}
					event_target:KMT_central_gov_tag = {
						annex_country = {
							target = ZXL
							transfer_troops = yes
						}
					}
				}
				if = {
					limit = {
						has_global_flag = KMT_chi_stop_civil_war_demand
					}
					set_global_flag = KMT_united_front_enabled
					if = {
						limit = {
							any_country = {
								OR = {
									tag = PRC
									has_country_flag = is_warlords
								}
								has_war_with = event_target:KMT_central_gov_tag
							}
						}
						every_country = {
							limit = {
								OR = {
									has_country_flag = is_warlords
									tag = PRC
								}	
							}
							event_target:KMT_central_gov_tag = {
								white_peace = PREV
							}
						}
					}
					every_country = {
						limit = {
							OR = {
								has_country_flag = is_warlords
								tag = PRC
							}	
						}
						event_target:KMT_central_gov_tag = {
							diplomatic_relation = {
								country = PREV
								relation = non_aggression_pact
								active = yes
							}
							remove_wargoal = { target = PREV type = all }
						}
					}
				}
			}
		}
	}
}

#from demand popup
country_event = {
	id = xian.103
	title = xian.103.t
	desc = xian.103.d
	
	picture = GFX_report_event_china_politicians_captured
	
	is_triggered_only = yes
	
	option = {
		name = xian.103.a
	}
}