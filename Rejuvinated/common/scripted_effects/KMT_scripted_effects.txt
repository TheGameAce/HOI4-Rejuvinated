PRC_create_wargoal_for_dongbei = {
	custom_effect_tooltip = PRC_create_wargoal_for_db_tt
	hidden_effect = {
		every_country = {
			limit = {
				any_owned_state = {
					OR = {
						region = 155
						region = 242
						region = 243
						region = 244
						region = 245
						region = 143
					}
				}
				NOT = { tag = ROOT }
			}
			ROOT = {
				create_wargoal = {
					target = PREV
					type = take_state_focus
				}
			}
		}
	}
}


### anchor_1 ###
gain_central_plain_wargoal = {
	custom_effect_tooltip = MCK_reclaim_central_plain_tt
	every_country = {
		limit = {
			any_owned_state = {
				OR = {
					region = 143
					region = 245
					region = 282
					region = 250
					region = 280
					region = 247
					region = 164
					region = 246
					region = 250
					region = 249
					region = 281
					region = 248
					region = 165
					region = 144
				}
				NOT = { 
					state = 746 
					state = 743 
					state = 326
					state = 728
					state = 729
				}
			}
			NOT = { tag = ROOT }
		}
		ROOT = {
			create_wargoal = {
				target = PREV
				type = take_state_focus
			}
		}
	}
}
### anchor_2 ###

old_frontier_get_wargoal = {
	custom_effect_tooltip = MCK_restore_frontier_tt
	every_country = {
		limit = {
			any_owned_state = {
				OR = {
					region = 155
					region = 242
					region = 243
					region = 244
					region = 283
					region = 152
					region = 266
					region = 242
					region = 145
					region = 200
					region = 148
					region = 255
					region = 87
				
					state = 758
					
					state = 434
					state = 977
					state = 732
					state = 586
					state = 589
					state = 654
					state = 962
					state = 787
					state = 746
					state = 524
				}
				NOT = { 
					state = 555 
					state = 745 
				}
			}
			NOT = { tag = ROOT }
		}
		ROOT = {
			create_wargoal = {
				target = PREV
				type = take_state_focus
			}
		}
	}
}
### anchor_3 ###

gain_fareast_wargoal = {
	custom_effect_tooltip = PRC_get_wargoal_for_fareast_tt
	hidden_effect = {
		every_country = {
			limit = {
				any_owned_state = {
					region = 148
				}
				NOT = { tag = ROOT }
			}
			ROOT = {
				create_wargoal = {
					target = PREV
					type = take_state_focus
				}
			}
		}
	}
}
### anchor_4 ###

KMT_north_plan_wargoal = {
	custom_effect_tooltip = KMT_north_plan_effect_tt
	hidden_effect = {
		every_country = {
			limit = {
				any_owned_state = {
					OR = {
						region = 143
						region = 155
						region = 242
						region = 243
						region = 244
						region = 245
					}
				}
				NOT = { 
					tag = ROOT 
					is_chinese_nations_w_HYQ = yes
				}
			}
			ROOT = {
				create_wargoal = {
					target = PREV
					type = take_state_focus
				}
			}
		}
	}
}
### anchor_5 ###

add_xian_rejected_num = {
	if = {
		limit = {
			has_country_flag = {
				flag = KMT_xian_rejected_num
				value < 2
			}
		}
		set_country_flag = {
			flag = KMT_xian_rejected_num
			value = 1
		}
		else = {
			modify_country_flag = {
				flag = KMT_xian_rejected_num
				value = 1
			}
		}
	}
}


withdraw_from_all_wars_with_puppet = {
	if = {
		limit = {
			has_government = neutrality
		}
		random_other_country = {
			limit = {
				has_government = neutrality
				has_war = no
				exists = yes
			}
			puppet = ROOT
			end_puppet = ROOT
		}
		if = {
			limit = {
				NOT = {
					any_country = {
						NOT = { tag = ROOT }
						has_government = neutrality
						has_war = no
						exists = yes
					}
				}
			}
			random_other_country = {
				limit = {
					has_war = no
				}
				puppet = ROOT
				end_puppet = ROOT
			}
		}
		add_popularity = {
			ideology = neutrality
			popularity = 0.95
		}
	}
	if = {
		limit = {
			has_government = fascism
		}
		random_other_country = {
			limit = {
				has_government = fascism
				has_war = no
				exists = yes
			}
			puppet = ROOT
			end_puppet = ROOT
		}
		if = {
			limit = {
				NOT = {
					any_country = {
						NOT = { tag = ROOT }
						has_government = fascism
						has_war = no
						exists = yes
					}
				}
			}
			random_other_country = {
				limit = {
					has_war = no
				}
				puppet = ROOT
				end_puppet = ROOT
			}
		}
		add_popularity = {
			ideology = fascism
			popularity = 0.95
		}
	}
	if = {
		limit = {
			has_government = communism
		}
		random_other_country = {
			limit = {
				has_government = communism
				has_war = no
				exists = yes
			}
			puppet = ROOT
			end_puppet = ROOT
		}
		if = {
			limit = {
				NOT = {
					any_country = {
						NOT = { tag = ROOT }
						has_government = communism
						has_war = no
						exists = yes
					}
				}
			}
			random_other_country = {
				limit = {
					has_war = no
				}
				puppet = ROOT
				end_puppet = ROOT
			}
		}
		add_popularity = {
			ideology = communism
			popularity = 0.95
		}
	}
	if = {
		limit = {
			has_government = democratic
		}
		random_other_country = {
			limit = {
				has_government = democratic
				has_war = no
				exists = yes
			}
			puppet = ROOT
			end_puppet = ROOT
		}
		if = {
			limit = {
				NOT = {
					any_country = {
						NOT = { tag = ROOT }
						has_government = democratic
						has_war = no
						exists = yes
					}
				}
			}
			random_other_country = {
				limit = {
					has_war = no
				}
				puppet = ROOT
				end_puppet = ROOT
			}
		}
		add_popularity = {
			ideology = democratic
			popularity = 0.95
		}
	}
	if = {
		limit = {
			is_in_faction = yes
		}
		random_country = {
			limit = {
				is_faction_leader = yes
				is_in_faction_with = ROOT
			}
			remove_from_faction = ROOT
		}
	}
}

increase_jap_suspicion = {
	custom_effect_tooltip = increase_jap_suspicion_tt
	add_to_variable = { MCK_suspicion = MCK_suspicion_increase }
	if = {
		limit = {
			check_variable = { MCK_suspicion > 9 }
		}
		set_temp_variable = { MCK_awareness_increase = MCK_suspicion }
		divide_temp_variable = { MCK_awareness_increase = 10 }
		round_temp_variable = MCK_awareness_increase
		set_variable = { MCK_suspicion = MCK_awareness_increase }
		increase_jap_awareness = yes
	}
}

increase_jap_awareness = {
	custom_effect_tooltip = increase_jap_awareness_tt
	set_variable = { MCK_temp_awareness = MCK_awareness }
	add_to_temp_variable = { MCK_temp_awareness = MCK_awareness_increase }
	if = {
		limit = { check_variable = { MCK_temp_awareness > 19 }}
		custom_effect_tooltip = MCK_jap_will_demand_submission_tt
		OVERLORD = { country_event = jap.79 }
	}else_if = {
		limit = { 
			check_variable = { MCK_temp_awareness > 14 }
		}
		custom_effect_tooltip = MCK_increase_awareness_modifier_tt
		custom_effect_tooltip = MCK_awareness_3
	}else_if = {
		limit = { 
			check_variable = { MCK_temp_awareness > 9 }
		}
		custom_effect_tooltip = MCK_increase_awareness_modifier_tt
		custom_effect_tooltip = MCK_awareness_2
	}
	add_to_variable = { MCK_awareness = MCK_awareness_increase }
}

increase_jap_awareness2 = {
	custom_effect_tooltip = increase_jap_awareness2_tt
	set_temp_variable = { MCK_temp_awareness = MCK_awareness }
	add_to_temp_variable = { MCK_temp_awareness = 2 }
	if = {
		limit = { check_variable = { MCK_temp_awareness > 19 }}
		custom_effect_tooltip = MCK_jap_will_demand_submission_tt
		OVERLORD = { country_event = jap.79 }
	}else_if = {
		limit = { 
			check_variable = { MCK_temp_awareness > 14 }
		}
		custom_effect_tooltip = MCK_increase_awareness_modifier_tt
		custom_effect_tooltip = MCK_awareness_3
	}else_if = {
		limit = { 
			check_variable = { MCK_temp_awareness > 9 }
		}
		custom_effect_tooltip = MCK_increase_awareness_modifier_tt
		custom_effect_tooltip = MCK_awareness_2
	}
	add_to_variable = { MCK_awareness = 2 }
}

increase_jap_awareness3 = {
	custom_effect_tooltip = increase_jap_awareness3_tt
	set_temp_variable = { MCK_temp_awareness = MCK_awareness }
	add_to_temp_variable = { MCK_temp_awareness = 3 }
	if = {
		limit = { check_variable = { MCK_temp_awareness > 19 }}
		custom_effect_tooltip = MCK_jap_will_demand_submission_tt
		OVERLORD = { country_event = jap.79 }
	}else_if = {
		limit = { 
			check_variable = { MCK_temp_awareness > 14 }
		}
		custom_effect_tooltip = MCK_increase_awareness_modifier_tt
		custom_effect_tooltip = MCK_awareness_3
	}else_if = {
		limit = { 
			check_variable = { MCK_temp_awareness > 9 }
		}
		custom_effect_tooltip = MCK_increase_awareness_modifier_tt
		custom_effect_tooltip = MCK_awareness_2
	}
	add_to_variable = { MCK_awareness = 3 }
}

increase_jap_awareness4 = {
	custom_effect_tooltip = increase_jap_awareness4_tt
	set_temp_variable = { MCK_temp_awareness = MCK_awareness }
	add_to_temp_variable = { MCK_temp_awareness = 4 }
	if = {
		limit = { check_variable = { MCK_temp_awareness > 19 }}
		custom_effect_tooltip = MCK_jap_will_demand_submission_tt
		OVERLORD = { country_event = jap.79 }
	}else_if = {
		limit = { 
			check_variable = { MCK_temp_awareness > 14 }
		}
		custom_effect_tooltip = MCK_increase_awareness_modifier_tt
		custom_effect_tooltip = MCK_awareness_3
	}else_if = {
		limit = { 
			check_variable = { MCK_temp_awareness > 9 }
		}
		custom_effect_tooltip = MCK_increase_awareness_modifier_tt
		custom_effect_tooltip = MCK_awareness_2
	}
	add_to_variable = { MCK_awareness = 4 }
}

lower_awareness2 = {
	custom_effect_tooltip = lower_awareness2_tt
	set_temp_variable = { MCK_temp_awareness = MCK_awareness }
	subtract_from_temp_variable = { MCK_temp_awareness = 2 }
	if = {
		limit = { 
			NOT = { check_variable = { MCK_temp_awareness > 9 }}
		}
		custom_effect_tooltip = MCK_increase_awareness_modifier_tt
		custom_effect_tooltip = MCK_awareness_none_tt
	}else = {
		if = {
			limit = { 
				NOT = {check_variable = { MCK_temp_awareness > 14 }}
			}
			custom_effect_tooltip = MCK_increase_awareness_modifier_tt
			custom_effect_tooltip = MCK_awareness_2_tt
		}
	}
	if = {
		limit = {
			check_variable = { MCK_temp_awareness < 0 }
		}
		set_variable = { MCK_awareness = 0 }
	}else = {
		subtract_from_variable = { MCK_awareness = 2 }
	}
}


KMT_take_pacific_wargoal = {
	custom_effect_tooltip = KMT_take_pacific_tt
	hidden_effect = {
		if = {
			limit = {
				526 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					526 = {
						owner = { is_puppet = no }
					}
				}
				526 = {
					owner = {
						save_event_target_as = KMTtakepac_526_owner
					}
				}
				else = {
					526 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_526_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				524 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					524 = {
						owner = { is_puppet = no }
					}
				}
				524 = {
					owner = {
						save_event_target_as = KMTtakepac_524_owner
					}
				}
				else = {
					524 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_524_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				528 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					528 = {
						owner = { is_puppet = no }
					}
				}
				528 = {
					owner = {
						save_event_target_as = KMTtakepac_528_owner
					}
				}
				else = {
					528 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_528_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				529 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					529 = {
						owner = { is_puppet = no }
					}
				}
				529 = {
					owner = {
						save_event_target_as = KMTtakepac_529_owner
					}
				}
				else = {
					529 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_529_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				530 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					530 = {
						owner = { is_puppet = no }
					}
				}
				530 = {
					owner = {
						save_event_target_as = KMTtakepac_530_owner
					}
				}
				else = {
					530 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_530_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				531 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					531 = {
						owner = { is_puppet = no }
					}
				}
				531 = {
					owner = {
						save_event_target_as = KMTtakepac_531_owner
					}
				}
				else = {
					531 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_531_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				532 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					532 = {
						owner = { is_puppet = no }
					}
				}
				532 = {
					owner = {
						save_event_target_as = KMTtakepac_532_owner
					}
				}
				else = {
					532 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_532_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				282 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					282 = {
						owner = { is_puppet = no }
					}
				}
				282 = {
					owner = {
						save_event_target_as = KMTtakepac_282_owner
					}
				}
				else = {
					282 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_282_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				535 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					535 = {
						owner = { is_puppet = no }
					}
				}
				535 = {
					owner = {
						save_event_target_as = KMTtakepac_535_owner
					}
				}
				else = {
					535 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_535_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				534 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					534 = {
						owner = { is_puppet = no }
					}
				}
				534 = {
					owner = {
						save_event_target_as = KMTtakepac_534_owner
					}
				}
				else = {
					534 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_534_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				533 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					533 = {
						owner = { is_puppet = no }
					}
				}
				533 = {
					owner = {
						save_event_target_as = KMTtakepac_533_owner
					}
				}
				else = {
					533 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_533_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				536 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					536 = {
						owner = { is_puppet = no }
					}
				}
				536 = {
					owner = {
						save_event_target_as = KMTtakepac_536_owner
					}
				}
				else = {
					536 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_536_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				555 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					555 = {
						owner = { is_puppet = no }
					}
				}
				555 = {
					owner = {
						save_event_target_as = KMTtakepac_555_owner
					}
				}
				else = {
					555 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_555_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				645 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					645 = {
						owner = { is_puppet = no }
					}
				}
				645 = {
					owner = {
						save_event_target_as = KMTtakepac_645_owner
					}
				}
				else = {
					645 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_645_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				525 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					525 = {
						owner = { is_puppet = no }
					}
				}
				525 = {
					owner = {
						save_event_target_as = KMTtakepac_525_owner
					}
				}
				else = {
					525 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_525_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				527 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					527 = {
						owner = { is_puppet = no }
					}
				}
				527 = {
					owner = {
						save_event_target_as = KMTtakepac_527_owner
					}
				}
				else = {
					527 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_527_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				648 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					648 = {
						owner = { is_puppet = no }
					}
				}
				648 = {
					owner = {
						save_event_target_as = KMTtakepac_648_owner
					}
				}
				else = {
					648 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_648_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				646 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					646 = {
						owner = { is_puppet = no }
					}
				}
				646 = {
					owner = {
						save_event_target_as = KMTtakepac_646_owner
					}
				}
				else = {
					646 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_646_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				638 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					638 = {
						owner = { is_puppet = no }
					}
				}
				638 = {
					owner = {
						save_event_target_as = KMTtakepac_638_owner
					}
				}
				else = {
					638 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_638_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				647 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					647 = {
						owner = { is_puppet = no }
					}
				}
				647 = {
					owner = {
						save_event_target_as = KMTtakepac_647_owner
					}
				}
				else = {
					647 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_647_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				684 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					684 = {
						owner = { is_puppet = no }
					}
				}
				684 = {
					owner = {
						save_event_target_as = KMTtakepac_684_owner
					}
				}
				else = {
					684 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_684_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				633 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					633 = {
						owner = { is_puppet = no }
					}
				}
				633 = {
					owner = {
						save_event_target_as = KMTtakepac_633_owner
					}
				}
				else = {
					633 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_633_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				632 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					632 = {
						owner = { is_puppet = no }
					}
				}
				632 = {
					owner = {
						save_event_target_as = KMTtakepac_632_owner
					}
				}
				else = {
					632 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_632_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				725 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					725 = {
						owner = { is_puppet = no }
					}
				}
				725 = {
					owner = {
						save_event_target_as = KMTtakepac_725_owner
					}
				}
				else = {
					725 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_725_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				639 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					639 = {
						owner = { is_puppet = no }
					}
				}
				639 = {
					owner = {
						save_event_target_as = KMTtakepac_639_owner
					}
				}
				else = {
					639 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_639_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				631 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					631 = {
						owner = { is_puppet = no }
					}
				}
				631 = {
					owner = {
						save_event_target_as = KMTtakepac_631_owner
					}
				}
				else = {
					631 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_631_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				642 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					642 = {
						owner = { is_puppet = no }
					}
				}
				642 = {
					owner = {
						save_event_target_as = KMTtakepac_642_owner
					}
				}
				else = {
					642 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_642_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				727 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					727 = {
						owner = { is_puppet = no }
					}
				}
				727 = {
					owner = {
						save_event_target_as = KMTtakepac_727_owner
					}
				}
				else = {
					727 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_727_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				630 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					630 = {
						owner = { is_puppet = no }
					}
				}
				630 = {
					owner = {
						save_event_target_as = KMTtakepac_630_owner
					}
				}
				else = {
					630 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_630_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				629 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					629 = {
						owner = { is_puppet = no }
					}
				}
				629 = {
					owner = {
						save_event_target_as = KMTtakepac_629_owner
					}
				}
				else = {
					629 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_629_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				643 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					643 = {
						owner = { is_puppet = no }
					}
				}
				643 = {
					owner = {
						save_event_target_as = KMTtakepac_643_owner
					}
				}
				else = {
					643 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_643_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				726 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					726 = {
						owner = { is_puppet = no }
					}
				}
				726 = {
					owner = {
						save_event_target_as = KMTtakepac_726_owner
					}
				}
				else = {
					726 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_726_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				641 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					641 = {
						owner = { is_puppet = no }
					}
				}
				641 = {
					owner = {
						save_event_target_as = KMTtakepac_641_owner
					}
				}
				else = {
					641 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_641_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				636 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					636 = {
						owner = { is_puppet = no }
					}
				}
				636 = {
					owner = {
						save_event_target_as = KMTtakepac_636_owner
					}
				}
				else = {
					636 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_636_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				635 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					635 = {
						owner = { is_puppet = no }
					}
				}
				635 = {
					owner = {
						save_event_target_as = KMTtakepac_635_owner
					}
				}
				else = {
					635 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_635_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				737 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					737 = {
						owner = { is_puppet = no }
					}
				}
				737 = {
					owner = {
						save_event_target_as = KMTtakepac_737_owner
					}
				}
				else = {
					737 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_737_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				634 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					634 = {
						owner = { is_puppet = no }
					}
				}
				634 = {
					owner = {
						save_event_target_as = KMTtakepac_634_owner
					}
				}
				else = {
					634 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_634_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				523 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					523 = {
						owner = { is_puppet = no }
					}
				}
				523 = {
					owner = {
						save_event_target_as = KMTtakepac_523_owner
					}
				}
				else = {
					523 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_523_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				517 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					517 = {
						owner = { is_puppet = no }
					}
				}
				517 = {
					owner = {
						save_event_target_as = KMTtakepac_517_owner
					}
				}
				else = {
					517 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_517_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				285 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					285 = {
						owner = { is_puppet = no }
					}
				}
				285 = {
					owner = {
						save_event_target_as = KMTtakepac_285_owner
					}
				}
				else = {
					285 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_285_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				521 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					521 = {
						owner = { is_puppet = no }
					}
				}
				521 = {
					owner = {
						save_event_target_as = KMTtakepac_521_owner
					}
				}
				else = {
					521 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_521_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				674 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					674 = {
						owner = { is_puppet = no }
					}
				}
				674 = {
					owner = {
						save_event_target_as = KMTtakepac_674_owner
					}
				}
				else = {
					674 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_674_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				519 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					519 = {
						owner = { is_puppet = no }
					}
				}
				519 = {
					owner = {
						save_event_target_as = KMTtakepac_519_owner
					}
				}
				else = {
					519 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_519_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				522 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					522 = {
						owner = { is_puppet = no }
					}
				}
				522 = {
					owner = {
						save_event_target_as = KMTtakepac_522_owner
					}
				}
				else = {
					522 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_522_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				520 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					520 = {
						owner = { is_puppet = no }
					}
				}
				520 = {
					owner = {
						save_event_target_as = KMTtakepac_520_owner
					}
				}
				else = {
					520 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_520_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				518 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					518 = {
						owner = { is_puppet = no }
					}
				}
				518 = {
					owner = {
						save_event_target_as = KMTtakepac_518_owner
					}
				}
				else = {
					518 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_518_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				284 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					284 = {
						owner = { is_puppet = no }
					}
				}
				284 = {
					owner = {
						save_event_target_as = KMTtakepac_284_owner
					}
				}
				else = {
					284 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_284_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				723 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					723 = {
						owner = { is_puppet = no }
					}
				}
				723 = {
					owner = {
						save_event_target_as = KMTtakepac_723_owner
					}
				}
				else = {
					723 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_723_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				669 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					669 = {
						owner = { is_puppet = no }
					}
				}
				669 = {
					owner = {
						save_event_target_as = KMTtakepac_669_owner
					}
				}
				else = {
					669 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakepac_669_owner
							}
						}
					}
				}
			}
		}
	}
}

KMT_take_SEA_wargoal = {
	custom_effect_tooltip = KMT_take_SEA_tt
	hidden_effect = {
		if = {
			limit = {
				524 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					524 = {
						owner = { is_puppet = no }
					}
				}
				524 = {
					owner = {
						save_event_target_as = KMTtakeSEA_524_owner
					}
				}
				else = {
					524 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_524_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				593 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					593 = {
						owner = { is_puppet = no }
					}
				}
				593 = {
					owner = {
						save_event_target_as = KMTtakeSEA_593_owner
					}
				}
				else = {
					593 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_593_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				592 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					592 = {
						owner = { is_puppet = no }
					}
				}
				592 = {
					owner = {
						save_event_target_as = KMTtakeSEA_592_owner
					}
				}
				else = {
					592 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_592_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				591 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					591 = {
						owner = { is_puppet = no }
					}
				}
				591 = {
					owner = {
						save_event_target_as = KMTtakeSEA_591_owner
					}
				}
				else = {
					591 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_591_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				594 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					594 = {
						owner = { is_puppet = no }
					}
				}
				594 = {
					owner = {
						save_event_target_as = KMTtakeSEA_594_owner
					}
				}
				else = {
					594 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_594_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				599 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					599 = {
						owner = { is_puppet = no }
					}
				}
				599 = {
					owner = {
						save_event_target_as = KMTtakeSEA_599_owner
					}
				}
				else = {
					599 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_599_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				671 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					671 = {
						owner = { is_puppet = no }
					}
				}
				671 = {
					owner = {
						save_event_target_as = KMTtakeSEA_671_owner
					}
				}
				else = {
					671 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_671_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				286 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					286 = {
						owner = { is_puppet = no }
					}
				}
				286 = {
					owner = {
						save_event_target_as = KMTtakeSEA_286_owner
					}
				}
				else = {
					286 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_286_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				286 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					286 = {
						owner = { is_puppet = no }
					}
				}
				286 = {
					owner = {
						save_event_target_as = KMTtakeSEA_286_owner
					}
				}
				else = {
					286 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_286_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				670 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					670 = {
						owner = { is_puppet = no }
					}
				}
				670 = {
					owner = {
						save_event_target_as = KMTtakeSEA_670_owner
					}
				}
				else = {
					670 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_670_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				741 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					741 = {
						owner = { is_puppet = no }
					}
				}
				741 = {
					owner = {
						save_event_target_as = KMTtakeSEA_741_owner
					}
				}
				else = {
					741 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_741_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				289 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					289 = {
						owner = { is_puppet = no }
					}
				}
				289 = {
					owner = {
						save_event_target_as = KMTtakeSEA_289_owner
					}
				}
				else = {
					289 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_289_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				724 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					724 = {
						owner = { is_puppet = no }
					}
				}
				724 = {
					owner = {
						save_event_target_as = KMTtakeSEA_724_owner
					}
				}
				else = {
					724 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_724_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				336 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					336 = {
						owner = { is_puppet = no }
					}
				}
				336 = {
					owner = {
						save_event_target_as = KMTtakeSEA_336_owner
					}
				}
				else = {
					336 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_336_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				672 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					672 = {
						owner = { is_puppet = no }
					}
				}
				672 = {
					owner = {
						save_event_target_as = KMTtakeSEA_672_owner
					}
				}
				else = {
					672 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_672_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				333 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					333 = {
						owner = { is_puppet = no }
					}
				}
				333 = {
					owner = {
						save_event_target_as = KMTtakeSEA_333_owner
					}
				}
				else = {
					333 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_333_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				334 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					334 = {
						owner = { is_puppet = no }
					}
				}
				334 = {
					owner = {
						save_event_target_as = KMTtakeSEA_334_owner
					}
				}
				else = {
					334 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_334_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				335 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					335 = {
						owner = { is_puppet = no }
					}
				}
				335 = {
					owner = {
						save_event_target_as = KMTtakeSEA_335_owner
					}
				}
				else = {
					335 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_335_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				626 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					626 = {
						owner = { is_puppet = no }
					}
				}
				626 = {
					owner = {
						save_event_target_as = KMTtakeSEA_626_owner
					}
				}
				else = {
					626 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_626_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				623 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					623 = {
						owner = { is_puppet = no }
					}
				}
				623 = {
					owner = {
						save_event_target_as = KMTtakeSEA_623_owner
					}
				}
				else = {
					623 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_623_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				327 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					327 = {
						owner = { is_puppet = no }
					}
				}
				327 = {
					owner = {
						save_event_target_as = KMTtakeSEA_327_owner
					}
				}
				else = {
					327 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_327_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				624 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					624 = {
						owner = { is_puppet = no }
					}
				}
				624 = {
					owner = {
						save_event_target_as = KMTtakeSEA_624_owner
					}
				}
				else = {
					624 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_624_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				628 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					628 = {
						owner = { is_puppet = no }
					}
				}
				628 = {
					owner = {
						save_event_target_as = KMTtakeSEA_628_owner
					}
				}
				else = {
					628 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_628_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				625 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					625 = {
						owner = { is_puppet = no }
					}
				}
				625 = {
					owner = {
						save_event_target_as = KMTtakeSEA_625_owner
					}
				}
				else = {
					625 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_625_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				627 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					627 = {
						owner = { is_puppet = no }
					}
				}
				627 = {
					owner = {
						save_event_target_as = KMTtakeSEA_627_owner
					}
				}
				else = {
					627 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_627_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				673 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					673 = {
						owner = { is_puppet = no }
					}
				}
				673 = {
					owner = {
						save_event_target_as = KMTtakeSEA_673_owner
					}
				}
				else = {
					673 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_673_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				668 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					668 = {
						owner = { is_puppet = no }
					}
				}
				668 = {
					owner = {
						save_event_target_as = KMTtakeSEA_668_owner
					}
				}
				else = {
					668 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_668_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				669 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					669 = {
						owner = { is_puppet = no }
					}
				}
				669 = {
					owner = {
						save_event_target_as = KMTtakeSEA_669_owner
					}
				}
				else = {
					669 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_669_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				667 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					667 = {
						owner = { is_puppet = no }
					}
				}
				667 = {
					owner = {
						save_event_target_as = KMTtakeSEA_667_owner
					}
				}
				else = {
					667 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_667_owner
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				721 = {
					owner = {
						NOT = { 
							tag = ROOT									
							is_puppet_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					721 = {
						owner = { is_puppet = no }
					}
				}
				721 = {
					owner = {
						save_event_target_as = KMTtakeSEA_721_owner
					}
				}
				else = {
					721 = {
						owner = { 
							overlord = { 
								save_event_target_as = KMTtakeSEA_721_owner
							}
						}
					}
				}
			}
		}
	}
}


KMT_pro_jap_focus_civil_war = {
	if = {
		limit = {
			fascism < 0.2
		}
		start_civil_war = {
			ideology = neutrality
			capital = 980
			size = 0.8
			keep_unit_leaders_trigger = { 
				OR = {
					has_unit_leader_flag = KMT_will_stay_after_pro_jap_coup 
					has_unit_leader_flag = WJW_potential_defectors 
				}
			}
			ruling_party = fascism
		}
	}else_if = {
		limit = {
			fascism < 0.3
		}
		start_civil_war = {
			ideology = neutrality
			capital = 980
			size = 0.75
			keep_unit_leaders_trigger = { 
				OR = {
					has_unit_leader_flag = KMT_will_stay_after_pro_jap_coup 
					has_unit_leader_flag = WJW_potential_defectors 
				}
			}
			ruling_party = fascism
		}
	}else_if = {
		limit = {
			fascism < 0.4
		}
		start_civil_war = {
			ideology = neutrality
			capital = 980
			size = 0.7
			keep_unit_leaders_trigger = { 
				OR = {
					has_unit_leader_flag = KMT_will_stay_after_pro_jap_coup 
					has_unit_leader_flag = WJW_potential_defectors 
				}
			}
			ruling_party = fascism
		}
	}else_if = {
		limit = {
			fascism < 0.5
		}
		start_civil_war = {
			ideology = neutrality
			capital = 980
			size = 0.65
			keep_unit_leaders_trigger = { 
				OR = {
					has_unit_leader_flag = KMT_will_stay_after_pro_jap_coup 
					has_unit_leader_flag = WJW_potential_defectors 
				}
			}
			ruling_party = fascism
		}
	}else_if = {
		limit = {
			fascism < 0.6
		}
		start_civil_war = {
			ideology = neutrality
			capital = 980
			size = 0.6
			keep_unit_leaders_trigger = { 
				OR = {
					has_unit_leader_flag = KMT_will_stay_after_pro_jap_coup 
					has_unit_leader_flag = WJW_potential_defectors 
				}
			}
			ruling_party = fascism
		}
	}else_if = {
		limit = {
			fascism < 0.7
		}
		start_civil_war = {
			ideology = neutrality
			capital = 980
			size = 0.55
			keep_unit_leaders_trigger = { 
				OR = {
					has_unit_leader_flag = KMT_will_stay_after_pro_jap_coup 
					has_unit_leader_flag = WJW_potential_defectors 
				}
			}
			ruling_party = fascism
		}
	}else = {
		start_civil_war = {
			ideology = neutrality
			capital = 980
			size = 0.5
			keep_unit_leaders_trigger = { 
				OR = {
					has_unit_leader_flag = KMT_will_stay_after_pro_jap_coup 
					has_unit_leader_flag = WJW_potential_defectors 
				}
			}
			ruling_party = fascism
		}
	}
}

KMT_pro_jap_finish = {
	clr_global_flag = liangguang_incident
	clr_global_flag = cks_held
	set_country_flag = KMT_pro_japanese_coup
	hidden_effect = {
		if = {
			limit = {
				NOT = {
					has_country_flag = KMT_completed_pro_jap_focus
				}
			}
			unlock_national_focus = KMT_support_pro_japanese_faction
		}
	}
	every_country = {
		limit = {
			is_puppet_of = ROOT
		}
		ROOT = {
			end_puppet = PREV
		}
	}
	if = {
		limit = {
			has_idea = KMT_pro_jap_propaganda
		}
		remove_ideas = KMT_pro_jap_propaganda
	}
	if = {
		limit = {
			has_idea = KMT_pro_jap_propaganda_2
		}
		remove_ideas = KMT_pro_jap_propaganda_2
	}
	set_party_name = { ideology = fascism long_name = KMT_wjw name = KMT_wjw }
	CHI_wang_jingwei = { promote_character = { ideology = pan_asianism }}
#	if = {
#		limit = {
#			has_country_leader = {
#				character = CHI_chiang_kaishek
#				ruling_only = yes
#			}
#		}
#		if = {
#			limit = {
#				OR = {
#					AND = {
#						has_country_flag = {
#							flag = KMT_pro_jap_action_count
#							value > 0
#						}
#						has_country_flag = {
#							flag = KMT_pro_jap_action_count
#							value < 3
#						}
#					}
#					has_country_flag = KMT_xian_CHI_kill_chiang
#				}
#			}
#		}
#	}
#	if = {
#		limit = { has_unit_leader = 1001 }
#		remove_unit_leader = 1001
#	}
	KMT_pro_jap_focus_civil_war = yes
	hidden_effect = {
		every_state = {
			limit = {
				is_core_of = ROOT
			}
			add_core_of = HYQ
		}
		random_country = {
			limit = {
				original_tag = event_target:KMT_central_gov_tag
				NOT = { tag = event_target:KMT_central_gov_tag }
				has_civil_war = yes
			}
			every_unit_leader = {	
				set_character_flag = KMT_pro_jap_civil_war_sn_flag
				set_nationality = HYQ
			}
			every_character = {
				limit = { has_character_flag = KMT_pro_jap_civil_war_sn_flag }
				set_nationality = HYQ
				clr_character_flag = KMT_pro_jap_civil_war_sn_flag
			}
			every_state = {
				limit = {
					is_core_of = PREV
				}
				remove_core_of = PREV
			}
		} 
		every_owned_state = {
			limit = {
				is_capital = no
			}
			HYQ = {
				transfer_state = PREV
			}
		}
		HYQ = {
			country_event = { id = kmt.431 }
			declare_war_on = {
				target = ROOT
				type = civil_war
			}
		}
		transfer_state = 938
		if = {
			limit = {
				has_country_flag = {
					flag = KMT_pro_jap_action_count
					value > 0
				}
				598 = {
					owner = { tag = HYQ }
				}
			}
			transfer_state = 598
		}
		if = {
			limit = {
				has_country_flag = {
					flag = KMT_pro_jap_action_count
					value > 1
				}
			}
			if = {
				limit = {
					606 = {
						owner = { tag = HYQ }
					}
				}
				transfer_state = 606
			}
			if = {
				limit = {
					749 = {
						owner = { tag = HYQ }
					}
				}
				transfer_state = 749
			}
		}
		if = {
			limit = {
				has_country_flag = {
					flag = KMT_pro_jap_action_count
					value > 2
				}
				596 = {
					owner = { tag = HYQ }
				}
			}
			transfer_state = 596
		}
		every_unit_leader = {
			limit = {
				NOT = {
					has_unit_leader_flag = KMT_will_stay_after_pro_jap_coup
				}
			}
			set_nationality = HYQ
			set_character_flag = KMT_pro_jap_civil_war_sn_flag
		}
		every_character = {
			limit = { has_character_flag = KMT_pro_jap_civil_war_sn_flag }
			set_nationality = HYQ
			clr_character_flag = KMT_pro_jap_civil_war_sn_flag
		}
	}
	custom_effect_tooltip = KMT_coup_new_line_tt
	HYQ = {
		set_capital = { state = 613 }
		if = {
			limit = {
				event_target:KMT_central_gov_tag = { has_country_flag = KMT_pro_jap_bribe_officials }
			}
			add_stability = -0.1
			add_war_support = -0.05
		}
		if = {
			limit = {
				event_target:KMT_central_gov_tag = { has_country_flag = KMT_pro_jap_infiltrated_gov }
			}
			add_timed_idea = {
				idea = KMT_pro_jap_infiltrated_gov_idea
				days = 120
			}
		}
		if = {
			limit = {
				event_target:KMT_central_gov_tag = { has_country_flag = KMT_pro_jap_contacted_hyq }
			}
			add_timed_idea = {
				idea = KMT_pro_jap_contacted_hyq_idea
				days = 120
			}
		}
	}
	custom_effect_tooltip = KMT_coup_new_line_tt
	if = {
		limit = {
			has_country_flag = KMT_pro_jap_bribe_officials
		}
		set_stability = 0.45
		add_political_power = 75
		else = {
			set_stability = 0.4
		}
	}
	if = {
		limit = {
			has_country_flag = KMT_pro_jap_contacted_hyq
		}
		custom_effect_tooltip = KMT_pro_jap_contacted_hyq_more_troops_tt
		hidden_effect = {
			division_template = {
				name = "Ho Ying-chin Pu"	
				regiments = { 
					infantry = { x = 0 y = 0 } 
					infantry = { x = 0 y = 1 } 
					infantry = { x = 0 y = 2 } 
					infantry = { x = 1 y = 0 } 
					infantry = { x = 1 y = 1 } 
					infantry = { x = 1 y = 2 } 
				}
			}
			random_owned_controlled_state = {
				prioritize = { 613 }
				create_unit = { 
					division = "name = \"Ho Ying-chin Bu\" division_template = \"Ho Ying-chin Bu\" start_experience_factor = 0.25 start_equipment_factor = 0.9" 
					owner = event_target:KMT_central_gov_tag
				}
				create_unit = { 
					division = "name = \"Ho Ying-chin Bu\" division_template = \"Ho Ying-chin Bu\" start_experience_factor = 0.25 start_equipment_factor = 0.9" 
					owner = event_target:KMT_central_gov_tag
				}
			}
		}
	}
	set_war_support = 0.50
	
	custom_effect_tooltip = KMT_coup_new_line_tt
	if = {
		limit = {
			has_country_flag = {
				flag = KMT_pro_jap_action_count
				value < 1
			}
		}
		set_political_power = 50
		HYQ = {
			add_timed_idea = {
				idea = KMT_pro_jap_HYQ_penalty_unexpected
				days = 15
			}
		}
	}else_if = {
		limit = {
			has_country_flag = {
				flag = KMT_pro_jap_action_count
				value < 2
			}
		}
		set_political_power = 150
		HYQ = {
			add_timed_idea = {
				idea = KMT_pro_jap_HYQ_penalty_unexpected_2
				days = 45
			}
		}
	}else_if = {
		limit = {
			has_country_flag = {
				flag = KMT_pro_jap_action_count
				value < 3
			}
		}
		set_political_power = 250
		add_stability = -0.05
	}else_if = {
		limit = {
			has_country_flag = {
				flag = KMT_pro_jap_action_count
				value < 4
			}
		}
		set_political_power = 350
		add_timed_idea = {
			idea = KMT_pro_jap_ROOT_penalty
			days = 90
		}
		add_stability = -0.1
	}
	hidden_effect = {
		set_rule = { can_join_factions = yes }
		every_character = {
			limit = {
				NOT = { has_character_flag = WJW_potential_defectors }
				NOT = { has_character_flag = WJW_hyq_pro_jap_flag }
			}
			set_nationality = HYQ
		}
		if = { 
			limit = { has_idea = german_advisors }
			HYQ = { add_ideas = german_advisors }
		}
		if = { 
			limit = { has_idea = KMT_soong_tv }
			HYQ = { add_ideas = KMT_soong_tv }
		}
		if = { 
			limit = { has_idea = KMT_hhk }
			HYQ = { add_ideas = KMT_hhk }
		}
		if = { 
			limit = { has_idea = KMT_falkenhausen_advisor_theorist }
			HYQ = { add_ideas = KMT_falkenhausen_advisor_theorist }
		}
		remove_opinion_modifier = {
			modifier = hostile_status
			target = JAP
		}
		JAP = {
			remove_opinion_modifier = {
				modifier = hostile_status
				target = ROOT
			}
		}
		set_politics = {
			ruling_party = fascism
		}
		set_popularities = {
			fascism = 95
			democratic = 2
			neutrality = 3
		}
		if = {
			limit = {
				PRC = { 
					exists = yes
					NOT = {
						OR = {
							has_war_together_with = event_target:KMT_central_gov_tag
							has_war_together_with = HYQ
							is_in_faction_with = event_target:KMT_central_gov_tag
							is_in_faction_with = HYQ
							has_war_with = event_target:KMT_central_gov_tag
							has_war_with = HYQ
						}
					}
				}
			}
			PRC = { country_event = { id = kmt.720 hours = 5 }}
		}
		if = {
			limit = {
				JAP = { 
					exists = yes
					NOT = {
						OR = {
							has_war_together_with = event_target:KMT_central_gov_tag
							has_war_together_with = HYQ
							is_in_faction_with = event_target:KMT_central_gov_tag
							is_in_faction_with = HYQ
							has_war_with = event_target:KMT_central_gov_tag
							has_war_with = HYQ
						}
					}
				}
			}
			JAP = { country_event = { id = kmt.720 hours = 5 }}
		}
		every_country = {
			limit = { 
				has_idea = cg_warlords 
				NOT = {
					OR = {
						has_war_together_with = event_target:KMT_central_gov_tag
						has_war_together_with = HYQ
						is_in_faction_with = event_target:KMT_central_gov_tag
						is_in_faction_with = HYQ
						has_war_with = event_target:KMT_central_gov_tag
						has_war_with = HYQ
					}
				}
				NOT = {
					is_puppet_of = JAP
					is_puppet_of = event_target:KMT_central_gov_tag
					is_puppet_of = HYQ
				}
			}
			country_event = { id = kmt.720 hours = 5 }
		}
		CHI = { CHI_feng_yuxiang = { set_nationality = HYQ }}
		CHI = { CHI_lin_sen = { set_nationality = HYQ }}
		if = {
			limit = {
				OR = {
					AND = {
						has_country_flag = {
							flag = KMT_pro_jap_action_count
							value > 0
						}
						has_country_flag = {
							flag = KMT_pro_jap_action_count
							value < 3
						}
					}
					event_target:KMT_central_gov_tag = {
						has_country_flag = KMT_xian_CHI_kill_chiang
					}
				}
				HYQ = {
					has_character = CHI_chiang_kaishek
				}
			}
			HYQ = {
				retire_character = CHI_chiang_kaishek
				CHI_lin_sen = { promote_character = { ideology = the_peoples_tutelage }}
			}
		}
		if = {
			limit = {
				has_country_flag = KMT_pro_jap_local_militias
			}
			if = {
				limit = {
					has_country_flag = {
						flag = KMT_pro_jap_action_count
						value < 2
					}
				}
				load_oob = "CHI_support_pro_jap_1_action"
				else = {
					if = {
						limit = {
							has_country_flag = {
								flag = KMT_pro_jap_action_count
								value < 3
							}
						}
						load_oob = "CHI_support_pro_jap_2_action"
						if = {
							limit = {
								has_country_flag = {
									flag = KMT_pro_jap_action_count
									value < 4
								}
							}
							load_oob = "CHI_support_pro_jap_3_action"
						}
					}
				}
			}
		}
	}
	hidden_effect = {
		every_state = {
			limit = {
				is_core_of = ROOT
			}
			add_core_of = HYQ
			add_claim_by = ROOT
			if = {
				limit = {
					NOT = { is_owned_by = ROOT }
				}
				remove_core_of = ROOT
			}
		}
		clear_global_event_target = KMT_central_gov_tag
		remove_dynamic_modifier = { modifier = cu_warlords_count }
		HYQ = { 
			save_global_event_target_as = KMT_central_gov_tag
			add_dynamic_modifier = { modifier = cu_warlords_count }
		}
		if = {
			limit = {
				NOT = { has_global_flag = KMT_disable_power_struggle_mechanics }
			}
			add_stability = 0.5
			remove_dynamic_modifier = { modifier = KMT_cg_modifier }
			HYQ = { 
				set_stability = 0
				add_dynamic_modifier = { modifier = KMT_cg_modifier }
			}
		}
		set_cosmetic_tag = KMTWJW
	}
	hidden_effect = { 
		if = { 
			limit = { NOT = { has_country_flag = KMT_pro_jap_news_event_fired }} 
			set_country_flag = KMT_pro_jap_news_event_fired
			news_event = { id = kns.56 }
		}
		every_state = {
			teleport_armies = { 
				to_state_array = owned_states 
				limit = { tag = CHI }
			}
		}
		every_country = {
			limit = { has_character = CHI_wang_jingwei }
			CHI_wang_jingwei = { set_nationality = CHI }
		}
		CHI_wang_jingwei = { promote_character = { ideology = pan_asianism }}
		every_country = {
			limit = {
				has_military_access_to = ROOT
			}
			diplomatic_relation = { relation = military_access country = ROOT active = no }
		}
		every_country = {
			limit = {
				ROOT = { gives_military_access_to = PREV }
			}
			ROOT = { diplomatic_relation = { relation = military_access country = PREV active = no }}
		}
		every_country = {
			limit = { 
				has_offensive_war_with = ROOT 
				NOT = { tag = HYQ }
			}
			declare_war_on = { target = HYQ type = topple_government }
			white_peace = ROOT
		}
		every_country = {
			limit = { 
				has_defensive_war_with = ROOT 
				NOT = { tag = HYQ }
			}
			HYQ = { declare_war_on = { target = PREV type = puppet_wargoal_focus }}
			white_peace = ROOT
		}
	}
}

#kmt.481 is success, kmt.480 is civil war
KMT_red_coup_effect = {
	clr_global_flag = liangguang_incident
	clr_global_flag = cks_held
	set_country_flag = KMT_red_coup_finish
	hidden_effect = {
		every_country = {
			limit = {
				is_puppet_of = ROOT
			}
			ROOT = {
				end_puppet = PREV
			}
		}
	}
	if = {
		limit = {
			communism < 0.1
		}
		country_event = { id = kmt.480 }
		if = {
			limit = {
				has_government = neutrality
			}
			start_civil_war = {
				ideology = neutrality
				ruling_party = communism
				keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
				size = 0.9
			}
		}else_if = {
			limit = {
				has_government = democratic
			}
			start_civil_war = {
				ideology = democratic
				ruling_party = communism
				keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
				size = 0.9
			}
		}else_if = {
			limit = {
				has_government = fascism
			}
			start_civil_war = {
				ideology = fascism
				ruling_party = communism
				keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
				size = 0.9
			}
		}
		if = {
			limit = {
				has_global_flag = KMT_PRC_agrees_to_work_with_us
			}
			add_ideas = KMT_peasants_revolution_1
		}else = {
			add_ideas = KMT_revolution_1
		}
	}else_if = {
		limit = {
			communism < 0.2
		}
		random_list = {
			90 = {
				country_event = { id = kmt.480 }
				if = {
					limit = {
						has_government = neutrality
					}
					start_civil_war = {
						ideology = neutrality
						ruling_party = communism
						keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
						size = 0.75
					}
				}else = {
					if = {
						limit = {
							has_government = democratic
						}
						start_civil_war = {
							ideology = democratic
							ruling_party = communism
							keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
							size = 0.75
						}
					}else = {
						if = {
							limit = {
								has_government = fascism
							}
							start_civil_war = {
								ideology = fascism
								ruling_party = communism
								keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
								size = 0.75
							}
						}
					}
				}
				if = {
					limit = {
						has_global_flag = KMT_PRC_agrees_to_work_with_us
					}
					add_ideas = KMT_peasants_revolution_2
				}else = {
					add_ideas = KMT_revolution_2
				}
				custom_effect_tooltip = KMT_coup_new_line_tt
			}
			10 = {
				country_event = { id = kmt.481 }
				set_politics = {
					ruling_party = communism
				}
				add_timed_idea = {
					idea = KMT_triumphant_revolution
					days = 720
				}
				custom_effect_tooltip = KMT_coup_new_line_tt
			}
		}
	}else_if = {
		limit = {
			communism < 0.3
		}
		random_list = {
			80 = {
				country_event = { id = kmt.480 }
				if = {
					limit = {
						has_government = neutrality
					}
					start_civil_war = {
						ideology = neutrality
						ruling_party = communism
						keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
						size = 0.65
					}
				}else = {
					if = {
						limit = {
							has_government = democratic
						}
						start_civil_war = {
							ideology = democratic
							ruling_party = communism
							keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
							size = 0.65
						}
					}else = {
						if = {
							limit = {
								has_government = fascism
							}
							start_civil_war = {
								ideology = fascism
								ruling_party = communism
								keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
								size = 0.65
							}
						}
					}
				}
				if = {
					limit = {
						has_global_flag = KMT_PRC_agrees_to_work_with_us
					}
					add_ideas = KMT_peasants_revolution_3
				}else = {
					add_ideas = KMT_revolution_3
				}
				custom_effect_tooltip = KMT_coup_new_line_tt
			}
			20 = {
				country_event = { id = kmt.481 }
				set_politics = {
					ruling_party = communism
				}
				add_timed_idea = {
					idea = KMT_triumphant_revolution
					days = 720
				}
				custom_effect_tooltip = KMT_coup_new_line_tt
			}
		}
	}else_if = {
		limit = {
			communism < 0.4
		}
		random_list = {
			70 = {
				country_event = { id = kmt.480 }
				if = {
					limit = {
						has_government = neutrality
					}
					start_civil_war = {
						ideology = neutrality
						ruling_party = communism
						keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
						size = 0.55
					}
				}else = {
					if = {
						limit = {
							has_government = democratic
						}
						start_civil_war = {
							ideology = democratic
							ruling_party = communism
							keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
							size = 0.55
						}
					}else = {
						if = {
							limit = {
								has_government = fascism
							}
							start_civil_war = {
								ideology = fascism
								ruling_party = communism
								keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
								size = 0.55
							}
						}
					}
				}
				if = {
					limit = {
						has_global_flag = KMT_PRC_agrees_to_work_with_us
					}
					add_ideas = KMT_peasants_revolution_4
				}else = {
					add_ideas = KMT_revolution_4
				}
				custom_effect_tooltip = KMT_coup_new_line_tt
			}
			30 = {
				country_event = { id = kmt.481 }
				set_politics = {
					ruling_party = communism
				}
				add_timed_idea = {
					idea = KMT_triumphant_revolution
					days = 720
				}
				custom_effect_tooltip = KMT_coup_new_line_tt
			}
		}
	}else_if = {
		limit = {
			communism < 0.5
		}
		random_list = {
			60 = {
				country_event = { id = kmt.480 }
				if = {
					limit = {
						has_government = neutrality
					}
					start_civil_war = {
						ideology = neutrality
						ruling_party = communism
						keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
						size = 0.45
					}
				}else = {
					if = {
						limit = {
							has_government = democratic
						}
						start_civil_war = {
							ideology = democratic
							ruling_party = communism
							keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
							size = 0.45
						}
					}else = {
						if = {
							limit = {
								has_government = fascism
							}
							start_civil_war = {
								ideology = fascism
								ruling_party = communism
								keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
								size = 0.45
							}
						}
					}
				}
				if = {
					limit = {
						has_global_flag = KMT_PRC_agrees_to_work_with_us
					}
					add_ideas = KMT_peasants_revolution_5
				}else = {
					add_ideas = KMT_revolution_5
				}
				custom_effect_tooltip = KMT_coup_new_line_tt
			}
			40 = {
				country_event = { id = kmt.481 }
				set_politics = {
					ruling_party = communism
				}
				add_timed_idea = {
					idea = KMT_triumphant_revolution
					days = 720
				}
				custom_effect_tooltip = KMT_coup_new_line_tt
			}
		}
	}else_if = {
		limit = {
			communism < 0.6
		}
		random_list = {
			50 = {
				country_event = { id = kmt.480 }
				if = {
					limit = {
						has_government = neutrality
					}
					start_civil_war = {
						ideology = neutrality
						ruling_party = communism
						keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
						size = 0.35
					}
				}else = {
					if = {
						limit = {
							has_government = democratic
						}
						start_civil_war = {
							ideology = democratic
							ruling_party = communism
							keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
							size = 0.35
						}
					}else = {
						if = {
							limit = {
								has_government = fascism
							}
							start_civil_war = {
								ideology = fascism
								ruling_party = communism
								keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
								size = 0.35
							}
						}
					}
				}
				if = {
					limit = {
						has_global_flag = KMT_PRC_agrees_to_work_with_us
					}
					add_ideas = KMT_peasants_revolution_6
				}else = {
					add_ideas = KMT_revolution_6
				}
				custom_effect_tooltip = KMT_coup_new_line_tt
			}
			50 = {
				country_event = { id = kmt.481 }
				set_politics = {
					ruling_party = communism
				}
				add_timed_idea = {
					idea = KMT_triumphant_revolution
					days = 720
				}
				custom_effect_tooltip = KMT_coup_new_line_tt
			}
		}
	}else_if = {
		limit = {
			communism < 0.7
		}
		random_list = {
			35 = {
				country_event = { id = kmt.480 }
				if = {
					limit = {
						has_government = neutrality
					}
					start_civil_war = {
						ideology = neutrality
						ruling_party = communism
						keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
						size = 0.25
					}
				}else = {
					if = {
						limit = {
							has_government = democratic
						}
						start_civil_war = {
							ideology = democratic
							ruling_party = communism
							keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
							size = 0.25
						}
					}else = {
						if = {
							limit = {
								has_government = fascism
							}
							start_civil_war = {
								ideology = fascism
								ruling_party = communism
								keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
								size = 0.25
							}
						}
					}
				}
				if = {
					limit = {
						has_global_flag = KMT_PRC_agrees_to_work_with_us
					}
					add_ideas = KMT_peasants_revolution_7
				}else = {
					add_ideas = KMT_revolution_7
				}
				custom_effect_tooltip = KMT_coup_new_line_tt
			}
			65 = {
				country_event = { id = kmt.481 }
				set_politics = {
					ruling_party = communism
				}
				add_timed_idea = {
					idea = KMT_triumphant_revolution
					days = 720
				}
				custom_effect_tooltip = KMT_coup_new_line_tt
			}
		}
	}else_if = {
		limit = {
			communism < 0.8
		}
		random_list = {
			20 = {
				country_event = { id = kmt.480 }
				if = {
					limit = {
						has_government = neutrality
					}
					start_civil_war = {
						ideology = neutrality
						ruling_party = communism
						keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
						size = 0.25
					}
				}else = {
					if = {
						limit = {
							has_government = democratic
						}
						start_civil_war = {
							ideology = democratic
							ruling_party = communism
							keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
							size = 0.25
						}
					}else = {
						if = {
							limit = {
								has_government = fascism
							}
							start_civil_war = {
								ideology = fascism
								ruling_party = communism
								keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
								size = 0.25
							}
						}
					}
				}
				if = {
					limit = {
						has_global_flag = KMT_PRC_agrees_to_work_with_us
					}
					add_ideas = KMT_peasants_revolution_7
				}else = {
					add_ideas = KMT_revolution_7
				}
				custom_effect_tooltip = KMT_coup_new_line_tt
			}
			80 = {
				country_event = { id = kmt.481 }
				set_politics = {
					ruling_party = communism
				}
				add_timed_idea = {
					idea = KMT_triumphant_revolution
					days = 720
				}
				custom_effect_tooltip = KMT_coup_new_line_tt
			}
		}
	}else_if = {
		limit = {
			communism < 0.9
		}
		random_list = {
			10 = {
				country_event = { id = kmt.480 }
				if = {
					limit = {
						has_government = neutrality
					}
					start_civil_war = {
						ideology = neutrality
						ruling_party = communism
						keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
						size = 0.25
					}
				}else = {
					if = {
						limit = {
							has_government = democratic
						}
						start_civil_war = {
							ideology = democratic
							ruling_party = communism
							keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
							size = 0.25
						}
					}else = {
						if = {
							limit = {
								has_government = fascism
							}
							start_civil_war = {
								ideology = fascism
								ruling_party = communism
								keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
								size = 0.25
							}
						}
					}
				}
				if = {
					limit = {
						has_global_flag = KMT_PRC_agrees_to_work_with_us
					}
					add_ideas = KMT_peasants_revolution_7
				}else = {
					add_ideas = KMT_revolution_7
				}
				custom_effect_tooltip = KMT_coup_new_line_tt
			}
			90 = {
				country_event = { id = kmt.481 }
				set_politics = {
					ruling_party = communism
				}
				add_timed_idea = {
					idea = KMT_triumphant_revolution
					days = 720
				}
				custom_effect_tooltip = KMT_coup_new_line_tt
			}
		}
	}else = {
		country_event = { id = kmt.481 }
		set_politics = {
			ruling_party = communism
		}
		add_timed_idea = {
			idea = KMT_triumphant_revolution
			days = 720
		}
	}
	add_popularity = {
		ideology = communism
		popularity = 0.95
	}
	if = {
		limit = {
			has_global_flag = KMT_coup_more_pp
		}
		add_political_power = 200
	}
	if = {
		limit = {
			has_global_flag = KMT_coup_chen_duxiu_leader
		}
		set_party_name = { ideology = communism long_name = KMT_new_cpc name = KMT_new_cpc_short }
		KMT_chen_duxiu = { promote_character = { ideology = leninism }}
	}
	if = {
		limit = {
			has_global_flag = KMT_coup_get_reinforcements
		}
		division_template = {
			name = "Chung-kung Yan-chn"
			regiments = {
				irregular_infantry = { x = 0 y = 0 }
				irregular_infantry = { x = 0 y = 1 } 
				irregular_infantry = { x = 1 y = 0 }
				irregular_infantry = { x = 1 y = 1 } 
			}
		}
		random_owned_controlled_state = {
			prioritize = { 613 }
			create_unit = { 
				division = "name = \"Chung-kung Yan-chn\" division_template = \"Chung-kung Yan-chn\" start_experience_factor = 0.3" 
				owner = event_target:KMT_central_gov_tag
			}
			create_unit = { 
				division = "name = \"Chung-kung Yan-chn\" division_template = \"Chung-kung Yan-chn\" start_experience_factor = 0.3" 
				owner = event_target:KMT_central_gov_tag
			}
		}
	}
	hidden_effect = {
		CHI_chiang_kaishek = { set_nationality = HYQ }
		CHI_wang_jingwei = { set_nationality = HYQ }
		CHI_xu_fulin = { set_nationality = HYQ }
		CHI_yan_jiagan = { set_nationality = HYQ }
		CHI_chiang_chingkuo = { set_nationality = HYQ }
		CHI_he_zhonghan = { set_nationality = HYQ }
		CHI_dai_li = { set_nationality = HYQ }
		CHI_chiang_weiguo = { set_nationality = HYQ }
		CHI_chen_shaokuan = { set_nationality = HYQ }
		KMT_chen_lifu = { set_nationality = HYQ }
		KMT_soong_tv = { set_nationality = HYQ }
		KMT_soong_ml = { set_nationality = HYQ }
		KMT_hhk = { set_nationality = HYQ }
		KMT_vkk = { set_nationality = HYQ }
		KMT_fsn = { set_nationality = HYQ }
		KMT_zhang_qun = { set_nationality = HYQ }
		KMT_dong_xianguang = { set_nationality = HYQ }
		CHI_shen_honglie = { set_nationality = HYQ }
		
		HYQ = {
			add_ideas = {
				german_advisors
				KMT_soong_tv
				KMT_hhk
				KMT_falkenhausen_advisor_theorist
			}
		}
		if = {
			limit = {
				has_idea = KMT_government_reforming
			}
			remove_ideas = KMT_government_reforming
		}
		every_state = {
			limit = {
				is_core_of = event_target:KMT_central_gov_tag
			}
			add_core_of = HYQ
		}
		if = {
			limit = {
				has_civil_war = yes
			}
			random_country = {
				limit = {
					original_tag = event_target:KMT_central_gov_tag
					NOT = { tag = event_target:KMT_central_gov_tag }
				}
				every_unit_leader = {
					#effect_tooltip = { set_nationality = HYQ }
					set_character_flag = KMT_pro_jap_civil_war_sn_flag
				}
				every_character = {
					limit = { has_character_flag = KMT_pro_jap_civil_war_sn_flag }
					set_nationality = HYQ
					clr_character_flag = KMT_pro_jap_civil_war_sn_flag
				}
				every_state = {
					limit = {
						is_core_of = PREV
					}
					remove_core_of = PREV
				}
				HYQ = {
					annex_country = {
						target = PREV
						transfer_troops = yes
					}
					declare_war_on = {
						target = ROOT
						type = civil_war
					}
					set_politics = {
						ruling_party = neutrality
						elections_allowed = no
					}
					set_popularities = {
						democratic = 5
						fascism = 5
						communism = 1
						neutrality =  89
					}
					if = {
						limit = {
							NOT = {
								has_global_flag = cks_killed_xian
							}
						}			
						CHI = { CHI_chiang_kaishek = { set_nationality = HYQ }}
						CHI_chiang_kaishek = { promote_character = { ideology = the_peoples_tutelage }}
						CHI_chiang_kaishek = { promote_character = { ideology = constitutionalism }}
						CHI_chiang_kaishek = { promote_character = { ideology = despotism }}
					}else = {	
						CHI = { CHI_feng_yuxiang = { set_nationality = HYQ }}
						CHI_feng_yuxiang = { promote_character = { ideology = the_peoples_tutelage }}
					}
				}
			}
			if = {
				limit = {
					PRC = { 
						exists = yes
						NOT = {
							OR = {
								has_war_together_with = event_target:KMT_central_gov_tag
								has_war_together_with = HYQ
								is_in_faction_with = event_target:KMT_central_gov_tag
								is_in_faction_with = HYQ
								has_war_with = event_target:KMT_central_gov_tag
								has_war_with = HYQ
							}
						}
					}
				}
				PRC = { country_event = { id = kmt.482 hours = 2 }}
			}
			if = {
				limit = {
					JAP = { 
						exists = yes
						NOT = {
							OR = {
								has_war_together_with = event_target:KMT_central_gov_tag
								has_war_together_with = HYQ
								is_in_faction_with = event_target:KMT_central_gov_tag
								is_in_faction_with = HYQ
								has_war_with = event_target:KMT_central_gov_tag
								has_war_with = HYQ
							}
						}
					}
				}
				JAP = { country_event = { id = kmt.482 hours = 5 }}
			}
			every_country = {
				limit = { 
					has_idea = cg_warlords 
					NOT = {
						OR = {
							has_war_together_with = event_target:KMT_central_gov_tag
							has_war_together_with = HYQ
							is_in_faction_with = event_target:KMT_central_gov_tag
							is_in_faction_with = HYQ
							has_war_with = event_target:KMT_central_gov_tag
							has_war_with = HYQ
						}
					}
					NOT = {
						is_puppet_of = JAP
						is_puppet_of = event_target:KMT_central_gov_tag
						is_puppet_of = HYQ
					}
				}
				country_event = { id = kmt.482 hours = 5 }
			}
			every_unit_leader = {
				limit = {
					OR = {
						has_id = 1001
						has_id = 1003
						has_id = 1005
						has_id = 1016
						has_id = 1019
						has_id = 1022
					}
				}
				set_nationality = HYQ
				set_character_flag = KMT_pro_jap_civil_war_sn_flag
			}
			every_character = {
				limit = { has_character_flag = KMT_pro_jap_civil_war_sn_flag }
				set_nationality = HYQ
				clr_character_flag = KMT_pro_jap_civil_war_sn_flag
			}
		}
	}
	hidden_effect = {
		every_state = {
			limit = {
				is_core_of = ROOT
			}
			add_core_of = HYQ
			add_claim_by = ROOT
			if = {
				limit = {
					NOT = { is_owned_by = ROOT }
				}
				remove_core_of = ROOT
			}
		}
		clear_global_event_target = KMT_central_gov_tag
		remove_dynamic_modifier = { modifier = cu_warlords_count }
		HYQ = { 
			save_global_event_target_as = KMT_central_gov_tag
			add_dynamic_modifier = { modifier = cu_warlords_count }
		}
		if = {
			limit = {
				NOT = { has_global_flag = KMT_disable_power_struggle_mechanics }
			}
			add_stability = 0.5
			remove_dynamic_modifier = { modifier = KMT_cg_modifier }
			HYQ = { 
				set_stability = 0
				add_dynamic_modifier = { modifier = KMT_cg_modifier }
			}
		}
		if = {
			limit = { has_idea = KMT_soong_tv }
			remove_ideas = KMT_soong_tv
			HYQ = { add_ideas = KMT_soong_tv }
		}
		if = {
			limit = { has_idea = KMT_hhk }
			remove_ideas = KMT_hhk
			HYQ = { add_ideas = KMT_hhk }
		}
	}
}

KMT_red_coup_effect_procrastinated = {
	set_country_flag = KMT_red_coup_finish
	hidden_effect = {
		every_country = {
			limit = {
				is_puppet_of = ROOT
			}
			ROOT = {
				end_puppet = PREV
			}
		}
	}
	if = {
		limit = {
			communism < 0.1
		}
		if = {
			limit = {
				has_government = neutrality
			}
			start_civil_war = {
				ideology = neutrality
				ruling_party = communism
				keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
				size = 0.9
			}
		}else = {
			if = {
				limit = {
					has_government = democratic
				}
				start_civil_war = {
					ideology = democratic
					ruling_party = communism
					keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
					size = 0.9
				}
			}else = {
				if = {
					limit = {
						has_government = fascism
					}
					start_civil_war = {
						ideology = fascism
						ruling_party = communism
						keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
						size = 0.9
					}
				}
			}
		}
		if = {
			limit = {
				has_global_flag = KMT_PRC_agrees_to_work_with_us
			}
			add_ideas = KMT_peasants_revolution_1
		}else = {
			add_ideas = KMT_revolution_1
		}
	}else = {
		if = {
			limit = {
				communism < 0.2
			}
			if = {
				limit = {
					has_government = neutrality
				}
				start_civil_war = {
					ideology = neutrality
					ruling_party = communism
					keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
					size = 0.7
				}
			}else_if = {
				limit = {
					has_government = democratic
				}
				start_civil_war = {
					ideology = democratic
					ruling_party = communism
					keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
					size = 0.7
				}
			}else_if = {
				limit = {
					has_government = fascism
				}
				start_civil_war = {
					ideology = fascism
					ruling_party = communism
					keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
					size = 0.7
				}
			}
			if = {
				limit = {
					has_global_flag = KMT_PRC_agrees_to_work_with_us
				}
				add_ideas = KMT_peasants_revolution_2
			}else = {
				add_ideas = KMT_revolution_2
			}
		}else_if = {
			limit = {
				communism < 0.3
			}
			if = {
				limit = {
					has_government = neutrality
				}
				start_civil_war = {
					ideology = neutrality
					ruling_party = communism
					keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
					size = 0.6
				}
			}else_if = {
				limit = {
					has_government = democratic
				}
				start_civil_war = {
					ideology = democratic
					ruling_party = communism
					keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
					size = 0.6
				}
			}else_if = {
				limit = {
					has_government = fascism
				}
				start_civil_war = {
					ideology = fascism
					ruling_party = communism
					keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
					size = 0.6
				}
			}
			if = {
				limit = {
					has_global_flag = KMT_PRC_agrees_to_work_with_us
				}
				add_ideas = KMT_peasants_revolution_3
			}else = {
				add_ideas = KMT_revolution_3
			}
		}else_if = {
			limit = {
				communism < 0.4
			}
			if = {
				limit = {
					has_government = neutrality
				}
				start_civil_war = {
					ideology = neutrality
					ruling_party = communism
					keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
					size = 0.5
				}
			}else_if = {
				limit = {
					has_government = democratic
				}
				start_civil_war = {
					ideology = democratic
					ruling_party = communism
					keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
					size = 0.5
				}
			}else_if = {
				limit = {
					has_government = fascism
				}
				start_civil_war = {
					ideology = fascism
					ruling_party = communism
					keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
					size = 0.5
				}
			}
			if = {
				limit = {
					has_global_flag = KMT_PRC_agrees_to_work_with_us
				}
				add_ideas = KMT_peasants_revolution_4
			}else = {
				add_ideas = KMT_revolution_4
			}
		}else_if = {
			limit = {
				has_government = neutrality
			}
			start_civil_war = {
				ideology = neutrality
				ruling_party = communism
				keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
				size = 0.4
			}
		}else_if = {
			limit = {
				has_government = democratic
			}
			start_civil_war = {
				ideology = democratic
				ruling_party = communism
				keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
				size = 0.4
			}
		}else_if = {
			limit = {
				has_government = fascism
			}
			start_civil_war = {
				ideology = fascism
				ruling_party = communism
				keep_unit_leaders = { 1033 1034 1035 1036 1037 1038 1039 }
				size = 0.4
			}
			if = {
				limit = {
					has_global_flag = KMT_PRC_agrees_to_work_with_us
				}
				add_ideas = KMT_peasants_revolution_5
			}else = {
				add_ideas = KMT_revolution_5
			}
		}
	}
	if = {
		limit = {
			has_global_flag = KMT_coup_more_pp
		}
		add_political_power = 100
	}
	if = {
		limit = {
			has_global_flag = KMT_coup_chen_duxiu_leader
		}
		set_party_name = { ideology = communism long_name = KMT_new_cpc name = KMT_new_cpc_short }
		generate_character={
			token_base = KMT_chen_duxiu
			name = KMT_chen_duxiu
			portraits={
				civilian={
					large="gfx/leaders/kmt_mod/Portrait_Chen_Duxiu.dds"
				}
				army={
				}
			}
			country_leader={
				expire = "1965.1.1"
				ideology = leninism
				traits = {
					PRC_trotskyist
				}
			}
		}
		KMT_chen_duxiu = { promote_character = { ideology = leninism }}
	}
	if = {
		limit = {
			has_global_flag = KMT_coup_get_reinforcements
		}
		division_template = {
			name = "Chung-kung Yan-chn"
			regiments = {
				irregular_infantry = { x = 0 y = 0 }
				irregular_infantry = { x = 0 y = 1 } 
				irregular_infantry = { x = 1 y = 0 }
				irregular_infantry = { x = 1 y = 1 } 
			}
		}
		random_owned_controlled_state = {
			prioritize = { 613 }
			create_unit = { 
				division = "name = \"Chung-kung Yan-chn\" division_template = \"Chung-kung Yan-chn\" start_experience_factor = 0.3" 
				owner = event_target:KMT_central_gov_tag
			}
			create_unit = { 
				division = "name = \"Chung-kung Yan-chn\" division_template = \"Chung-kung Yan-chn\" start_experience_factor = 0.3" 
				owner = event_target:KMT_central_gov_tag
			}
		}
	}
	hidden_effect = {
		if = {
			limit = {
				has_idea = KMT_government_reforming
			}
			remove_ideas = KMT_government_reforming
		}
		every_state = {
			limit = {
				is_core_of = event_target:KMT_central_gov_tag
			}
			add_core_of = HYQ
		}
		if = {
			limit = {
				has_civil_war = yes
			}
			random_country = {
				limit = {
					original_tag = event_target:KMT_central_gov_tag
					NOT = { tag = event_target:KMT_central_gov_tag }
				}
				every_state = {
					limit = {
						is_core_of = PREV
					}
					remove_core_of = PREV
				}
				every_unit_leader = {
					#effec_tooltip = { set_nationality = HYQ }
					set_character_flag = KMT_pro_jap_civil_war_sn_flag
				}
				every_character = {
					limit = { has_character_flag = KMT_pro_jap_civil_war_sn_flag }
					set_nationality = HYQ
					clr_character_flag = KMT_pro_jap_civil_war_sn_flag
				}
				HYQ = {
					annex_country = {
						target = PREV
						transfer_troops = yes
					}
					declare_war_on = {
						target = ROOT
						type = civil_war
					}
					set_politics = {
						ruling_party = neutrality
						elections_allowed = no
					}
					set_popularities = {
						democratic =  5
						fascism = 5
						communism = 1
						neutrality = 89
					}
					if = {
						limit = {
							NOT = {
								has_global_flag = cks_killed_xian
							}
						}			
						CHI = { CHI_chiang_kaishek = { set_nationality = HYQ }}
						CHI_chiang_kaishek = { promote_character = { ideology = the_peoples_tutelage }}
						CHI_chiang_kaishek = { promote_character = { ideology = constitutionalism }}
						CHI_chiang_kaishek = { promote_character = { ideology = despotism }}
					}else = {	
						CHI = { CHI_feng_yuxiang = { set_nationality = HYQ }}
						CHI_feng_yuxiang = { promote_character = { ideology = the_peoples_tutelage }}
					}
				}
			}
			if = {
				limit = {
					PRC = { 
						exists = yes
						NOT = {
							OR = {
								has_war_together_with = event_target:KMT_central_gov_tag
								has_war_together_with = HYQ
								is_in_faction_with = event_target:KMT_central_gov_tag
								is_in_faction_with = HYQ
								has_war_with = event_target:KMT_central_gov_tag
								has_war_with = HYQ
							}
						}
					}
				}
				PRC = { country_event = { id = kmt.482 hours = 2 }}
			}
			if = {
				limit = {
					JAP = { 
						exists = yes
						NOT = {
							OR = {
								has_war_together_with = event_target:KMT_central_gov_tag
								has_war_together_with = HYQ
								is_in_faction_with = event_target:KMT_central_gov_tag
								is_in_faction_with = HYQ
								has_war_with = event_target:KMT_central_gov_tag
								has_war_with = HYQ
							}
						}
					}
				}
				JAP = { country_event = { id = kmt.482 hours = 5 }}
			}
			every_country = {
				limit = { 
					OR = {
						has_idea = cg_warlords 
						has_idea = cg_warlords 
						tag = PGR
						tag = ZXL
						tag = MEN
					}
					NOT = {
						OR = {
							has_war_together_with = event_target:KMT_central_gov_tag
							has_war_together_with = HYQ
							is_in_faction_with = event_target:KMT_central_gov_tag
							is_in_faction_with = HYQ
							has_war_with = event_target:KMT_central_gov_tag
							has_war_with = HYQ
						}
					}
					NOT = {
						is_puppet_of = JAP
						is_puppet_of = event_target:KMT_central_gov_tag
						is_puppet_of = HYQ
					}
				}
				country_event = { id = kmt.482 hours = 5 }
			}
			every_unit_leader = {
				limit = {
					OR = {
						has_id = 1001
						has_id = 1003
						has_id = 1005
						has_id = 1016
						has_id = 1019
						has_id = 1022
					}
				}
				set_nationality = HYQ
				set_character_flag = KMT_pro_jap_civil_war_sn_flag
			}
			every_character = {
				limit = { has_character_flag = KMT_pro_jap_civil_war_sn_flag }
				set_nationality = HYQ
				clr_character_flag = KMT_pro_jap_civil_war_sn_flag
			}
			random_country = {
				limit = {
					original_tag = event_target:KMT_central_gov_tag
					NOT = { tag = event_target:KMT_central_gov_tag }
				}
				every_unit_leader = {
					#effec_tooltip = { set_nationality = HYQ }
					set_character_flag = KMT_pro_jap_civil_war_sn_flag
				}
				every_character = {
					limit = { has_character_flag = KMT_pro_jap_civil_war_sn_flag }
					set_nationality = HYQ
					clr_character_flag = KMT_pro_jap_civil_war_sn_flag
				}
			}
		}
	}
	hidden_effect = {
		every_state = {
			limit = {
				is_core_of = ROOT
			}
			add_core_of = HYQ
			add_claim_by = ROOT
			if = {
				limit = {
					NOT = { is_owned_by = ROOT }
				}
				remove_core_of = ROOT
			}
		}
		clear_global_event_target = KMT_central_gov_tag
		remove_dynamic_modifier = { modifier = cu_warlords_count }
		HYQ = { 
			save_global_event_target_as = KMT_central_gov_tag
			add_dynamic_modifier = { modifier = cu_warlords_count }
			set_party_name = { ideology = neutrality name = KMT_kmt_party_name }
		}
		if = {
			limit = {
				NOT = { has_global_flag = KMT_disable_power_struggle_mechanics }
			}
			add_stability = 0.5
			remove_dynamic_modifier = { modifier = KMT_cg_modifier }
			HYQ = { 
				set_stability = 0
				add_dynamic_modifier = { modifier = KMT_cg_modifier }
			}
		}
		if = {
			limit = { has_character = KMT_soong_tv }
			KMT_soong_tv = { set_nationality = HYQ }
			HYQ = { add_ideas = KMT_soong_tv }
		}
		if = {
			limit = { has_character = KMT_hhk }
			KMT_hhk = { set_nationality = HYQ }
			HYQ = { add_ideas = KMT_hhk }
		}
	}
}

oust_the_coloniser_effect = {
	every_country = {
		limit = {
			any_owned_state = {
				is_on_continent = asia
			}
			capital_scope = {
				NOT = {
					is_on_continent = asia
				}
			}
			NOT = {
				tag = SOV
				has_war_with = ROOT
			}
		}
		ROOT = {
			create_wargoal = {
				target = PREV
				type = topple_government
			}
		}
	}
	every_country = {
		limit = {
			capital_scope = {
				is_on_continent = asia
			}
			is_puppet = yes
			overlord = {
				capital_scope = {
					NOT = {
						is_on_continent = asia
					}
				}
			}
		}
		overlord = {
			ROOT = {
				create_wargoal = {
					target = PREV
					type = topple_government
				}
			}
		}
	}
}

KMT_own_fighter_assembly = {
	if = {
		limit = {
			has_completed_focus = KMT_setup_camco_assembly_plants
			OR = {
				burma_road_ok = yes
				yunnan_bahn_ok = yes
			}
		}
		
	}
}

foreign_supply_effect = {
	if = {
		limit = {
			ENG = {
				is_puppet = no
				has_capitulated = no
				has_relation_modifier = { target = ROOT modifier = KMT_industrial_assistance }
			}
		}
		if = {
			limit = {
				ENG = {
					has_tech = advanced_infantry_weapons
					has_opinion = {
						target = ROOT
						value > 84
					}
				}
			}
			add_equipment_to_stockpile = { type = infantry_equipment_3 amount = 250 producer = ENG }
		}else_if = {
			limit = {
				ENG = {
					has_tech = improved_infantry_weapons
					has_opinion = {
						target = ROOT
						value > 64
					}
				}
			}
			add_equipment_to_stockpile = { type = infantry_equipment_2 amount = 250 producer = ENG }
		}else_if = {
			limit = {
				ENG = {
					has_opinion = {
						target = ROOT
						value > 44
					}
				}
			}
			add_equipment_to_stockpile = { type = infantry_equipment_1 amount = 250 producer = ENG }
		}else = {
			add_equipment_to_stockpile = { type = infantry_equipment_0 amount = 250 producer = ENG }
		}
		if = {
			limit = {
				ENG = {
					has_tech = tech_support
					has_opinion = {
						target = ROOT
						value > 14
					}
				}
			}
			add_equipment_to_stockpile = { type = support_equipment_1 amount = 50 producer = ENG }
		}
		if = {
			limit = {
				NOT = { has_dlc = "By Blood Alone" }
				ENG = {
					has_tech = fighter3
					has_opinion = {
						target = ROOT
						value > 84
					}
				}
			}
			add_equipment_to_stockpile = { type = fighter_equipment_3 amount = 2 producer = ENG }
		}else_if = {
			limit = {
				NOT = { has_dlc = "By Blood Alone" }
				ENG = {
					has_tech = fighter2
					has_opinion = {
						target = ROOT
						value > 64
					}
				}
			}
			add_equipment_to_stockpile = { type = fighter_equipment_2 amount = 2 producer = ENG }
		}else_if = {
			limit = {
				NOT = { has_dlc = "By Blood Alone" }
				ENG = {
					has_tech = fighter1
					has_opinion = {
						target = ROOT
						value > 44
					}
				}
			}
			add_equipment_to_stockpile = { type = fighter_equipment_1 amount = 2 producer = ENG }
		}else_if = {
			limit = {
				NOT = { has_dlc = "By Blood Alone" }
				ENG = {
					has_tech = early_fighter
					has_opinion = {
						target = ROOT
						value > 24
					}
				}
			}
			add_equipment_to_stockpile = { type = fighter_equipment_0 amount = 2 producer = ENG }
		}
		if = {
			limit = {
				ENG = {
					has_tech = advanced_light_tank
					has_opinion = {
						target = ROOT
						value > 94
					}
				}
			}
			add_equipment_to_stockpile = { type = light_tank_chassis_3 amount = 2 producer = ENG }
		}else_if = {
			limit = {
				ENG = {
					has_tech = improved_light_tank
					has_opinion = {
						target = ROOT
						value > 84
					}
				}
			}
			add_equipment_to_stockpile = { type = light_tank_chassis_2 amount = 2 producer = ENG }
		}else_if = {
			limit = {
				ENG = {
					has_tech = basic_light_tank
					has_opinion = {
						target = ROOT
						value > 74
					}
				}
			}
			add_equipment_to_stockpile = { type = light_tank_chassis_1 amount = 2 producer = ENG }
		}else_if = {
			limit = {
				ENG = {
					has_tech = gwtank
					has_opinion = {
						target = ROOT
						value > 64
					}
				}
			}
			add_equipment_to_stockpile = { type = light_tank_chassis_0 amount = 2 producer = ENG }
		}
	}
	if = {
		limit = {
			USA = {
				is_puppet = no
				has_capitulated = no
				has_relation_modifier = { target = ROOT modifier = KMT_industrial_assistance }
			}
		}
		add_fuel = 60000
		if = {
			limit = {
				USA = {
					has_tech = advanced_infantry_weapons
					has_opinion = {
						target = ROOT
						value > 84
					}
				}
			}
			add_equipment_to_stockpile = { type = infantry_equipment_3 amount = 250 producer = USA }
		}else_if = {
			limit = {
				USA = {
					has_tech = improved_infantry_weapons
					has_opinion = {
						target = ROOT
						value > 64
					}
				}
			}
			add_equipment_to_stockpile = { type = infantry_equipment_2 amount = 250 producer = USA }
		}else_if = {
			limit = {
				USA = {
					has_tech = infantry_weapons1
					has_opinion = {
						target = ROOT
						value > 64
					}
				}
			}
			add_equipment_to_stockpile = { type = infantry_equipment_1 amount = 250 producer = USA }
		}else = {
			add_equipment_to_stockpile = { type = infantry_equipment_0 amount = 250 producer = USA }
		}
		if = {
			limit = {
				USA = {
					has_tech = tech_support
					has_opinion = {
						target = ROOT
						value > 14
					}
				}
			}
			add_equipment_to_stockpile = { type = support_equipment_1 amount = 50 producer = USA }
		}
		if = {
			limit = {
				NOT = { has_dlc = "By Blood Alone" }
				USA = {
					has_tech = fighter3
					has_opinion = {
						target = ROOT
						value > 84
					}
				}
			}
			add_equipment_to_stockpile = { type = fighter_equipment_3 amount = 2 producer = USA }
		}else_if = {
			limit = {
				NOT = { has_dlc = "By Blood Alone" }
				USA = {
					has_tech = fighter2
					has_opinion = {
						target = ROOT
						value > 64
					}
				}
			}
			add_equipment_to_stockpile = { type = fighter_equipment_2 amount = 2 producer = USA }
		}else_if = {
			limit = {
				NOT = { has_dlc = "By Blood Alone" }
				USA = {
					has_tech = fighter1
					has_opinion = {
						target = ROOT
						value > 44
					}
				}
			}
			add_equipment_to_stockpile = { type = fighter_equipment_1 amount = 2 producer = USA }
		}else_if = {
			limit = {
				NOT = { has_dlc = "By Blood Alone" }
				USA = {
					has_tech = early_fighter
					has_opinion = {
						target = ROOT
						value > 24
					}
				}
			}
			add_equipment_to_stockpile = { type = fighter_equipment_0 amount = 2 producer = USA }
		}
		if = {
			limit = {
				USA = {
					has_tech = advanced_light_tank
					has_opinion = {
						target = ROOT
						value > 94
					}
				}
			}
			add_equipment_to_stockpile = { type = light_tank_chassis_3 amount = 2 producer = USA }
		}else_if = {
			limit = {
				USA = {
					has_tech = improved_light_tank
					has_opinion = {
						target = ROOT
						value > 84
					}
				}
			}
			add_equipment_to_stockpile = { type = light_tank_chassis_2 amount = 2 producer = USA }
		}else_if = {
			limit = {
				USA = {
					has_tech = basic_light_tank
					has_opinion = {
						target = ROOT
						value > 74
					}
				}
			}
			add_equipment_to_stockpile = { type = light_tank_chassis_1 amount = 2 producer = USA }
		}else_if = {
			limit = {
				USA = {
					has_tech = gwtank
					has_opinion = {
						target = ROOT
						value > 64
					}
				}
			}
			add_equipment_to_stockpile = { type = light_tank_chassis_0 amount = 2 producer = USA }
		}
	}
	if = {
		limit = {
			FRA = {
				is_puppet = no
				has_capitulated = no
				has_relation_modifier = { target = ROOT modifier = KMT_industrial_assistance }
			}
		}
		if = {
			limit = {
				FRA = {
					has_tech = advanced_infantry_weapons
					has_opinion = {
						target = ROOT
						value > 84
					}
				}
			}
			add_equipment_to_stockpile = { type = infantry_equipment_3 amount = 250 producer = FRA }
		}else_if = {
			limit = {
				FRA = {
					has_tech = improved_infantry_weapons
					has_opinion = {
						target = ROOT
						value > 64
					}
				}
			}
			add_equipment_to_stockpile = { type = infantry_equipment_2 amount = 250 producer = FRA }
		}else_if = {
			limit = {
				FRA = {
					has_tech = infantry_weapons1
					has_opinion = {
						target = ROOT
						value > 64
					}
				}
			}
			add_equipment_to_stockpile = { type = infantry_equipment_1 amount = 250 producer = FRA }
		}else = {
			add_equipment_to_stockpile = { type = infantry_equipment_0 amount = 250 producer = FRA }
		}
		if = {
			limit = {
				FRA = {
					has_tech = tech_support
					has_opinion = {
						target = ROOT
						value > 14
					}
				}
			}
			add_equipment_to_stockpile = { type = support_equipment_1 amount = 50 producer = FRA }
		}
		if = {
			limit = {
				NOT = { has_dlc = "By Blood Alone" }
				FRA = {
					has_tech = fighter3
					has_opinion = {
						target = ROOT
						value > 84
					}
				}
			}
			add_equipment_to_stockpile = { type = fighter_equipment_3 amount = 2 producer = FRA }
		}else_if = {
			limit = {
				NOT = { has_dlc = "By Blood Alone" }
				FRA = {
					has_tech = fighter2
					has_opinion = {
						target = ROOT
						value > 64
					}
				}
			}
			add_equipment_to_stockpile = { type = fighter_equipment_2 amount = 2 producer = FRA }
		}else_if = {
			limit = {
				NOT = { has_dlc = "By Blood Alone" }
				FRA = {
					has_tech = fighter1
					has_opinion = {
						target = ROOT
						value > 44
					}
				}
			}
			add_equipment_to_stockpile = { type = fighter_equipment_1 amount = 2 producer = FRA }
		}else_if = {
			limit = {
				NOT = { has_dlc = "By Blood Alone" }
				FRA = {
					has_tech = early_fighter
					has_opinion = {
						target = ROOT
						value > 24
					}
				}
			}
			add_equipment_to_stockpile = { type = fighter_equipment_0 amount = 2 producer = FRA }
		}
		if = {
			limit = {
				FRA = {
					has_tech = advanced_light_tank
					has_opinion = {
						target = ROOT
						value > 94
					}
				}
			}
			add_equipment_to_stockpile = { type = light_tank_chassis_3 amount = 2 producer = FRA }
		}else_if = {
			limit = {
				FRA = {
					has_tech = improved_light_tank
					has_opinion = {
						target = ROOT
						value > 84
					}
				}
			}
			add_equipment_to_stockpile = { type = light_tank_chassis_2 amount = 2 producer = FRA }
		}else_if = {
			limit = {
				FRA = {
					has_tech = basic_light_tank
					has_opinion = {
						target = ROOT
						value > 74
					}
				}
			}
			add_equipment_to_stockpile = { type = light_tank_chassis_1 amount = 2 producer = FRA }
		}else_if = {
			limit = {
				FRA = {
					has_tech = gwtank
					has_opinion = {
						target = ROOT
						value > 64
					}
				}
			}
			add_equipment_to_stockpile = { type = light_tank_chassis_0 amount = 2 producer = FRA }
		}
	}
	if = {
		limit = {
			GER = {
				is_puppet = no
				has_capitulated = no
				has_relation_modifier = { target = ROOT modifier = KMT_industrial_assistance }
			}
		}
		if = {
			limit = {
				GER = {
					has_tech = advanced_infantry_weapons
					has_opinion = {
						target = ROOT
						value > 84
					}
				}
			}
			add_equipment_to_stockpile = { type = infantry_equipment_3 amount = 250 producer = GER }
		}else_if = {
			limit = {
				GER = {
					has_tech = improved_infantry_weapons
					has_opinion = {
						target = ROOT
						value > 64
					}
				}
			}
			add_equipment_to_stockpile = { type = infantry_equipment_2 amount = 250 producer = GER }
		}else_if = {
			limit = {
				GER = {
					has_tech = infantry_weapons1
					has_opinion = {
						target = ROOT
						value > 64
					}
				}
			}
			add_equipment_to_stockpile = { type = infantry_equipment_1 amount = 250 producer = GER }
		}else = {
			add_equipment_to_stockpile = { type = infantry_equipment_0 amount = 250 producer = GER }
		}
		if = {
			limit = {
				GER = {
					has_tech = tech_support
					has_opinion = {
						target = ROOT
						value > 14
					}
				}
			}
			add_equipment_to_stockpile = { type = support_equipment_1 amount = 50 producer = GER }
		}
		if = {
			limit = {
				NOT = { has_dlc = "By Blood Alone" }
				GER = {
					has_tech = fighter3
					has_opinion = {
						target = ROOT
						value > 84
					}
				}
			}
			add_equipment_to_stockpile = { type = fighter_equipment_3 amount = 2 producer = GER }
		}else_if = {
			limit = {
				NOT = { has_dlc = "By Blood Alone" }
				GER = {
					has_tech = fighter2
					has_opinion = {
						target = ROOT
						value > 64
					}
				}
			}
			add_equipment_to_stockpile = { type = fighter_equipment_2 amount = 2 producer = GER }
		}else_if = {
			limit = {
				NOT = { has_dlc = "By Blood Alone" }
				GER = {
					has_tech = fighter1
					has_opinion = {
						target = ROOT
						value > 44
					}
				}
			}
			add_equipment_to_stockpile = { type = fighter_equipment_1 amount = 2 producer = GER }
		}else_if = {
			limit = {
				NOT = { has_dlc = "By Blood Alone" }
				GER = {
					has_tech = early_fighter
					has_opinion = {
						target = ROOT
						value > 24
					}
				}
			}
			add_equipment_to_stockpile = { type = fighter_equipment_0 amount = 2 producer = GER }
		}
		if = {
			limit = {
				GER = {
					has_tech = advanced_light_tank
					has_opinion = {
						target = ROOT
						value > 94
					}
				}
			}
			add_equipment_to_stockpile = { type = light_tank_chassis_3 amount = 2 producer = GER }
		}else_if = {
			limit = {
				GER = {
					has_tech = improved_light_tank
					has_opinion = {
						target = ROOT
						value > 84
					}
				}
			}
			add_equipment_to_stockpile = { type = light_tank_chassis_2 amount = 2 producer = GER }
		}else_if = {
			limit = {
				GER = {
					has_tech = basic_light_tank
					has_opinion = {
						target = ROOT
						value > 74
					}
				}
			}
			add_equipment_to_stockpile = { type = light_tank_chassis_1 amount = 2 producer = GER }
		}else_if = {
			limit = {
				GER = {
					has_tech = gwtank
					has_opinion = {
						target = ROOT
						value > 64
					}
				}
			}
			add_equipment_to_stockpile = { type = light_tank_chassis_0 amount = 2 producer = GER }
		}
	}
}

KMT_evacuate_industry_to_the_rear = { 
	set_temp_variable = {
		var = af_to_move
		value = arms_factory_level
	}
	if = {
		limit = {
			check_variable = { af_to_move > 5 }
		}
		multiply_variable = {
			var = af_to_move
			value = global.CHI_industrial_evacuations_amount_factor3
		}
		else = {
			if = {
				limit = {
					check_variable = { af_to_move > 4 }
				}
				multiply_variable = {
					var = af_to_move
					value = global.CHI_industrial_evacuations_amount_factor2
				}
				else = {
					if = {
						limit = {
							check_variable = { af_to_move > 3 }
						}
						multiply_variable = {
							var = af_to_move
							value = global.CHI_industrial_evacuations_amount_factor
						}
					}
				}
			}
		}
	}
	
	set_temp_variable = {
		var = ic_to_move
		value = industrial_complex_level
	}
	if = {
		limit = {
			check_variable = { ic_to_move > 5 }
		}
		multiply_variable = {
			var = ic_to_move
			value = global.CHI_industrial_evacuations_amount_factor3
		}
		else = {
			if = {
				limit = {
					check_variable = { ic_to_move > 4 }
				}
				multiply_variable = {
					var = ic_to_move
					value = global.CHI_industrial_evacuations_amount_factor2
				}
				else = {
					if = {
						limit = {
							check_variable = { ic_to_move > 3 }
						}
						multiply_variable = {
							var = ic_to_move
							value = global.CHI_industrial_evacuations_amount_factor
						}
					}
				}
			}
		}
	}
	remove_building = {
		type = arms_factory
		level = af_to_move
	}
	remove_building = {
		type = industrial_complex
		level = ic_to_move
	}

	#Move AF
	ROOT = {
		if = {
			limit = {
				605 = {
					OR = {
						AND = {
							is_fully_controlled_by = ROOT
							is_owned_by = ROOT
							any_neighbor_state = {
								is_controlled_by = ROOT
							}
						}
						AND = {
							CONTROLLER = {
								has_idea = cg_warlords
								has_war_together_with = ROOT
								has_full_control_of_state = PREV
								owns_state = PREV
							}
							any_neighbor_state = {
								CONTROLLER = {
									NOT = { has_war_with = ROOT }
									NOT = { has_war_with = PREV }
								}
							}
						}
					}
					free_building_slots = {
						building = arms_factory
						size > 2
						include_locked = yes
					}
				}
			}
			605 = {
				add_extra_state_shared_building_slots = af_to_move
				add_building_construction = {
					type = arms_factory
					level = af_to_move
					instant_build = yes
				}
				CONTROLLER = { set_country_flag = CHI_industrial_evacuations_moved_AF }
			}
			else = {
				if = {
					limit = {
						748 = {
							OR = {
								AND = {
									is_fully_controlled_by = ROOT
									is_owned_by = ROOT
									any_neighbor_state = {
										is_controlled_by = ROOT
									}
								}
								AND = {
									CONTROLLER = {
										has_idea = cg_warlords
										has_war_together_with = ROOT
										has_full_control_of_state = PREV
										owns_state = PREV
									}
									any_neighbor_state = {
										CONTROLLER = {
											NOT = { has_war_with = ROOT }
											NOT = { has_war_with = PREV }
										}
									}
								}
							}
							free_building_slots = {
								building = arms_factory
								size > 2
								include_locked = yes
							}
						}
					}
					748 = {
						add_extra_state_shared_building_slots = af_to_move
						add_building_construction = {
							type = arms_factory
							level = af_to_move
							instant_build = yes
						}
						CONTROLLER = { set_country_flag = CHI_industrial_evacuations_moved_AF }
					}
					else = {
						if = {
							limit = {
								603 = {
									OR = {
										AND = {
											is_fully_controlled_by = ROOT
											is_owned_by = ROOT
											any_neighbor_state = {
												is_controlled_by = ROOT
											}
										}
										AND = {
											CONTROLLER = {
												has_idea = cg_warlords
												has_war_together_with = ROOT
												has_full_control_of_state = PREV
												owns_state = PREV
											}
											any_neighbor_state = {
												CONTROLLER = {
													NOT = { has_war_with = ROOT }
													NOT = { has_war_with = PREV }
												}
											}
										}
									}
									free_building_slots = {
										building = arms_factory
										size > 2
										include_locked = yes
									}
								}
							}
							603 = {
								add_extra_state_shared_building_slots = af_to_move
								add_building_construction = {
									type = arms_factory
									level = af_to_move
									instant_build = yes
								}
								CONTROLLER = { set_country_flag = CHI_industrial_evacuations_moved_AF }
							}
							else = {
								random_owned_controlled_state = {
									prioritize = { 605 748 603 }
									limit = {
										OR = {
											is_fully_controlled_by = ROOT
											CONTROLLER = {
												has_idea = cg_warlords
												has_war_together_with = ROOT
												has_full_control_of_state = PREV
											}
										}
										any_neighbor_state = {
											OR = {
												is_controlled_by = ROOT
												CONTROLLER = {
													has_idea = cg_warlords
													has_war_together_with = ROOT
													has_full_control_of_state = PREV
												}
											}
										}
										free_building_slots = {
											building = arms_factory
											size > 2
											include_locked = yes
										}
									}
									add_extra_state_shared_building_slots = af_to_move
									add_building_construction = {
										type = arms_factory
										level = af_to_move
										instant_build = yes
									}
									CONTROLLER = { set_country_flag = CHI_industrial_evacuations_moved_AF }
								}
							}
						}
					}
				}
			}
		}

		#If no states are really safe or all safe are filled
		#Move to random controlled state
		if = {
			limit = {
				NOT = { has_country_flag = CHI_industrial_evacuations_moved_AF }
				NOT = {
					any_state = {
						OR = {
							AND = {
								is_fully_controlled_by = ROOT
								is_owned_by = ROOT
							}
							CONTROLLER = {
								has_idea = cg_warlords
								has_war_together_with = ROOT
								has_full_control_of_state = PREV
								owns_state = PREV
							}
						}
						any_neighbor_state = {
							OR = {
								is_controlled_by = ROOT
								CONTROLLER = {
									NOT = { has_war_with = ROOT }
									NOT = { has_war_with = PREV }
								}
							}
						}
						free_building_slots = {
							building = arms_factory
							size > 2
							include_locked = yes
						}
					}
				}
			}
			random_owned_controlled_state = {
				prioritize = { 605 748 603 }
				limit = {
					OR = {
						AND = {
							is_controlled_by = ROOT
							is_owned_by = ROOT
						}
						CONTROLLER = {
							has_idea = cg_warlords
							has_war_together_with = ROOT
							owns_state = PREV
						}
					}
					free_building_slots = {
						building = arms_factory
						size > 2
						include_locked = yes
					}
				}
				add_extra_state_shared_building_slots = af_to_move
				add_building_construction = {
					type = arms_factory
					level = af_to_move
					instant_build = yes
				}
			}
		}
		clr_country_flag = CHI_industrial_evacuations_moved_AF


		#Move IC
		if = {
			limit = {
				605 = {
					OR = {
						AND = {
							is_fully_controlled_by = ROOT
							is_owned_by = ROOT
							any_neighbor_state = {
								is_controlled_by = ROOT
							}
						}
						AND = {
							CONTROLLER = {
								has_idea = cg_warlords
								has_war_together_with = ROOT
								has_full_control_of_state = PREV
								owns_state = PREV
							}
							any_neighbor_state = {
								CONTROLLER = {
									NOT = { has_war_with = ROOT }
									NOT = { has_war_with = PREV }
								}
							}
						}
					}
					free_building_slots = {
						building = industrial_complex
						size > 2
						include_locked = yes
					}
				}
			}
			605 = {
				add_extra_state_shared_building_slots = ic_to_move
				add_building_construction = {
					type = industrial_complex
					level = ic_to_move
					instant_build = yes
				}
				CONTROLLER = { set_country_flag = CHI_industrial_evacuations_moved_IC }
			}
			else = {
				if = {
					limit = {
						748 = {
							OR = {
								AND = {
									is_fully_controlled_by = ROOT
									is_owned_by = ROOT
									any_neighbor_state = {
										is_controlled_by = ROOT
									}
								}
								AND = {
									CONTROLLER = {
										has_idea = cg_warlords
										has_war_together_with = ROOT
										has_full_control_of_state = PREV
										owns_state = PREV
									}
									any_neighbor_state = {
										CONTROLLER = {
											NOT = { has_war_with = ROOT }
											NOT = { has_war_with = PREV }
										}
									}
								}
							}
							free_building_slots = {
								building = industrial_complex
								size > 2
								include_locked = yes
							}
						}
					}
					748 = {
						add_extra_state_shared_building_slots = ic_to_move
						add_building_construction = {
							type = industrial_complex
							level = ic_to_move
							instant_build = yes
						}
						CONTROLLER = { set_country_flag = CHI_industrial_evacuations_moved_IC }
					}
					else = {
						if = {
							limit = {
								603 = {
									OR = {
										AND = {
											is_fully_controlled_by = ROOT
											is_owned_by = ROOT
											any_neighbor_state = {
												is_controlled_by = ROOT
											}
										}
										AND = {
											CONTROLLER = {
												has_idea = cg_warlords
												has_war_together_with = ROOT
												has_full_control_of_state = PREV
												owns_state = PREV
											}
											any_neighbor_state = {
												CONTROLLER = {
													NOT = { has_war_with = ROOT }
													NOT = { has_war_with = PREV }
												}
											}
										}
									}
									free_building_slots = {
										building = industrial_complex
										size > 2
										include_locked = yes
									}
								}
							}
							603 = {
								add_extra_state_shared_building_slots = ic_to_move
								add_building_construction = {
									type = industrial_complex
									level = ic_to_move
									instant_build = yes
								}
								CONTROLLER = { set_country_flag = CHI_industrial_evacuations_moved_IC }
							}
							else = {
								random_owned_controlled_state = {
									prioritize = { 605 748 603 }
									limit = {
										OR = {
											is_fully_controlled_by = ROOT
											CONTROLLER = {
												has_idea = cg_warlords
												has_war_together_with = ROOT
												has_full_control_of_state = PREV
											}
										}
										any_neighbor_state = {
											OR = {
												is_controlled_by = ROOT
												CONTROLLER = {
													has_idea = cg_warlords
													has_war_together_with = ROOT
													has_full_control_of_state = PREV
												}
											}
										}
										free_building_slots = {
											building = industrial_complex
											size > 2
											include_locked = yes
										}
									}
									add_extra_state_shared_building_slots = ic_to_move
									add_building_construction = {
										type = industrial_complex
										level = ic_to_move
										instant_build = yes
									}
									CONTROLLER = { set_country_flag = CHI_industrial_evacuations_moved_IC }
								}
							}
						}
					}
				}
			}
		}

		#If no states are really safe or all safe are filled
		#Move to random controlled state
		if = {
			limit = {
				NOT = { has_country_flag = CHI_industrial_evacuations_moved_IC }
				NOT = {
					any_state = {
						OR = {
							AND = {
								is_fully_controlled_by = ROOT
								is_owned_by = ROOT
							}
							CONTROLLER = {
								has_idea = cg_warlords
								has_war_together_with = ROOT
								has_full_control_of_state = PREV
								owns_state = PREV
							}
						}
						any_neighbor_state = {
							OR = {
								is_controlled_by = ROOT
								CONTROLLER = {
									NOT = { has_war_with = ROOT }
									NOT = { has_war_with = PREV }
								}
							}
						}
						free_building_slots = {
							building = industrial_complex
							size > 2
							include_locked = yes
						}
					}
				}
			}
			random_owned_controlled_state = {
				prioritize = { 605 748 603 }
				limit = {
					OR = {
						AND = {
							is_controlled_by = ROOT
							is_owned_by = ROOT
						}
						CONTROLLER = {
							has_idea = cg_warlords
							has_war_together_with = ROOT
							owns_state = PREV
						}
					}
					free_building_slots = {
						building = industrial_complex
						size > 2
						include_locked = yes
					}
				}
				add_extra_state_shared_building_slots = ic_to_move
				add_building_construction = {
					type = industrial_complex
					level = ic_to_move
					instant_build = yes
				}
			}
		}
		clr_country_flag = CHI_industrial_evacuations_moved_IC
	}		
}

PRC_guerrilla_cell_sabotage_effect = {
	set_temp_variable = { var = PRC_target_state_cell_strength_temp value = PRC_state_guerrilla_cell_strength }
	set_temp_variable = { var = PRC_target_state_cell_strength_cost_temp value = 0 }
	if = {
		limit = { rail_way > 4 }
		set_temp_variable = { PRC_target_state_rail_level = 5 }
	}else_if = {
		limit = { rail_way > 3 }
		set_temp_variable = { PRC_target_state_rail_level = 4 }
	}else_if = {
		limit = { rail_way > 2 }
		set_temp_variable = { PRC_target_state_rail_level = 3 }
	}else_if = {
		limit = { rail_way > 1 }
		set_temp_variable = { PRC_target_state_rail_level = 2 }
	}else_if = {
		limit = { rail_way > 0 }
		set_temp_variable = { PRC_target_state_rail_level = 1 }
	}else = {
		set_temp_variable = { PRC_target_state_rail_level = 0 }
	}
	if = {
		limit = {
			set_temp_variable = { PRC_target_state_infra_level_temp = infrastructure_level }
			multiply_temp_variable = { PRC_target_state_infra_level_temp = 2 }
			check_variable = { PRC_target_state_infra_level_temp < PRC_target_state_cell_strength_temp }
		}
		add_to_temp_variable = { var = PRC_target_state_cell_strength_cost_temp value = PRC_target_state_infra_level_temp }
		damage_building = {
			type = infrastructure
			damage = 5
		}
		subtract_from_temp_variable = { var = PRC_target_state_cell_strength_temp value = PRC_target_state_infra_level_temp }
		if = {
			limit = {
				arms_factory > 0
				check_variable = { PRC_target_state_cell_strength_temp > 1 }
			}
			damage_building = {
				type = arms_factory
				damage = 1
			}
			add_to_temp_variable = { var = PRC_target_state_cell_strength_cost_temp value = 2 }
			subtract_from_temp_variable = { var = PRC_target_state_cell_strength_temp value = 2 }
		}
		if = {
			limit = {
				rail_way > 0
				check_variable = { PRC_target_state_cell_strength_temp > 1 }
			}
			if = {
				limit = {
					set_temp_variable = { PRC_target_state_rw_level_temp = PRC_target_state_rail_level }
					multiply_temp_variable = { PRC_target_state_rw_level_temp = 2 }
					check_variable = { PRC_target_state_rw_level_temp < PRC_target_state_cell_strength_temp }
				}
				damage_building = {
					type = rail_way
					damage = 5
				}
				add_to_temp_variable = { var = PRC_target_state_cell_strength_cost_temp value = PRC_target_state_rw_level_temp }
				subtract_from_temp_variable = { var = PRC_target_state_cell_strength_temp value = PRC_target_state_rw_level_temp }
			}else_if = {
				limit = {
					check_variable = { PRC_target_state_cell_strength_temp < 3 }
				}
				add_to_temp_variable = { var = PRC_target_state_cell_strength_cost_temp value = 2 }
				subtract_from_temp_variable = { var = PRC_target_state_cell_strength_temp value = 2 }
				damage_building = {
					type = rail_way
					damage = 1
				}
			}else_if = {
				limit = {
					check_variable = { PRC_target_state_cell_strength_temp < 5 }
				}
				add_to_temp_variable = { var = PRC_target_state_cell_strength_cost_temp value = 4 }
				subtract_from_temp_variable = { var = PRC_target_state_cell_strength_temp value = 4 }
				damage_building = {
					type = rail_way
					damage = 2
				}
			}else_if = {
				limit = {
					check_variable = { PRC_target_state_cell_strength_temp < 7 }
				}
				add_to_temp_variable = { var = PRC_target_state_cell_strength_cost_temp value = 6 }
				subtract_from_temp_variable = { var = PRC_target_state_cell_strength_temp value = 6 }
				damage_building = {
					type = rail_way
					damage = 3
				}
			}else_if = {
				limit = {
					check_variable = { PRC_target_state_cell_strength_temp < 9 }
				}
				add_to_temp_variable = { var = PRC_target_state_cell_strength_cost_temp value = 8 }
				subtract_from_temp_variable = { var = PRC_target_state_cell_strength_temp value = 8 }
				damage_building = {
					type = rail_way
					damage = 4
				}
			}
		}
		if = {
			limit = {
				industrial_complex > 0
				check_variable = { PRC_target_state_cell_strength_temp > 1 }
			}
			damage_building = {
				type = industrial_complex
				damage = 1
			}
			add_to_temp_variable = { var = PRC_target_state_cell_strength_cost_temp value = 2 }
			subtract_from_temp_variable = { var = PRC_target_state_cell_strength_temp value = 2 }
		}
		if = {
			limit = {
				dockyard > 0
				check_variable = { PRC_target_state_cell_strength_temp > 1 }
			}
			damage_building = {
				type = dockyard
				damage = 1
			}
			add_to_temp_variable = { var = PRC_target_state_cell_strength_cost_temp value = 2 }
		}
	}else_if = {
		limit = {
			check_variable = { PRC_target_state_cell_strength_temp < 2 }
		}
		add_to_temp_variable = { var = PRC_target_state_cell_strength_cost_temp value = 2 }
		damage_building = {
			type = infrastructure
			damage = 1
		}
	}else_if = {
		limit = {
			check_variable = { PRC_target_state_cell_strength_temp < 5 }
		}
		add_to_temp_variable = { var = PRC_target_state_cell_strength_cost_temp value = 4 }
		damage_building = {
			type = infrastructure
			damage = 2
		}
	}else_if = {
		limit = {
			check_variable = { PRC_target_state_cell_strength_temp < 7 }
		}
		add_to_temp_variable = { var = PRC_target_state_cell_strength_cost_temp value = 6 }
		damage_building = {
			type = infrastructure
			damage = 3
		}
	}else_if = {
		limit = {
			check_variable = { PRC_target_state_cell_strength_temp < 9 }
		}
		add_to_temp_variable = { var = PRC_target_state_cell_strength_cost_temp value = 8 }
		damage_building = {
			type = infrastructure
			damage = 4
		}
	}
	if = {
		limit = {
			air_base > 0
		}
		damage_building = {
			type = air_base
			damage = 1
		}
	}
	set_temp_variable = { var = PRC_target_minus_cell_strength_amount value = PRC_target_state_cell_strength_cost_temp }
	subtract_from_variable = { var = PRC_state_guerrilla_cell_strength value = PRC_target_minus_cell_strength_amount }
	custom_effect_tooltip = PRC_target_state_minus_cell_strength_tt
}

PRC_uprise_in_state_effect = {
	clear_array = PRC_spawned_guerrilla_province_array
	clear_array = PRC_current_selected_province
	set_variable = { PRC_selected_provinces = 0 }
	set_variable = { PRC_spawned_guerrilla_province = 0 }
	for_each_loop = {
		array = KMT_province_array
		break = b
		if = {
			limit = {
				any_country = {
					controls_province = v
					has_war_with = PRC
				}
			}
			random_list = {
				#log = yes
				seed = random
				50 = { 
					log = "[This.GetName]: [?v] is selected"
					add_to_array = { PRC_spawned_guerrilla_province_array = v }
					add_to_variable = { PRC_selected_provinces = 1 }
				}
				50 = {log = "[This.GetName]: [?v] is not selected"}
			}
		}
		if = { 
			limit = { check_variable = { PRC_selected_provinces > 3 }} 
			log = "[This.GetName]: break province selection"
			set_temp_variable = { b = 1 }
		}
	}
	log = "[This.GetName]: PRC_selected_provinces = [?This.PRC_selected_provinces]"
	while_loop_effect = {
		limit = { check_variable = { PRC_selected_provinces < 4 }}
		log = "[This.GetName]: Not enough PRC_selected_provinces"
		break = wb
		for_each_loop = {
			array = KMT_province_array
			break = b
			add_to_array = { PRC_spawned_guerrilla_province_array = v }
			log = "[This.GetName]: added [?v] to PRC_spawned_guerrilla_province_array"
			add_to_variable = { PRC_selected_provinces = 1 }
			if = { limit = { check_variable = { PRC_selected_provinces > 3 }} set_temp_variable = { b = 1 }}
		}
		if = { limit = { check_variable = { PRC_selected_provinces > 3 }} set_temp_variable = { wb = 1 }}
	}
	log = "[This.GetName]: PRC_selected_provinces = [?This.PRC_selected_provinces]"
	add_to_array = { PRC_current_selected_province = PRC_spawned_guerrilla_province_array^0 }
	log = "[This.GetName]: PRC_current_selected_province = [?This.PRC_current_selected_province^0]"
	if = {
		limit = {
			check_variable = { PRC_state_guerrilla_cell_strength > 39 }
		}
		set_variable = { PRC_max_guerrilla_province = 4 }
		log = "[This.GetName]: PRC_max_guerrilla_province = [?This.PRC_max_guerrilla_province]"
		for_each_loop = {
			array = PRC_spawned_guerrilla_province_array
			
			break = b
			log = "[This.GetName]: Spawn unit in [?v]"
			create_unit = {
				division = "name = \"Y-chi-tui\" division_template = \"Ychitui\" start_experience_factor = 1 start_equipment_factor = 1"
				OWNER = PRC
				allow_spawning_on_enemy_provs = yes
				country_score = { 
					base = 100 
					modifier = { 
						is_in_array = { PRC_current_selected_province = FROM }
						add = 100 
					} 
				} 
			}
			clear_array = PRC_current_selected_province
			remove_from_array = { array = PRC_spawned_guerrilla_province_array index = 0 }
			add_to_array = { PRC_current_selected_province = PRC_spawned_guerrilla_province_array^0 }
			add_to_variable = { PRC_spawned_guerrilla_province = 1 }
			log = "[This.GetName]: Next spawn province = [?This.PRC_current_selected_province^0]"
			if = { 
				limit = { 
					check_variable = { 
						var = PRC_spawned_guerrilla_province 
						value = PRC_max_guerrilla_province 
						compare = greater_than_or_equals
					}
				} 
				log = "[This.GetName]: Spawned enough, break"
				set_temp_variable = { b = 1 }
			}
		}
		set_temp_variable = { var = PRC_state_cell_uprise_cost value = 40 }
	}else_if = {
		limit = {
			check_variable = { PRC_state_guerrilla_cell_strength > 29 }
		}
		set_variable = { PRC_max_guerrilla_province = 3 }
		log = "[This.GetName]: PRC_max_guerrilla_province = [?This.PRC_max_guerrilla_province]"
		for_each_loop = {
			array = PRC_spawned_guerrilla_province_array
			
			break = b
			log = "[This.GetName]: Spawn unit in [?v]"
			create_unit = {
				division = "name = \"Y-chi-tui\" division_template = \"Ychitui\" start_experience_factor = 0.75 start_equipment_factor = 1"
				OWNER = PRC
				allow_spawning_on_enemy_provs = yes
				country_score = { 
					base = 100 
					modifier = { 
						is_in_array = { PRC_current_selected_province = FROM }
						add = 100 
					} 
				} 
			}
			clear_array = PRC_current_selected_province
			remove_from_array = { array = PRC_spawned_guerrilla_province_array index = 0 }
			add_to_array = { PRC_current_selected_province = PRC_spawned_guerrilla_province_array^0 }
			add_to_variable = { PRC_spawned_guerrilla_province = 1 }
			log = "[This.GetName]: Next spawn province = [?This.PRC_current_selected_province^0]"
			if = { 
				limit = { 
					check_variable = { 
						var = PRC_spawned_guerrilla_province 
						value = PRC_max_guerrilla_province 
						compare = greater_than_or_equals
					}
				} 
				log = "[This.GetName]: Spawned enough, break"
				set_temp_variable = { b = 1 }
			}
		}
		set_temp_variable = { var = PRC_state_cell_uprise_cost value = 30 }
	}else_if = {
		limit = {
			check_variable = { PRC_state_guerrilla_cell_strength > 19 }
		}
		set_variable = { PRC_max_guerrilla_province = 2 }
		log = "[This.GetName]: PRC_max_guerrilla_province = [?This.PRC_max_guerrilla_province]"
		for_each_loop = {
			array = PRC_spawned_guerrilla_province_array
			
			break = b
			log = "[This.GetName]: Spawn unit in [?v]"
			create_unit = {
				division = "name = \"Y-chi-tui\" division_template = \"Ychitui\" start_experience_factor = 0.5 start_equipment_factor = 1"
				OWNER = PRC
				allow_spawning_on_enemy_provs = yes
				country_score = { 
					base = 100 
					modifier = { 
						is_in_array = { PRC_current_selected_province = FROM }
						add = 100 
					} 
				} 
			}
			clear_array = PRC_current_selected_province
			remove_from_array = { array = PRC_spawned_guerrilla_province_array index = 0 }
			add_to_array = { PRC_current_selected_province = PRC_spawned_guerrilla_province_array^0 }
			add_to_variable = { PRC_spawned_guerrilla_province = 1 }
			log = "[This.GetName]: Next spawn province = [?This.PRC_current_selected_province^0]"
			if = { 
				limit = { 
					check_variable = { 
						var = PRC_spawned_guerrilla_province 
						value = PRC_max_guerrilla_province 
						compare = greater_than_or_equals
					}
				} 
				log = "[This.GetName]: Spawned enough, break"
				set_temp_variable = { b = 1 }
			}
		}
		set_temp_variable = { var = PRC_state_cell_uprise_cost value = 20 }
	}else = {
		set_variable = { PRC_max_guerrilla_province = 1 }
		log = "[This.GetName]: PRC_max_guerrilla_province = [?This.PRC_max_guerrilla_province]"
		for_each_loop = {
			array = PRC_spawned_guerrilla_province_array
			
			break = b
			log = "[This.GetName]: Spawn unit in [?v]"
			create_unit = {
				division = "name = \"Y-chi-tui\" division_template = \"Ychitui\" start_experience_factor = 0.25 start_equipment_factor = 1"
				OWNER = PRC
				allow_spawning_on_enemy_provs = yes
				country_score = { 
					base = 100 
					modifier = { 
						is_in_array = { PRC_current_selected_province = FROM }
						add = 100 
					} 
				} 
			}
			clear_array = PRC_current_selected_province
			remove_from_array = { array = PRC_spawned_guerrilla_province_array index = 0 }
			add_to_array = { PRC_current_selected_province = PRC_spawned_guerrilla_province_array^0 }
			add_to_variable = { PRC_spawned_guerrilla_province = 1 }
			log = "[This.GetName]: Next spawn province = [?This.PRC_current_selected_province^0]"
			if = { 
				limit = { 
					check_variable = { 
						var = PRC_spawned_guerrilla_province 
						value = PRC_max_guerrilla_province 
						compare = greater_than_or_equals
					}
				} 
				log = "[This.GetName]: Spawned enough, break"
				set_temp_variable = { b = 1 }
			}
		}
		set_temp_variable = { var = PRC_state_cell_uprise_cost value = 10 }
	}
	log = "[This.GetName]: Uprise effect finished"
}

PRC_uprise_in_state_effect_legacy = {
	if = {
		limit = {
			check_variable = { PRC_state_guerrilla_cell_strength > 39 }
		}
		meta_effect = {
			text = {
				ROOT = { load_oob = "PRC_guerrilla_[STATE_ID]_40" }
			}
			STATE_ID = "[?This.KMT_dcat_sprite_id_num]"
		}
		set_temp_variable = { var = PRC_state_cell_uprise_cost value = 40 }
	}else_if = {
		limit = {
			check_variable = { PRC_state_guerrilla_cell_strength > 29 }
		}
		meta_effect = {
			text = {
				ROOT = { load_oob = "PRC_guerrilla_[STATE_ID]_30" }
			}
			STATE_ID = "[?This.KMT_dcat_sprite_id_num]"
		}
		set_temp_variable = { var = PRC_state_cell_uprise_cost value = 30 }
	}else_if = {
		limit = {
			check_variable = { PRC_state_guerrilla_cell_strength > 19 }
		}
		meta_effect = {
			text = {
				ROOT = { load_oob = "PRC_guerrilla_[STATE_ID]_20" }
			}
			STATE_ID = "[?This.KMT_dcat_sprite_id_num]"
		}
		set_temp_variable = { var = PRC_state_cell_uprise_cost value = 20 }
	}else = {
		meta_effect = {
			text = {
				ROOT = { load_oob = "PRC_guerrilla_[STATE_ID]_10" }
			}
			STATE_ID = "[?This.KMT_dcat_sprite_id_num]"
		}
		set_temp_variable = { var = PRC_state_cell_uprise_cost value = 10 }
	}
}

KMT_ps_update_pop_sup = {

	set_variable = { global.KMT_highest_pop_sup = 0 }

	every_country = {
		limit = {
			is_valid_power_struggle_participant = yes
		}
		set_variable = { KMT_ps_total_pop_sup = 0 }
	}

	every_country = {
		limit = {
			is_valid_power_struggle_participant = yes
		}
		every_state = {
			limit = {
				has_state_flag = KMT_china_inalienable_part
				check_variable = { THIS.KMT_pop_support@PREV > 0 }
			}
			add_to_variable = { PREV.KMT_ps_total_pop_sup = THIS.KMT_pop_support@PREV }
			if = {
				limit = {
					any_country = { is_in_array = { THIS.KMT_ps_alliance_array = PREV.PREV }}
				}
				random_country = {
					limit = { 
						OR = {
							is_in_array = { THIS.KMT_ps_alliance_array = PREV.PREV }
							AND = {
								ROOT = { tag = event_target:KMT_central_gov_tag }
								has_completed_focus = KMT_new_model_region
							}
						}
					}
					add_to_variable = { THIS.KMT_ps_total_pop_sup = PREV.KMT_pop_support@PREV.PREV }
				}
			}
		}
	}
	
	every_country = {
		limit = {
			is_valid_power_struggle_participant = yes
		}
		if = {
			limit = { check_variable = { THIS.KMT_ps_total_pop_sup > global.KMT_highest_pop_sup }}
			every_country = {
				limit = { has_country_flag = KMT_ps_highest_pop_sup_tag }
				clr_country_flag = KMT_ps_highest_pop_sup_tag
			}
			set_country_flag = KMT_ps_highest_pop_sup_tag
			set_variable = { global.KMT_highest_pop_sup = THIS.KMT_ps_total_pop_sup }
		}
	}
}

KMT_ps_update_auth_sup = {

	set_variable = { global.KMT_total_auth_support_cap_temp = 0 }
	
			
	every_state = {
		limit = {
			has_state_flag = KMT_china_inalienable_part
			owner = {
			}
		}
		add_to_variable = { global.KMT_total_auth_support_cap_temp = KMT_power_struggle_auth_support_total }
	}

	every_country = {
		limit = {
			is_chinese_nations_w_HYQ = yes
		}
		set_variable = { KMT_total_auth_support_temp = 0 }
	}
	
	every_state = {
		limit = {
			is_core_of = event_target:KMT_central_gov_tag
		}
		add_to_variable = { KMT_central_gov_tag.KMT_total_auth_support_temp = KMT_CHI_auth_support }
	}
			
	event_target:KMT_central_gov_tag = { 
		set_variable = { KMT_total_auth_support_debug = KMT_total_auth_support_temp }
		divide_variable = { KMT_total_auth_support_temp = global.KMT_total_auth_support_cap_temp }
		multiply_variable = { KMT_total_auth_support_temp = 100 }
		set_variable = { KMT_total_auth_support = KMT_total_auth_support_temp }
	}
	
	every_state = {
		limit = {
			is_core_of = event_target:KMT_central_gov_tag
			owner = { tag = GXC }
		}
		add_to_variable = { GXC.KMT_total_auth_support_temp = KMT_GXC_auth_support }
	}
	
	GXC = { 
		set_variable = { KMT_total_auth_support_debug = KMT_total_auth_support_temp }
		divide_variable = { KMT_total_auth_support_temp = global.KMT_total_auth_support_cap_temp }
		multiply_variable = { KMT_total_auth_support_temp = 100 }
		set_variable = { KMT_total_auth_support = KMT_total_auth_support_temp }
	}
	
	every_state = {
		limit = {
			is_core_of = event_target:KMT_central_gov_tag
		}
		add_to_variable = { QIA.KMT_total_auth_support_temp = KMT_QIA_auth_support }
	}
	
	QIA = { 
		set_variable = { KMT_total_auth_support_debug = KMT_total_auth_support_temp }
		divide_variable = { KMT_total_auth_support_temp = global.KMT_total_auth_support_cap_temp }
		multiply_variable = { KMT_total_auth_support_temp = 100 }
		set_variable = { KMT_total_auth_support = KMT_total_auth_support_temp }
	}
	
	every_state = {
		limit = {
			is_core_of = event_target:KMT_central_gov_tag
		}
		add_to_variable = { SCC.KMT_total_auth_support_temp = KMT_SCC_auth_support }
	}
	
	SCC = { 
		set_variable = { KMT_total_auth_support_debug = KMT_total_auth_support_temp }
		divide_variable = { KMT_total_auth_support_temp = global.KMT_total_auth_support_cap_temp }
		multiply_variable = { KMT_total_auth_support_temp = 100 }
		set_variable = { KMT_total_auth_support = KMT_total_auth_support_temp }
	}
	
	every_state = {
		limit = {
			is_core_of = event_target:KMT_central_gov_tag
		}
		add_to_variable = { SDC.KMT_total_auth_support_temp = KMT_SDC_auth_support }
	}
	
	SDC = { 
		set_variable = { KMT_total_auth_support_debug = KMT_total_auth_support_temp }
		divide_variable = { KMT_total_auth_support_temp = global.KMT_total_auth_support_cap_temp }
		multiply_variable = { KMT_total_auth_support_temp = 100 }
		set_variable = { KMT_total_auth_support = KMT_total_auth_support_temp }
	}
	
	every_state = {
		limit = {
			is_core_of = event_target:KMT_central_gov_tag
		}
		add_to_variable = { SIK.KMT_total_auth_support_temp = KMT_SIK_auth_support }
	}
	
	SIK = { 
		set_variable = { KMT_total_auth_support_debug = KMT_total_auth_support_temp }
		divide_variable = { KMT_total_auth_support_temp = global.KMT_total_auth_support_cap_temp }
		multiply_variable = { KMT_total_auth_support_temp = 100 }
		set_variable = { KMT_total_auth_support = KMT_total_auth_support_temp }
	}
	
	every_state = {
		limit = {
			is_core_of = event_target:KMT_central_gov_tag
		}
		add_to_variable = { SKC.KMT_total_auth_support_temp = KMT_SKC_auth_support }
	}
	
	SKC = { 
		set_variable = { KMT_total_auth_support_debug = KMT_total_auth_support_temp }
		divide_variable = { KMT_total_auth_support_temp = global.KMT_total_auth_support_cap_temp }
		multiply_variable = { KMT_total_auth_support_temp = 100 }
		set_variable = { KMT_total_auth_support = KMT_total_auth_support_temp }
	}
	
	every_state = {
		limit = {
			is_core_of = event_target:KMT_central_gov_tag
		}
		add_to_variable = { SHX.KMT_total_auth_support_temp = KMT_SHX_auth_support }
	}
	
	SHX = { 
		set_variable = { KMT_total_auth_support_debug = KMT_total_auth_support_temp }
		divide_variable = { KMT_total_auth_support_temp = global.KMT_total_auth_support_cap_temp }
		multiply_variable = { KMT_total_auth_support_temp = 100 }
		set_variable = { KMT_total_auth_support = KMT_total_auth_support_temp }
	}
	
	every_state = {
		limit = {
			is_core_of = event_target:KMT_central_gov_tag
		}
		add_to_variable = { XIA.KMT_total_auth_support_temp = KMT_XIA_auth_support }
	}
	
	XIA = { 
		set_variable = { KMT_total_auth_support_debug = KMT_total_auth_support_temp }
		divide_variable = { KMT_total_auth_support_temp = global.KMT_total_auth_support_cap_temp }
		multiply_variable = { KMT_total_auth_support_temp = 100 }
		set_variable = { KMT_total_auth_support = KMT_total_auth_support_temp }
	}
	
	every_state = {
		limit = {
			is_core_of = event_target:KMT_central_gov_tag
		}
		add_to_variable = { XSM.KMT_total_auth_support_temp = KMT_XSM_auth_support }
	}
	
	XSM = { 
		set_variable = { KMT_total_auth_support_debug = KMT_total_auth_support_temp }
		divide_variable = { KMT_total_auth_support_temp = global.KMT_total_auth_support_cap_temp }
		multiply_variable = { KMT_total_auth_support_temp = 100 }
		set_variable = { KMT_total_auth_support = KMT_total_auth_support_temp }
	}
	
	every_state = {
		limit = {
			is_core_of = event_target:KMT_central_gov_tag
		}
		add_to_variable = { YUN.KMT_total_auth_support_temp = KMT_YUN_auth_support }
	}
	
	YUN = { 
		set_variable = { KMT_total_auth_support_debug = KMT_total_auth_support_temp }
		divide_variable = { KMT_total_auth_support_temp = global.KMT_total_auth_support_cap_temp }
		multiply_variable = { KMT_total_auth_support_temp = 100 }
		set_variable = { KMT_total_auth_support = KMT_total_auth_support_temp }
	}
	
	every_state = {
		limit = {
			is_core_of = event_target:KMT_central_gov_tag
		}
		add_to_variable = { YUT.KMT_total_auth_support_temp = KMT_YUT_auth_support }
	}
	
	YUT = { 
		set_variable = { KMT_total_auth_support_debug = KMT_total_auth_support_temp }
		divide_variable = { KMT_total_auth_support_temp = global.KMT_total_auth_support_cap_temp }
		multiply_variable = { KMT_total_auth_support_temp = 100 }
		set_variable = { KMT_total_auth_support = KMT_total_auth_support_temp }
	}
	
	every_state = {
		limit = {
			is_core_of = event_target:KMT_central_gov_tag
		}
		add_to_variable = { ZXL.KMT_total_auth_support_temp = KMT_ZXL_auth_support }
	}
	
	ZXL = { 
		set_variable = { KMT_total_auth_support_debug = KMT_total_auth_support_temp }
		divide_variable = { KMT_total_auth_support_temp = global.KMT_total_auth_support_cap_temp }
		multiply_variable = { KMT_total_auth_support_temp = 100 }
		set_variable = { KMT_total_auth_support = KMT_total_auth_support_temp }
	}
}

KMT_ps_update_ip = {
	every_country = {
		limit = {
			is_valid_power_struggle_participant = yes
		}
		set_variable = { KMT_ps_available_ip_max = 0 }
		if = {
			limit = {
				tag = event_target:KMT_central_gov_tag
			}
			add_to_variable = { KMT_ps_available_ip_max = 4 }
		}else = {
			add_to_variable = { KMT_ps_available_ip_max = 1 }
		}
		set_temp_variable = { KMT_temp_stabi = stability }
		multiply_temp_variable = { KMT_temp_stabi = 10 }
		subtract_from_temp_variable = { KMT_temp_stabi = 3.5 }
		if = { limit = { check_variable = { KMT_temp_stabi < 0 }} set_temp_variable = { KMT_temp_stabi = 0 }}
		round_temp_variable = KMT_temp_stabi
		add_to_variable = { KMT_ps_available_ip_max = KMT_temp_stabi }
		if = {
			limit = {
				is_in_array = { global.KMT_ps_alliance_leaders = THIS }
			}
			subtract_from_variable = { KMT_ps_available_ip_max = 1 }
		}
		if = {
			limit = {
				tag = event_target:KMT_central_gov_tag
			}
			add_to_variable = { KMT_ps_available_ip_max = global.KMT_gc_max_ip_from_loyal_warlords }
		}
		if = {
			limit = {
				has_completed_focus = KMT_spread_propaganda
			}
			add_to_variable = { KMT_ps_available_ip_max = 2 }
		}
		if = {
			limit = {
				has_completed_focus = KMT_sway_the_people
			}
			add_to_variable = { KMT_ps_available_ip_max = 3 }
		}
		if = {
			limit = {
				has_completed_focus = KMT_maintain_regional_presence
			}
			add_to_variable = { KMT_ps_available_ip_max = 1 }
		}
		if = {
			limit = {
				has_completed_focus = PRC_propaganda_press
			}
			add_to_variable = { KMT_ps_available_ip_max = 5 }
		}
		if = {
			limit = {
				has_completed_focus = KMT_promise_of_prosperity
			}
			set_temp_variable = { KMT_ps_additional_stabil_ip = stability }
			multiply_temp_variable = { KMT_ps_additional_stabil_ip = 10 }
			divide_temp_variable = { KMT_ps_additional_stabil_ip = 2 }
			round_temp_variable = KMT_ps_additional_stabil_ip
			add_to_variable = { KMT_ps_available_ip_max = KMT_ps_additional_stabil_ip }
		}
		if = {
			limit = {
				has_completed_focus = KMT_promise_of_prosperity
			}
			set_temp_variable = { KMT_ps_additional_ws_ip = war_support }
			multiply_temp_variable = { KMT_ps_additional_ws_ip = 10 }
			divide_temp_variable = { KMT_ps_additional_ws_ip = 2 }
			round_temp_variable = KMT_ps_additional_ws_ip
			add_to_variable = { KMT_ps_available_ip_max = KMT_ps_additional_ws_ip }
		}
		if = {
			limit = {
				has_completed_focus = KMT_promise_of_prosperity
			}
			set_temp_variable = { KMT_ps_additional_popularity_ip = party_popularity_100@ruling_party }
			divide_temp_variable = { KMT_ps_additional_popularity_ip = 30 }
			round_temp_variable = KMT_ps_additional_popularity_ip
			add_to_variable = { KMT_ps_available_ip_max = KMT_ps_additional_popularity_ip }
		}
		if = {
			limit = {
				check_variable = { KMT_ps_ip_spent > KMT_ps_available_ip_max }
			}
			country_event = { id = loop.5 }
		}
	}
}

#requires a country={state={}} scope and declaration of KMT_pop_support_increment@PREV first
#requires event target  KMT_ps_pop_sup_temp_state
#This effect is advised to be called in the state scope
#KMT_pop_support_increment@PREV should be declared in the state scope, or in the way as state_id.KMT_pop_support_increment@PREV
KMT_increase_pop_supportTHIS = {	
	custom_effect_tooltip = KMT_increase_pop_sup_in_state_tt													
	hidden_effect = {
		add_to_variable = { KMT_pop_support@PREV = KMT_pop_support_increment@PREV }
		#event_target:KMT_central_gov_tag = { country_event = { id = loop.7 }}		#test event
		set_variable = { KMT_ps_pop_sup_temp_state.KMT_state_sup_total = 0 }		#reset total amount of support
		every_country = {															#add up amount of support of every valid participant to reflect new total amount of support	
			limit = {
				check_variable = { KMT_ps_pop_sup_temp_state.KMT_pop_support@THIS > 0 } 								#PREV returns state, THIS returns country tag
			}
			add_to_variable = { KMT_ps_pop_sup_temp_state.KMT_state_sup_total = KMT_ps_pop_sup_temp_state.KMT_pop_support@THIS }		#PREV returns state, THIS returns country tag
			#THIS = { save_global_event_target_as = KMT_test_tag_2 }
			#event_target:KMT_central_gov_tag = { country_event = { id = loop.10 }}		#test event
		}
		if = {
			limit = {
				check_variable = { KMT_ps_pop_sup_temp_state.KMT_state_sup_total > KMT_ps_pop_sup_temp_state.KMT_power_struggle_pop_support_total }		#total amount of support > 100, exception
			}
			#set_variable = { global.KMT_state_sup_total_test = KMT_ps_pop_sup_temp_state.KMT_state_sup_total}
			state_event = { id = loop.6 } 												#prevent pop_sup go over total
			#event_target:KMT_central_gov_tag = { country_event = { id = loop.9 }}
		}
	}
}


KMT_deduct_pop_supportROOT = {	
	custom_effect_tooltip = KMT_reduce_pop_sup_in_state_tt
	hidden_effect = {
		if = {
			limit = {
				check_variable = { KMT_pop_support_reduction@ROOT > KMT_pop_support@ROOT }
			}
			set_variable = { KMT_pop_support_reduction@ROOT > KMT_pop_support@ROOT }
		}
		subtract_from_variable = { KMT_pop_support@ROOT = KMT_pop_support_reduction@ROOT }
	}
}

KMT_mck_break_free_ideo_pop = {	
	set_temp_variable = { MCK_temp_neut = party_popularity@neutrality }
	set_temp_variable = { MCK_temp_fasc = party_popularity@fascism }
	set_temp_variable = { MCK_temp_demo = party_popularity@democratic }
	set_temp_variable = { MCK_temp_comm = party_popularity@communism }
	hidden_effect = {
		country_event = { id = wd.1 }
	}
	if = {
		limit = {
			check_variable = { MCK_temp_govnt = 1 }
		}
		set_politics = {
			ruling_party = neutrality
		}
		else = {
			if = {
				limit = {
					check_variable = { MCK_temp_govnt = 2 }
				}
				set_politics = {
					ruling_party = fascism
				}
				else = {
					if = {
						limit = {
							check_variable = { MCK_temp_govnt = 3 }
						}
						set_politics = {
							ruling_party = communism
						}
						else = {
							if = {
								limit = {
									check_variable = { MCK_temp_govnt = 4 }
								}
								set_politics = {
									ruling_party = democratic
								}
							}
						}
					}
				}
			}
		}
	}

	if = {
		limit = {
			has_government = neutrality
		}
		add_popularity = {
			ideology = neutrality
			popularity = -1
		}
		add_popularity = {
			ideology = democratic
			popularity = MCK_temp_demo
		}
		add_popularity = {
			ideology = communism
			popularity = MCK_temp_comm
		}
		add_popularity = {
			ideology = fascism
			popularity = MCK_temp_fasc
		}		
		add_popularity = {
			ideology = neutrality
			popularity = MCK_temp_neut
		}
		else = {
			if = {
				limit = {
					has_government = democratic
				}
				add_popularity = {
					ideology = democratic
					popularity = -1
				}
				add_popularity = {
					ideology = communism
					popularity = MCK_temp_comm
				}
				add_popularity = {
					ideology = fascism
					popularity = MCK_temp_fasc
				}		
				add_popularity = {
					ideology = neutrality
					popularity = MCK_temp_neut
				}
				add_popularity = {
					ideology = democratic
					popularity = MCK_temp_demo
				}
				else = {
					if = {
						limit = {
							has_government = fascism
						}
						add_popularity = {
							ideology = fascism
							popularity = -1
						}	
						add_popularity = {
							ideology = communism
							popularity = MCK_temp_comm
						}
						add_popularity = {
							ideology = neutrality
							popularity = MCK_temp_neut
						}
						add_popularity = {
							ideology = democratic
							popularity = MCK_temp_demo
						}
						add_popularity = {
							ideology = fascism
							popularity = MCK_temp_fasc
						}	
						else = {
							if = {
								limit = {
									has_government = communism
								}
								add_popularity = {
									ideology = communism
									popularity = -1
								}
								add_popularity = {
									ideology = neutrality
									popularity = MCK_temp_neut
								}
								add_popularity = {
									ideology = democratic
									popularity = MCK_temp_demo
								}
								add_popularity = {
									ideology = fascism
									popularity = MCK_temp_fasc
								}		
								add_popularity = {
									ideology = communism
									popularity = MCK_temp_comm
								}
							}
						}
					}
				}
			}
		}
	}
}

update_reconc_cost = {
	set_variable = { MCK_RFP_reconciliation_cost = MCK_RFP_readinessV }
	multiply_variable = { MCK_RFP_reconciliation_cost = MCK_RFP_mood }
	add_to_variable = { MCK_RFP_reconciliation_cost = MCK_RFP_reconciliation_cost_base }
}

#require definition of MCK_RFP_mood_increase
add_mood = {
	add_to_variable = { MCK_RFP_mood = MCK_RFP_mood_increase }
	if = {
		limit = {
			check_variable = { MCK_RFP_mood > 6 }
		}
		set_variable = { MCK_RFP_mood = 6 }
	}
	if = {
		limit = {
			check_variable = { MCK_RFP_mood < -6 }
		}
		set_variable = { MCK_RFP_mood = -6 }
	}
}

#require prior declaration of temp variable PRC.PRC_mao_power_change
change_mao_power = {
	custom_effect_tooltip = PRC_change_mao_power_tt
	add_to_variable = { PRC.PRC_ips_mao_support = PRC.PRC_mao_power_change }
	if = {
		limit = {
			check_variable = { PRC.PRC_ips_mao_support < 0 }
		}
		set_variable = { PRC.PRC_ips_mao_support = 0 }
	}
}

#require prior declaration of temp variable PRC.PRC_wang_power_change
change_wang_power = {
	custom_effect_tooltip = PRC_change_wang_power_tt
	add_to_variable = { PRC.PRC_ips_wang_support = PRC.PRC_wang_power_change }
	if = {
		limit = {
			check_variable = { PRC.PRC_ips_wang_support < 0 }
		}
		set_variable = { PRC.PRC_ips_wang_support = 0 }
	}
}

#require prior declaration of temp variable PRC.PRC_zhang_power_change
change_zhang_power = {
	if = {
		limit = {
			NOT = { has_country_flag = PRC_absconded }
		}
		custom_effect_tooltip = PRC_change_zhang_power_tt
		add_to_variable = { PRC.PRC_ips_zhang_support = PRC.PRC_zhang_power_change }
		if = {
			limit = {
				check_variable = { PRC.PRC_ips_zhang_support < 0 }
			}
			set_variable = { PRC.PRC_ips_zhang_support = 0 }
		}
	}
}

KMT_zxlprc_border_war = {
	random_state = {
		limit = {
			OWNER = {
				tag = ZXL
				has_full_control_of_state = PREV
			}
			any_neighbor_state = {
				OWNER = { 
					tag = PRC 
					has_full_control_of_state = PREV
				}
			}
		}
		save_global_event_target_as = KMT_zxl_offensive_state
		random_state = {
			limit = {
				any_neighbor_state = {
					state = PREV.PREV
				}
				OWNER = { 
					tag = PRC
					has_full_control_of_state = PREV
				}
			}
			save_global_event_target_as = KMT_prc_defensive_state
		}
	}
	start_border_war = {
		change_state_after_war = no
		minimum_duration_in_days = 20
		combat_width = 160
		attacker = {
			state = event_target:KMT_zxl_offensive_state
			num_provinces = 4
			on_win = kmt.604
			on_lose = kmt.605
			on_cancel = kmt.606
			leader_score = {
				base = 1
				modifier = {
					has_id = 3612
					add = 10
				}
			}
			modifier = global.KMT_zxl_border_war_offensive_modifier
		}
		
		defender = {
			state = event_target:KMT_prc_defensive_state
			num_provinces = 3
			on_win = kmt.604
			on_lose = kmt.605
			on_cancel = kmt.606
			modifier = 1
		}
	}
}

PRC_update_long_march_debuff = {
	set_variable = { PRC.PRC_long_march_debuff_conscription = -0.95 }
	multiply_variable = { PRC.PRC_long_march_debuff_conscription = PRC.PRC_long_march_debuff_base }
	multiply_variable = { PRC.PRC_long_march_debuff_conscription = 0.01 }
	set_variable = { PRC.PRC_long_march_debuff_conscription_factor = -0.015 }
	multiply_variable = { PRC.PRC_long_march_debuff_conscription_factor = PRC.PRC_long_march_debuff_base }
	set_variable = { PRC.PRC_long_march_debuff_reinforce_rate = -0.02 }
	multiply_variable = { PRC.PRC_long_march_debuff_reinforce_rate = PRC.PRC_long_march_debuff_base }
	set_variable = { PRC.PRC_long_march_debuff_organisation = -0.05 }
	multiply_variable = { PRC.PRC_long_march_debuff_organisation = PRC.PRC_long_march_debuff_base }
	set_variable = { PRC.PRC_long_march_debuff_attack = -0.05 }
	multiply_variable = { PRC.PRC_long_march_debuff_attack = PRC.PRC_long_march_debuff_base }
	set_variable = { PRC.PRC_long_march_debuff_defense = -0.05 }
	multiply_variable = { PRC.PRC_long_march_debuff_defense = PRC.PRC_long_march_debuff_base }
	set_variable = { PRC.PRC_long_march_debuff_planning_speed = -0.025 }
	multiply_variable = { PRC.PRC_long_march_debuff_planning_speed = PRC.PRC_long_march_debuff_base }
	set_variable = { PRC.PRC_long_march_debuff_training_time = 0.1 }
	multiply_variable = { PRC.PRC_long_march_debuff_training_time = PRC.PRC_long_march_debuff_base }
	set_variable = { PRC.PRC_long_march_debuff_stability = -0.05 }
	multiply_variable = { PRC.PRC_long_march_debuff_stability = PRC.PRC_long_march_debuff_base }
	set_variable = { PRC.PRC_long_march_debuff_war_support = -0.01 }
	multiply_variable = { PRC.PRC_long_march_debuff_war_support = PRC.PRC_long_march_debuff_base }
}

PRC_lower_long_march_lvl_by1 = {
	if = {
		limit = {
			check_variable = { PRC.PRC_long_march_debuff_base > 0 }
		}
		if = {
			limit = {
				check_variable = { PRC.PRC_long_march_debuff_base > 1 }
			}
			custom_effect_tooltip = PRC_lower_long_march_lvl_by1_tt
		}else = {
			custom_effect_tooltip = PRC_remove_long_march_debuff_tt
			hidden_effect = {
				remove_dynamic_modifier = { modifier = PRC_long_march_debuff }
			}
		}
		subtract_from_variable = { PRC.PRC_long_march_debuff_base = 1 }
		PRC_update_long_march_debuff = yes
	}
}

update_cg_loyalty = {
	hidden_effect = {
		random_country = {
			limit = {
				tag = event_target:KMT_central_gov_tag
			}
			every_country = {
				limit = {
					is_valid_power_struggle_participant = yes
					NOT = { tag = PREV }
				}
				set_variable = { THIS.KMT_ps_loyalty@KMT_central_gov_tag = THIS.KMT_ps_loyalty@PREV }
			}
		}
	}
}

#requires declaration of THIS.KMT_ps_loyalty_change variable(not temp_variable)
KMT_ps_change_loyalty = {
	if = {
		limit = { has_event_target = KMT_central_gov_tag }
		if = {
			limit = { check_variable = { global.KMT_ps_loyalty_change = 0 }}
			set_temp_variable = { global.KMT_ps_loyalty_change = THIS.KMT_ps_loyalty_change }
			set_variable = { THIS.KMT_ps_loyalty_change = 0 }
		}else = {
			custom_effect_tooltip = KMT_ps_change_loyalty_temp_var
		}
		if = {
			limit = { has_completed_focus = KMT_neutral_stance }
			divide_temp_variable = { global.KMT_ps_loyalty_change = 2 }
			round_temp_variable = global.KMT_ps_loyalty_change
		}
		hidden_effect = {
			event_target:KMT_central_gov_tag = {
				add_to_variable = { PREV.KMT_ps_loyalty@THIS = global.KMT_ps_loyalty_change }
				clamp_variable = {
					var = PREV.KMT_ps_loyalty@THIS
					min = -100
					max = 100
				}
			}
		}
	}
}

update_cg_inalienable_parts = {
	hidden_effect = {
		clear_array = global.KMT_cg_inalienable_parts
		random_country = {
			limit = {
				tag = event_target:KMT_central_gov_tag
			}
			every_state = {
				limit = {
					is_in_array = { PREV.KMT_considered_inalienable_parts = THIS }
				}
				add_to_array = { global.KMT_cg_inalienable_parts = THIS }
			}
		}
	}
}

increase_zgt_reactionary = {
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea12 }
		swap_ideas = {
			remove_idea = PRC_zgt_reactionary_remnant_idea12
			add_idea = PRC_zgt_reactionary_remnant_idea13
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea11 }
		swap_ideas = {
			remove_idea = PRC_zgt_reactionary_remnant_idea11
			add_idea = PRC_zgt_reactionary_remnant_idea12
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea10 }
		swap_ideas = {
			remove_idea = PRC_zgt_reactionary_remnant_idea10
			add_idea = PRC_zgt_reactionary_remnant_idea11
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea9 }
		swap_ideas = {
			remove_idea = PRC_zgt_reactionary_remnant_idea9
			add_idea = PRC_zgt_reactionary_remnant_idea10
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea8 }
		swap_ideas = {
			remove_idea = PRC_zgt_reactionary_remnant_idea8
			add_idea = PRC_zgt_reactionary_remnant_idea9
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea7 }
		swap_ideas = {
			remove_idea = PRC_zgt_reactionary_remnant_idea7
			add_idea = PRC_zgt_reactionary_remnant_idea8
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea6 }
		swap_ideas = {
			remove_idea = PRC_zgt_reactionary_remnant_idea6
			add_idea = PRC_zgt_reactionary_remnant_idea7
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea5 }
		swap_ideas = {
			remove_idea = PRC_zgt_reactionary_remnant_idea5
			add_idea = PRC_zgt_reactionary_remnant_idea6
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea4 }
		swap_ideas = {
			remove_idea = PRC_zgt_reactionary_remnant_idea4
			add_idea = PRC_zgt_reactionary_remnant_idea5
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea3 }
		swap_ideas = {
			remove_idea = PRC_zgt_reactionary_remnant_idea3
			add_idea = PRC_zgt_reactionary_remnant_idea4
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea2 }
		swap_ideas = {
			remove_idea = PRC_zgt_reactionary_remnant_idea2
			add_idea = PRC_zgt_reactionary_remnant_idea3
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea1 }
		swap_ideas = {
			remove_idea = PRC_zgt_reactionary_remnant_idea1
			add_idea = PRC_zgt_reactionary_remnant_idea2
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea0 }
		swap_ideas = {
			remove_idea = PRC_zgt_reactionary_remnant_idea0
			add_idea = PRC_zgt_reactionary_remnant_idea1
		}
	}
	if = {
		limit = { 
			NOT = {
				has_idea = PRC_zgt_reactionary_remnant_idea0 
				has_idea = PRC_zgt_reactionary_remnant_idea1
				has_idea = PRC_zgt_reactionary_remnant_idea2 
				has_idea = PRC_zgt_reactionary_remnant_idea3 
				has_idea = PRC_zgt_reactionary_remnant_idea4 
				has_idea = PRC_zgt_reactionary_remnant_idea5 
				has_idea = PRC_zgt_reactionary_remnant_idea6 
				has_idea = PRC_zgt_reactionary_remnant_idea7 
				has_idea = PRC_zgt_reactionary_remnant_idea8 
				has_idea = PRC_zgt_reactionary_remnant_idea9 
				has_idea = PRC_zgt_reactionary_remnant_idea10 
				has_idea = PRC_zgt_reactionary_remnant_idea11
				has_idea = PRC_zgt_reactionary_remnant_idea12
				has_idea = PRC_zgt_reactionary_remnant_idea13
			}
		}
		add_ideas = PRC_zgt_reactionary_remnant_idea0
	}
}

decrease_zgt_reactionary = {
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea0 }
		remove_ideas = PRC_zgt_reactionary_remnant_idea0
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea1 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea1
				add_idea = PRC_zgt_reactionary_remnant_idea0
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea2 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea2
				add_idea = PRC_zgt_reactionary_remnant_idea1
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea3 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea3
				add_idea = PRC_zgt_reactionary_remnant_idea2
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea4 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea4
				add_idea = PRC_zgt_reactionary_remnant_idea3
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea5 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea5
				add_idea = PRC_zgt_reactionary_remnant_idea4
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea6 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea6
				add_idea = PRC_zgt_reactionary_remnant_idea5
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea7 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea7
				add_idea = PRC_zgt_reactionary_remnant_idea6
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea8 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea8
				add_idea = PRC_zgt_reactionary_remnant_idea7
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea9 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea9
				add_idea = PRC_zgt_reactionary_remnant_idea8
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea10 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea10
				add_idea = PRC_zgt_reactionary_remnant_idea9
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea11 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea11
				add_idea = PRC_zgt_reactionary_remnant_idea10
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea12 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea12
				add_idea = PRC_zgt_reactionary_remnant_idea11
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea13 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea13
				add_idea = PRC_zgt_reactionary_remnant_idea12
		}
	}
}

increase_zgt_reactionary2 = { 
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea12 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea12
				add_idea = PRC_zgt_reactionary_remnant_idea13
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea11 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea11
				add_idea = PRC_zgt_reactionary_remnant_idea13
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea10 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea10
				add_idea = PRC_zgt_reactionary_remnant_idea12
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea9 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea9
				add_idea = PRC_zgt_reactionary_remnant_idea11
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea8 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea8
				add_idea = PRC_zgt_reactionary_remnant_idea10
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea7 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea7
				add_idea = PRC_zgt_reactionary_remnant_idea9
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea6 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea6
				add_idea = PRC_zgt_reactionary_remnant_idea8
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea5 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea5
				add_idea = PRC_zgt_reactionary_remnant_idea7
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea4 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea4
				add_idea = PRC_zgt_reactionary_remnant_idea6
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea3 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea3
				add_idea = PRC_zgt_reactionary_remnant_idea5
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea2 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea2
				add_idea = PRC_zgt_reactionary_remnant_idea4
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea1 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea1
				add_idea = PRC_zgt_reactionary_remnant_idea3
		}
	}
	if = {
		limit = { has_idea = PRC_zgt_reactionary_remnant_idea0 }
		swap_ideas = {
				remove_idea = PRC_zgt_reactionary_remnant_idea0
				add_idea = PRC_zgt_reactionary_remnant_idea2
		}
	}
	if = {
		limit = { 
			NOT = {
				has_idea = PRC_zgt_reactionary_remnant_idea0 
				has_idea = PRC_zgt_reactionary_remnant_idea1
				has_idea = PRC_zgt_reactionary_remnant_idea2 
				has_idea = PRC_zgt_reactionary_remnant_idea3 
				has_idea = PRC_zgt_reactionary_remnant_idea4 
				has_idea = PRC_zgt_reactionary_remnant_idea5 
				has_idea = PRC_zgt_reactionary_remnant_idea6 
				has_idea = PRC_zgt_reactionary_remnant_idea7 
				has_idea = PRC_zgt_reactionary_remnant_idea8 
				has_idea = PRC_zgt_reactionary_remnant_idea9 
				has_idea = PRC_zgt_reactionary_remnant_idea10 
				has_idea = PRC_zgt_reactionary_remnant_idea11
				has_idea = PRC_zgt_reactionary_remnant_idea12
				has_idea = PRC_zgt_reactionary_remnant_idea13
			}
		}
		add_ideas = PRC_zgt_reactionary_remnant_idea1
	}
}

#higher the suffix number, lower the penalties
lower_lsp1 = { 
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_10 }
		remove_ideas = PRC_lack_skilled_personnel_10
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_9 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_9
			add_idea = PRC_lack_skilled_personnel_10
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_8 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_8
			add_idea = PRC_lack_skilled_personnel_9
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_7 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_7
			add_idea = PRC_lack_skilled_personnel_8
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_6 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_6
			add_idea = PRC_lack_skilled_personnel_7
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_5 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_5
			add_idea = PRC_lack_skilled_personnel_6
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_4 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_4
			add_idea = PRC_lack_skilled_personnel_5
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_3 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_3
			add_idea = PRC_lack_skilled_personnel_4
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_2 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_2
			add_idea = PRC_lack_skilled_personnel_3
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_1 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_1
			add_idea = PRC_lack_skilled_personnel_2
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel
			add_idea = PRC_lack_skilled_personnel_1
		}
	}
}

lower_lsp2 = { 
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_10 }
		remove_ideas = PRC_lack_skilled_personnel_10
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_9 }
		remove_ideas = PRC_lack_skilled_personnel_9
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_8 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_8
			add_idea = PRC_lack_skilled_personnel_10
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_7 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_7
			add_idea = PRC_lack_skilled_personnel_9
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_6 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_6
			add_idea = PRC_lack_skilled_personnel_8
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_5 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_5
			add_idea = PRC_lack_skilled_personnel_7
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_4 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_4
			add_idea = PRC_lack_skilled_personnel_6
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_3 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_3
			add_idea = PRC_lack_skilled_personnel_5
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_2 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_2
			add_idea = PRC_lack_skilled_personnel_4
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_1 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_1
			add_idea = PRC_lack_skilled_personnel_3
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel
			add_idea = PRC_lack_skilled_personnel_2
		}
	}
}

lower_lsp3 = { 
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_10 }
		remove_ideas = PRC_lack_skilled_personnel_10
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_9 }
		remove_ideas = PRC_lack_skilled_personnel_9
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_8 }
		remove_ideas = PRC_lack_skilled_personnel_8
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_7 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_7
			add_idea = PRC_lack_skilled_personnel_10
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_6 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_6
			add_idea = PRC_lack_skilled_personnel_9
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_5 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_5
			add_idea = PRC_lack_skilled_personnel_8
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_4 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_4
			add_idea = PRC_lack_skilled_personnel_7
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_3 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_3
			add_idea = PRC_lack_skilled_personnel_6
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_2 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_2
			add_idea = PRC_lack_skilled_personnel_5
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel_1 }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel_1
			add_idea = PRC_lack_skilled_personnel_4
		}
	}
	if = {
		limit = { has_idea = PRC_lack_skilled_personnel }
		swap_ideas = {
			remove_idea = PRC_lack_skilled_personnel
			add_idea = PRC_lack_skilled_personnel_3
		}
	}
}

update_ndg_legitimacy = {
	if = {
		limit = { check_variable = { global.PRC_ndg_legitimacy > 5 }}
		set_variable = { global.PRC_ndg_legitimacy = 5 }
	}
	if = {
		limit = { check_variable = { global.PRC_ndg_legitimacy < -5 }}
		set_variable = { global.PRC_ndg_legitimacy = -5 }
	}
	
	set_variable = { global.PRC_ndglegi_stab = 0.05 }
	multiply_variable = { global.PRC_ndglegi_stab = global.PRC_ndg_legitimacy }
	
	set_variable = { global.PRC_ndglegi_ws = 0.1 }
	multiply_variable = { global.PRC_ndglegi_ws = global.PRC_ndg_legitimacy }
	if = {
		limit = { check_variable = { global.PRC_ndglegi_ws < 0 }}
		divide_variable = { global.PRC_ndglegi_ws = 2 }
	}
	
	set_variable = { global.PRC_ndglegi_recruitment = 0.025 }
	multiply_variable = { global.PRC_ndglegi_recruitment = global.PRC_ndg_legitimacy }
	if = {
		limit = { check_variable = { global.PRC_ndglegi_recruitment < 0 }}
		multiply_variable = { global.PRC_ndglegi_ws = 0.2 }
	}
	
	set_variable = { global.PRC_ndglegi_bread = -0.05 }
	multiply_variable = { global.PRC_ndglegi_bread = global.PRC_ndg_legitimacy }
}

update_tws_bonus = {
	set_variable = { global.PRC_tws_allies_count = 0 }
	every_country = {
		limit = {
			is_chinese_nations_w_HYQ = yes
			NOT = { tag = PRC }
			is_in_faction_with = ROOT
		}
		add_to_variable = { global.PRC_tws_allies_count = 1 }
	}
	set_variable = { global.PRC_tws_ws = global.PRC_tws_allies_count }
	multiply_variable = { global.PRC_tws_ws = 0.013 }
	set_variable = { global.PRC_tws_pp = global.PRC_tws_allies_count }
	multiply_variable = { global.PRC_tws_pp = 0.01 }
	set_variable = { global.PRC_tws_att = global.PRC_tws_allies_count }
	multiply_variable = { global.PRC_tws_att = 0.006 }
	set_variable = { global.PRC_tws_def = global.PRC_tws_allies_count }
	multiply_variable = { global.PRC_tws_def = 0.006 }
	if = {
		limit = {
			has_completed_focus = PRC_attract_aspirated_intellectuals
		}
		set_temp_variable = { global.PRC_tws_temp_res = global.PRC_tws_res }
		set_variable = { global.PRC_tws_res = global.PRC_tws_allies_count }
		multiply_variable = { global.PRC_tws_res = 0.0005 }
		if = {
			limit = { check_variable = { global.PRC_tws_res < global.PRC_tws_temp_res }}
			set_variable = { global.PRC_tws_res = global.PRC_tws_temp_res }
		}
	}
}

decrease_prc_comintern_autonomy1 = {
	if = {
		limit = { 
			check_variable = { global.PRC_comintern_autonomy < 8 }
		}
		custom_effect_tooltip = PRC_decrease_comintern_autonomy1
		add_to_variable = { global.PRC_comintern_autonomy = 1 }
	}
}

increase_prc_comintern_autonomy1 = {
	if = {
		limit = { 
			OR = {
				AND = {
					check_variable = { global.PRC_comintern_autonomy > 0 }
					is_subject = no
				}
				check_variable = { global.PRC_comintern_autonomy > 3 }
			}
		}
		custom_effect_tooltip = PRC_increase_comintern_autonomy1
		subtract_from_variable = { global.PRC_comintern_autonomy = 1 }
	}
}

increase_ndglegi1 = {
	if = {
		limit = { check_variable = { global.PRC_ndg_legitimacy < 5 }}
		custom_effect_tooltip = PRC_increase_natdef_legitimacy1
		add_to_variable = { global.PRC_ndg_legitimacy = 1 }
		update_ndg_legitimacy = yes
	}
}

decrease_ndglegi1 = {
	if = {
		limit = { check_variable = { global.PRC_ndg_legitimacy > -5 }}
		custom_effect_tooltip = PRC_decrease_natdef_legitimacy1
		subtract_from_variable = { global.PRC_ndg_legitimacy = 1 }
		update_ndg_legitimacy = yes
	}
}

decrease_ndglegi2 = {
	if = {
		limit = { check_variable = { global.PRC_ndg_legitimacy > -5 }}
		custom_effect_tooltip = PRC_decrease_natdef_legitimacy2
		subtract_from_variable = { global.PRC_ndg_legitimacy = 3 }
		update_ndg_legitimacy = yes
	}
}

decrease_ndglegi3 = {
	if = {
		limit = { check_variable = { global.PRC_ndg_legitimacy > -5 }}
		custom_effect_tooltip = PRC_decrease_natdef_legitimacy3
		subtract_from_variable = { global.PRC_ndg_legitimacy = 3 }
		update_ndg_legitimacy = yes
	}
}

decrease_ndglegi5 = {
	if = {
		limit = { check_variable = { global.PRC_ndg_legitimacy > -5 }}
		custom_effect_tooltip = PRC_decrease_natdef_legitimacy5
		subtract_from_variable = { global.PRC_ndg_legitimacy = 5 }
		update_ndg_legitimacy = yes
	}
}

#requires declaration of temp_variable PRC.PRC_accumulated_capital_change
update_accumulated_capital = {
	add_to_variable = { PRC.PRC_accumulated_capital = PRC.PRC_accumulated_capital_change }
	custom_effect_tooltip = PRC_accumulated_capital_change_tt
}

update_collective_farm_capital = {
	set_variable = { PRC.PRC_collective_farm_additional_capital = 0 }
	every_state = {
		limit = { 
			has_dynamic_modifier = { modifier = PRC_collectivised_farm1 }
			is_controlled_by = PRC
		}
		add_to_variable = { PRC.PRC_collective_farm_additional_capital = 0.1 }
	}
	every_state = {
		limit = { 
			has_dynamic_modifier = { modifier = PRC_collectivised_farm2 }
			is_controlled_by = PRC
		}
		add_to_variable = { PRC.PRC_collective_farm_additional_capital = 0.2 }
	}
}

trautmann_truce_effect = {
	#peace
	every_country = {
		limit = {
			OR = {
				tag = event_target:KMT_central_gov_tag
				is_in_faction_with = event_target:KMT_central_gov_tag
				is_subject_of = event_target:KMT_central_gov_tag
			}
		}
		every_country = {
			limit = {
				has_war_with = PREV
				OR = {
					tag = JAP
					is_in_faction_with = JAP
					is_subject_of = JAP
				}
			}
			white_peace = PREV
		}
	}

	#autonomy for inner mongolia
	if = {
		limit = { NOT = { has_global_flag = KMT_trautmann_chi_demanded }}
		if = {
			limit = {
				NOT = { country_exists = MEN }
			}
			every_state = {
				limit = {
					OWNER = {
						OR = {
							tag = event_target:KMT_central_gov_tag
							is_in_faction_with = event_target:KMT_central_gov_tag
							is_subject_of = event_target:KMT_central_gov_tag
							tag = JAP
							is_in_faction_with = JAP
							is_subject_of = JAP
						}
					}
					OR = {
						state = 746
						state = 621
						state = 966
						state = 612
						state = 937
						state = 611
					}
				}
				MEN = {
					transfer_state = PREV
				}
			}
			JAP = {
				set_autonomy = { target = MEN autonomy_state = autonomy_wtt_imperial_protectorate }
			}
		}else_if = {
			limit = { 
				MEN = { 
					OR = {
						is_subject_of = JAP
						is_subject_of = event_target:KMT_central_gov_tag
					}
				}
			}
			every_state = {
				limit = {
					OWNER = {
						OR = {
							tag = event_target:KMT_central_gov_tag
							is_in_faction_with = event_target:KMT_central_gov_tag
							is_subject_of = event_target:KMT_central_gov_tag
							tag = JAP
							is_in_faction_with = JAP
							is_subject_of = JAP
						}
					}
					OR = {
						state = 746
						state = 621
						state = 966
						state = 612
						state = 937
						state = 611
					}
				}
				MEN = {
					transfer_state = PREV
				}
			}
		}else_if = {
			limit = { 
				ECR = { 
					OR = {
						is_subject_of = JAP
						is_subject_of = event_target:KMT_central_gov_tag
					}
				}
			}
			every_state = {
				limit = {
					OWNER = {
						OR = {
							tag = event_target:KMT_central_gov_tag
							is_in_faction_with = event_target:KMT_central_gov_tag
							is_subject_of = event_target:KMT_central_gov_tag
							tag = JAP
							is_in_faction_with = JAP
							is_subject_of = JAP
						}
					}
					OR = {
						state = 746
						state = 621
						state = 966
						state = 612
						state = 937
						state = 611
					}
				}
				ECR = {
					transfer_state = PREV
				}
			}
		}else = {
			every_state = {
				limit = {
					OWNER = {
						OR = {
							tag = event_target:KMT_central_gov_tag
							is_in_faction_with = event_target:KMT_central_gov_tag
							is_subject_of = event_target:KMT_central_gov_tag
							tag = JAP
							is_in_faction_with = JAP
							is_subject_of = JAP
						}
					}
					OR = {
						state = 746
						state = 621
						state = 966
						state = 612
						state = 937
						state = 611
					}
				}
				JAP = {
					transfer_state = PREV
				}
			}
		}
	}
	
	#cooperation with japan
	event_target:KMT_central_gov_tag = {
		add_ideas = KMT_trautmann_peace
		add_ideas = KMT_trautmann_peace_malus
		if = {
			limit = { is_faction_leader = yes }
			dismantle_faction = yes
		}
		if = {
			limit = { 
				any_other_country = {
					is_chinese_nations_w_HYQ = yes
					has_government = communism
				}
			}
			every_other_country = {
				limit = {
					is_chinese_nations_w_HYQ = yes
					has_government = communism
				}
				PREV = { 
					create_wargoal = {
						target = PREV
						type = civil_war
					}
					diplomatic_relation = { relation = non_aggression_pact country = PREV active = no }
				}
			}
		}
	}
	JAP = { diplomatic_relation = { country = event_target:KMT_central_gov_tag relation = guarantee active = yes }}
	if = {
		limit = { check_variable = { global.KMT_trautmann_jap_demand_level = 1 }}
		every_state = {
			limit = {
				is_in_array = { KMT_central_gov_tag.KMT_considered_inalienable_parts = THIS }
				is_owned_by = MCK
			}
			remove_core_of = event_target:KMT_central_gov_tag
			remove_from_array = { KMT_central_gov_tag.KMT_considered_inalienable_parts = THIS }
		}
		event_target:KMT_central_gov_tag = { diplomatic_relation = { country = MCK relation = guarantee active = yes }}
		JAP = { diplomatic_relation = { country = event_target:KMT_central_gov_tag relation = military_access active = yes }}
		JAP = { diplomatic_relation = { country = event_target:KMT_central_gov_tag relation = docking_rights active = yes }}
	}
	
	#reparation to japan
	if = {
		limit = { check_variable = { global.KMT_trautmann_jap_demand_level = 1 }}
		event_target:KMT_central_gov_tag = { 
			add_timed_idea = {
				idea = KMT_reparation_to_jap
				days = 3600
			}
		}
		JAP = {
			add_ideas = KMT_reparation_from_chi
		}
	}
	
	#kill jap chinese puppets
	if = {
		limit = {
			has_global_flag = KMT_trautmann_chi_demanded
			event_target:KMT_central_gov_tag = { NOT = { is_subject_of = JAP }}
		}
		if = {
			limit = { EHA = { owns_state = 609 }}
			JAP = { transfer_state = 609 }
		}
		every_country = {
			limit = {
				OR = {
					is_chinese_nations_w_HYQ = yes
					tag = MEN
					tag = ECR
					tag = EHA
					tag = PGR
					tag = RGR
					tag = WJW
				}
				is_subject_of = JAP
			}
			event_target:KMT_central_gov_tag = {
				annex_country = {
					target = PREV
				}
			}
		}
	}
	
	#demilitarise northern china
	if = {
		limit = { 
			NOT = { 
				country_exists = PGR 
				has_global_flag = KMT_trautmann_chi_demanded
			}
		}
		every_state = {
			limit = {
				OWNER = {
					OR = {
						tag = event_target:KMT_central_gov_tag
						is_subject_of = event_target:KMT_central_gov_tag
						tag = SDC
					}
				}
				OR = {
					region = 143 
					region = 245 
				}
				NOT = {
					state = 613
					state = 937
					state = 611
					state = 612
				}
			}
			PGR = { transfer_state = PREV }
		}
		JAP = { set_autonomy = { target = PGR autonomy_state = autonomy_wtt_imperial_protectorate }}
		if = {
			limit = { 
				EHA = { 
					is_subject_of = JAP
					exists = yes
				}
			}
			PGR = { annex_country = { target = EHA transfer_troops = yes }}
		}
		PGR = { 
			set_cosmetic_tag = JAP_kahoku_autonomy 
			add_popularity = {
				ideology = fascism
				popularity = 0.9
			}
			if = { limit = { has_character = PGR_song_zheyuan } retire_character = PGR_song_zheyuan }
			if = { limit = { has_character = PGR_zhao_dengyu } retire_character = PGR_zhao_dengyu }
			if = { limit = { has_character = PGR_wan_fulin } retire_character = PGR_wan_fulin }
			if = { limit = { has_character = PGR_liu_zhensan } retire_character = PGR_liu_zhensan }
			if = { limit = { has_character = PGR_dong_linge } retire_character = PGR_dong_linge }
			if = { limit = { has_character = PGR_wang_shuchang } retire_character = PGR_wang_shuchang }
		}
	}else_if = {
		limit = { 
			country_exists = PGR 
		}
		every_state = {
			limit = {
				OWNER = {
					OR = {
						tag = event_target:KMT_central_gov_tag
						is_subject_of = event_target:KMT_central_gov_tag
						tag = SDC
					}
				}
				OR = {
					region = 143
					region = 245
				}
				NOT = {
					state = 613
					state = 937
					state = 611
					state = 612
				}
			}
			PGR = { transfer_state = PREV }
		}
		if = {
			limit = { PGR = { NOT = { is_subject_of = JAP }}}
			JAP = { set_autonomy = { target = PGR autonomy_state = autonomy_wtt_imperial_protectorate }}
		}
		if = {
			limit = { 
				EHA = { 
					is_subject_of = JAP
					exists = yes
				}
			}
			PGR = { annex_country = { target = EHA transfer_troops = yes }}
		}
		PGR = { 
			set_cosmetic_tag = JAP_kahoku_autonomy 
			add_popularity = {
				ideology = fascism
				popularity = 0.9
			}
			if = { limit = { has_character = PGR_song_zheyuan } retire_character = PGR_song_zheyuan }
			if = { limit = { has_character = PGR_zhao_dengyu } retire_character = PGR_zhao_dengyu }
			if = { limit = { has_character = PGR_wan_fulin } retire_character = PGR_wan_fulin }
			if = { limit = { has_character = PGR_liu_zhensan } retire_character = PGR_liu_zhensan }
			if = { limit = { has_character = PGR_dong_linge } retire_character = PGR_dong_linge }
			if = { limit = { has_character = PGR_wang_shuchang } retire_character = PGR_wang_shuchang }
		}
	}
	every_state = {
		limit = {
			OR = {
				any_neighbor_state = { 
					OR = {
						is_owned_by = MCK 
						is_owned_by = JAP
						OWNER = { is_subject_of = JAP }
					}
				}
				state = 608
			}
			OWNER = {
				OR = {
					tag = event_target:KMT_central_gov_tag
					is_subject_of = event_target:KMT_central_gov_tag
					is_chinese_nations_w_HYQ = yes
				}
				NOT = {
					is_subject_of = JAP
					is_in_faction_with = JAP
				}
			}
		}
		set_state_flag = KMT_trautmann_truce_demilitarised_zone
		every_state = {
			limit = { 
				KMT_is_in_same_chinese_province_with_PREV = yes 
				NOT = { has_state_flag = KMT_trautmann_truce_demilitarised_zone }
				OWNER = {
					OR = {
						tag = event_target:KMT_central_gov_tag
						is_subject_of = event_target:KMT_central_gov_tag
						is_chinese_nations_w_HYQ = yes
					}
					NOT = {
						is_subject_of = JAP
						is_in_faction_with = JAP
					}
				}
				NOT = { state = 938 }
			}
			set_state_flag = KMT_trautmann_truce_demilitarised_zone
		}
	}
	every_state = {
		limit = {
			OWNER = {
				OR = {
					tag = PRC
					is_subject_of = PRC
					is_in_faction_with = PRC
				}
			}
			NOT = { state = 938 }
			has_state_flag = KMT_trautmann_truce_demilitarised_zone
		}
		clr_state_flag = KMT_trautmann_truce_demilitarised_zone
	}
	every_state = {
		limit = {
			has_state_flag = KMT_trautmann_truce_demilitarised_zone
		}
		set_demilitarized_zone = yes
	}
	
	#demilitarise shanghai
	if = {
		limit = {
			938 = { 
				OWNER = {
					OR = {
						tag = event_target:KMT_central_gov_tag
						is_in_faction_with = event_target:KMT_central_gov_tag
						is_subject_of = event_target:KMT_central_gov_tag
					}
				}
			}
		}
		JAP = { transfer_state = 938 }
	}
	
	if = {
		limit = { 
			PRC = {
				exists = yes
				is_subject = no
			}
		}
		PRC = { country_event = { id = prc.332 }}
	}else = {
		random_country = {
			limit = {
				is_chinese_nations_w_HYQ = yes
				is_subject = no
				NOT = {
					has_idea = KMT_trautmann_peace
					is_in_faction_with = JAP
				}
			}
			country_event = { id = prc.332 }
		}
	}
	
}

PRC_guerrilla_civil_war_uprise = {
	if = {
		limit = {
			CONTROLLER = { 
				OR = { 
					tag = ROOT
					is_in_faction_with = ROOT
					is_subject_of = ROOT
					has_country_flag = PRC_uprise_event_flag
				}
			}
		}
		set_state_flag = PRC_uprise_no_change_controller
	}
	if = {
		limit = {
			CONTROLLER = { 
				NOT = { 
					tag = ROOT
					is_in_faction_with = ROOT
					is_subject_of = ROOT
					has_country_flag = PRC_uprise_event_flag
				}
				is_ai = no
			}
		}
		CONTROLLER = { 
			set_country_flag = PRC_uprise_event_flag
			country_event = { id = prc.307 }
		}
	}
	if = {
		limit = { NOT = { has_state_flag = PRC_uprise_no_change_controller }}
		ROOT = {
			set_state_controller = PREV
		}
	}
	create_unit = { 
		division = "name = \"Jenmin Ch'iichun\" division_template = \"Jenmin Ch'iichun\" start_experience_factor = 0.25 start_equipment_factor = 1" 
		owner = ROOT
	}
	if = {
		limit = {
			check_variable = { PRC_state_guerrilla_cell_strength > 24 }
		}
		create_unit = { 
			division = "name = \"Ychitui\" division_template = \"Ychitui\" start_experience_factor = 1 start_equipment_factor = 1" 
			owner = ROOT
		}
	}
	if = {
		limit = {
			check_variable = { PRC_state_guerrilla_cell_strength > 49 }
		}
		create_unit = { 
			division = "name = \"Ychitui\" division_template = \"Ychitui\" start_experience_factor = 1 start_equipment_factor = 1" 
			owner = ROOT
		}
	}
	if = {
		limit = {
			check_variable = { PRC_state_guerrilla_cell_strength > 74 }
		}
		create_unit = { 
			division = "name = \"Ychitui\" division_template = \"Ychitui\" start_experience_factor = 1 start_equipment_factor = 1" 
			owner = ROOT
		}
		create_unit = { 
			division = "name = \"Ychitui\" division_template = \"Ychitui\" start_experience_factor = 1 start_equipment_factor = 1" 
			owner = ROOT
		}
	}
	if = {
		limit = {
			check_variable = { PRC_state_guerrilla_cell_strength > 99 }
		}
		create_unit = { 
			division = "name = \"Jenmin Ch'iichun\" division_template = \"Jenmin Ch'iichun\" start_experience_factor = 1 start_equipment_factor = 1" 
			owner = ROOT
		}
		create_unit = { 
			division = "name = \"Jenmin Ch'iichun\" division_template = \"Jenmin Ch'iichun\" start_experience_factor = 0.25 start_equipment_factor = 1" 
			owner = ROOT
		}
	}
	if = {
		limit = { 
			check_variable = { PRC_state_guerrilla_cell_strength > 50 }
			is_capital = no
			OWNER = { has_war_with = ROOT }
			NOT = {
				state = 950
				state = 745
				state = 743
				state = 938
				state = 326
				state = 728
				state = 729
			}
		}
		ROOT = { transfer_state = PREV }
		add_compliance = 25
	}else = {
		if = {
			limit = { NOT = { has_state_flag = PRC_uprise_no_change_controller }}
			OWNER = {
				set_state_controller = PREV
			}
		}
	}
	if = {
		limit = { check_variable = { PRC_state_guerrilla_cell_strength > 75 }}
		add_core_of = ROOT
	}
	set_variable = { PRC_state_guerrilla_cell_strength = 0 }
	clr_state_flag = KMT_PRC_state_has_guerrilla_cell
}

KMT_warlord_move_leader_to_communism = {
	if = {
		limit = { NOT = { has_government = communism }}
		if = { limit = { has_country_leader = { character = GXC_li_zongren ruling_only = yes }} GXC_li_zongren = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = SHX_yan_xishan ruling_only = yes }} SHX_yan_xishan = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = PGR_song_zheyuan ruling_only = yes }} PGR_song_zheyuan = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = YUN_long_yun ruling_only = yes }} YUN_long_yun = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = QIA_wang_jialie ruling_only = yes }} QIA_wang_jialie = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = MEN_prince_demchugdongrub ruling_only = yes }} MEN_prince_demchugdongrub = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = SCC_liu_xiang ruling_only = yes }} SCC_liu_xiang = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = SCC_deng_xihou ruling_only = yes }} SCC_deng_xihou = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = ZXL_zhang_xueliang ruling_only = yes }} ZXL_zhang_xueliang = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = ZXL_yang_hucheng ruling_only = yes }} ZXL_yang_hucheng = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = NSM_ma_hongkui ruling_only = yes }} NSM_ma_hongkui = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = XSM_ma_bufang ruling_only = yes }} XSM_ma_bufang = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = SKC_liu_wenhui ruling_only = yes }} SKC_liu_wenhui = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = XIA_he_jian ruling_only = yes }} XIA_he_jian = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = SDC_han_fuju ruling_only = yes }} SDC_han_fuju = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = XIA_zhang_zhizhong ruling_only = yes }} XIA_zhang_zhizhong = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = XIA_cheng_qian ruling_only = yes }} XIA_cheng_qian = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = YUT_chen_jitang ruling_only = yes }} YUT_chen_jitang = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = YUT_yu_hanmou ruling_only = yes }} YUT_yu_hanmou = { set_character_flag = KMT_current_country_leader }}
		#if = { limit = { has_country_leader = { character = CHI_chiang_kaishek ruling_only = yes }} CHI_chiang_kaishek = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = CHI_feng_yuxiang ruling_only = yes }} CHI_feng_yuxiang = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = CHI_he_yingqin ruling_only = yes }} CHI_he_yingqin = { set_character_flag = KMT_current_country_leader }}
		random_character = { 
			limit = { has_character_flag = KMT_current_country_leader }
			add_country_leader_role = {
				country_leader = {
					ideology = anti_revisionism
					expire = "1965.1.1"
					traits = {}
				}
				promote_leader = yes
			}
		}
		every_character = { clr_character_flag = KMT_current_country_leader }
	}
}

KMT_warlord_move_leader_to_fascism = {
	if = {
		limit = { NOT = { has_government = fascism }}
		if = { limit = { has_country_leader = { character = GXC_li_zongren ruling_only = yes }} GXC_li_zongren = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = SHX_yan_xishan ruling_only = yes }} SHX_yan_xishan = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = PGR_song_zheyuan ruling_only = yes }} PGR_song_zheyuan = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = YUN_long_yun ruling_only = yes }} YUN_long_yun = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = QIA_wang_jialie ruling_only = yes }} QIA_wang_jialie = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = MEN_prince_demchugdongrub ruling_only = yes }} MEN_prince_demchugdongrub = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = SCC_liu_xiang ruling_only = yes }} SCC_liu_xiang = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = SCC_deng_xihou ruling_only = yes }} SCC_deng_xihou = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = ZXL_zhang_xueliang ruling_only = yes }} ZXL_zhang_xueliang = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = ZXL_yang_hucheng ruling_only = yes }} ZXL_yang_hucheng = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = NSM_ma_hongkui ruling_only = yes }} NSM_ma_hongkui = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = XSM_ma_bufang ruling_only = yes }} XSM_ma_bufang = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = SKC_liu_wenhui ruling_only = yes }} SKC_liu_wenhui = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = XIA_he_jian ruling_only = yes }} XIA_he_jian = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = SDC_han_fuju ruling_only = yes }} SDC_han_fuju = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = XIA_zhang_zhizhong ruling_only = yes }} XIA_zhang_zhizhong = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = XIA_cheng_qian ruling_only = yes }} XIA_cheng_qian = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = YUT_chen_jitang ruling_only = yes }} YUT_chen_jitang = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = YUT_yu_hanmou ruling_only = yes }} YUT_yu_hanmou = { set_character_flag = KMT_current_country_leader }}
		#if = { limit = { has_country_leader = { character = CHI_chiang_kaishek ruling_only = yes }} CHI_chiang_kaishek = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = CHI_feng_yuxiang ruling_only = yes }} CHI_feng_yuxiang = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = CHI_he_yingqin ruling_only = yes }} CHI_he_yingqin = { set_character_flag = KMT_current_country_leader }}
		random_character = { 
			limit = { has_character_flag = KMT_current_country_leader }
			add_country_leader_role = {
				country_leader = {
					ideology = fascism_ideology
					expire = "1965.1.1"
					traits = {}
				}
				promote_leader = yes
			}
		}
		every_character = { clr_character_flag = KMT_current_country_leader } 
	}
}

KMT_warlord_move_leader_to_democratic = {
	if = {
		limit = { NOT = { has_government = democratic }}
		if = { limit = { has_country_leader = { character = GXC_li_zongren ruling_only = yes }} GXC_li_zongren = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = SHX_yan_xishan ruling_only = yes }} SHX_yan_xishan = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = PGR_song_zheyuan ruling_only = yes }} PGR_song_zheyuan = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = YUN_long_yun ruling_only = yes }} YUN_long_yun = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = QIA_wang_jialie ruling_only = yes }} QIA_wang_jialie = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = MEN_prince_demchugdongrub ruling_only = yes }} MEN_prince_demchugdongrub = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = SCC_liu_xiang ruling_only = yes }} SCC_liu_xiang = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = SCC_deng_xihou ruling_only = yes }} SCC_deng_xihou = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = ZXL_zhang_xueliang ruling_only = yes }} ZXL_zhang_xueliang = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = ZXL_yang_hucheng ruling_only = yes }} ZXL_yang_hucheng = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = NSM_ma_hongkui ruling_only = yes }} NSM_ma_hongkui = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = XSM_ma_bufang ruling_only = yes }} XSM_ma_bufang = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = SKC_liu_wenhui ruling_only = yes }} SKC_liu_wenhui = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = XIA_he_jian ruling_only = yes }} XIA_he_jian = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = SDC_han_fuju ruling_only = yes }} SDC_han_fuju = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = XIA_zhang_zhizhong ruling_only = yes }} XIA_zhang_zhizhong = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = XIA_cheng_qian ruling_only = yes }} XIA_cheng_qian = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = YUT_chen_jitang ruling_only = yes }} YUT_chen_jitang = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = YUT_yu_hanmou ruling_only = yes }} YUT_yu_hanmou = { set_character_flag = KMT_current_country_leader }}
		#if = { limit = { has_country_leader = { character = CHI_chiang_kaishek ruling_only = yes }} CHI_chiang_kaishek = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = CHI_feng_yuxiang ruling_only = yes }} CHI_feng_yuxiang = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = CHI_he_yingqin ruling_only = yes }} CHI_he_yingqin = { set_character_flag = KMT_current_country_leader }}
		random_character = { 
			limit = { has_character_flag = KMT_current_country_leader }
			add_country_leader_role = {
				country_leader = {
					ideology = conservatism
					expire = "1965.1.1"
					traits = {}
				}
				promote_leader = yes
			}
		}
		every_character = { clr_character_flag = KMT_current_country_leader } 
	}
}

KMT_warlord_move_leader_to_neutrality = {
	if = {
		limit = { NOT = { has_government = neutrality }}
		if = { limit = { has_country_leader = { character = GXC_li_zongren ruling_only = yes }} GXC_li_zongren = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = SHX_yan_xishan ruling_only = yes }} SHX_yan_xishan = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = PGR_song_zheyuan ruling_only = yes }} PGR_song_zheyuan = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = YUN_long_yun ruling_only = yes }} YUN_long_yun = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = QIA_wang_jialie ruling_only = yes }} QIA_wang_jialie = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = MEN_prince_demchugdongrub ruling_only = yes }} MEN_prince_demchugdongrub = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = SCC_liu_xiang ruling_only = yes }} SCC_liu_xiang = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = SCC_deng_xihou ruling_only = yes }} SCC_deng_xihou = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = ZXL_zhang_xueliang ruling_only = yes }} ZXL_zhang_xueliang = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = ZXL_yang_hucheng ruling_only = yes }} ZXL_yang_hucheng = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = NSM_ma_hongkui ruling_only = yes }} NSM_ma_hongkui = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = XSM_ma_bufang ruling_only = yes }} XSM_ma_bufang = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = SKC_liu_wenhui ruling_only = yes }} SKC_liu_wenhui = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = XIA_he_jian ruling_only = yes }} XIA_he_jian = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = SDC_han_fuju ruling_only = yes }} SDC_han_fuju = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = XIA_zhang_zhizhong ruling_only = yes }} XIA_zhang_zhizhong = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = XIA_cheng_qian ruling_only = yes }} XIA_cheng_qian = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = YUT_chen_jitang ruling_only = yes }} YUT_chen_jitang = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = YUT_yu_hanmou ruling_only = yes }} YUT_yu_hanmou = { set_character_flag = KMT_current_country_leader }}
		#if = { limit = { has_country_leader = { character = CHI_chiang_kaishek ruling_only = yes }} CHI_chiang_kaishek = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = CHI_feng_yuxiang ruling_only = yes }} CHI_feng_yuxiang = { set_character_flag = KMT_current_country_leader }}
		if = { limit = { has_country_leader = { character = CHI_he_yingqin ruling_only = yes }} CHI_he_yingqin = { set_character_flag = KMT_current_country_leader }}
		random_character = { 
			limit = { has_character_flag = KMT_current_country_leader }
			add_country_leader_role = {
				country_leader = {
					ideology = despotism
					expire = "1965.1.1"
					traits = {}
				}
				promote_leader = yes
			}
		}
		every_character = { clr_character_flag = KMT_current_country_leader } 
	}
}

MCK_update_local_bandits_modifier = {
	set_variable = { MCK_local_bandits_compliance_gain = global.MCK_resistance_strength@This }
	multiply_variable = { MCK_local_bandits_compliance_gain = -1 }
	divide_variable = { MCK_local_bandits_compliance_gain = 10000 }
	
	set_variable = { MCK_local_bandits_resistance_target = global.MCK_resistance_strength@This }
	divide_variable = { MCK_local_bandits_resistance_target = 10000 }
	multiply_variable = { MCK_local_bandits_resistance_target = 15 }
	
	set_variable = { MCK_najua_presence_resistance_growth = global.MCK_resistance_strength@This }
	divide_variable = { MCK_najua_presence_resistance_growth = 200 }
	
	set_variable = { MCK_najua_presence_resistance_decay = global.MCK_resistance_strength@This }
	divide_variable = { MCK_najua_presence_resistance_decay = -500 }
	
	set_variable = { MCK_najua_presence_compliance_gain = global.MCK_resistance_strength@This }
	multiply_variable = { MCK_najua_presence_compliance_gain = -5 }
	divide_variable = { MCK_najua_presence_compliance_gain = 10000 }
	
	set_variable = { MCK_najua_presence_resistance_target = global.MCK_resistance_strength@This }
	divide_variable = { MCK_najua_presence_resistance_target = 1000 }
	multiply_variable = { MCK_najua_presence_resistance_target = 3 }
	
	set_variable = { MCK_najua_presence2_resistance_growth = global.MCK_resistance_strength@This }
	divide_variable = { MCK_najua_presence2_resistance_growth = 100 }
	
	set_variable = { MCK_najua_presence2_resistance_decay = global.MCK_resistance_strength@This }
	divide_variable = { MCK_najua_presence2_resistance_decay = -200 }
	
	set_variable = { MCK_najua_presence2_compliance_gain = global.MCK_resistance_strength@This }
	multiply_variable = { MCK_najua_presence2_compliance_gain = -7 }
	divide_variable = { MCK_najua_presence2_compliance_gain = 10000 }
	
	set_variable = { MCK_najua_presence2_resistance_target = global.MCK_resistance_strength@This }
	divide_variable = { MCK_najua_presence2_resistance_target = 1000 }
	multiply_variable = { MCK_najua_presence2_resistance_target = 7 }
}

MCK_change_resistance_strength = {
	custom_effect_tooltip = MCK_resistance_strength_change_tt
	add_to_variable = { global.MCK_resistance_strength@This = MCK_resistance_strength_change }
	clamp_variable = {
		var = global.MCK_resistance_strength@This
		min = 0
		max = 100
	}
	if = {
		limit = { 
			NOT = { check_variable = { global.MCK_resistance_strength@This > 0 }}
			resistance < 5
		}
		if = {
			limit = { has_dynamic_modifier = { modifier = MCK_najua_presence }}
			remove_dynamic_modifier = { modifier = MCK_najua_presence }
		}
		if = {
			limit = { has_dynamic_modifier = { modifier = MCK_najua_presence2 }}
			remove_dynamic_modifier = { modifier = MCK_najua_presence2 }
		}
		if = {
			limit = { has_dynamic_modifier = { modifier = MCK_local_bandits }}
			remove_dynamic_modifier = { modifier = MCK_local_bandits }
		}
		if = {
			limit = { has_resistance = yes }
			cancel_resistance = yes
		}
	}
}

MCK_swap_out_japanese_traits = {
	hidden_effect = {
		MCK_sakuma_ryozo = {
			remove_trait = {
				trait = army_chief_planning_2_mck
				slot = army_chief
			}
			remove_trait = {
				trait = army_chief_planning_2_mck_tfv
				slot = army_chief
			}
			add_trait = {
				trait = army_chief_planning_2
				slot = army_chief
			}
		}
		MCK_ito_seiichi = {
			remove_trait = {
				trait = navy_chief_maneuver_2_mck_tfv
				slot = navy_chief
			}
			remove_trait = {
				trait = navy_chief_maneuver_2_mck
				slot = navy_chief
			}
			add_trait = {
				trait = navy_chief_maneuver_2
				slot = navy_chief
			}
		}
		MCK_noguchi_yujiro = {
			remove_trait = {
				trait = air_chief_reform_2_mck_tfv
				slot = air_chief
			}
			remove_trait = {
				trait = air_chief_reform_2_mck
				slot = air_chief
			}
			add_trait = {
				trait = air_chief_reform_2
				slot = air_chief
			}
		}
		MCK_tanaka_osamu = {
			remove_trait = {
				trait = air_chief_ground_support_2_mck_tfv
				slot = air_chief
			}
			remove_trait = {
				trait = air_chief_ground_support_2_mck
				slot = air_chief
			}
			add_trait = {
				trait = air_chief_ground_support_2
				slot = air_chief
			}
		}
		MCK_kimura_heitaro = {
			remove_trait = {
				trait = army_artillery_2_mck_tfv
				slot = high_command
			}
			remove_trait = {
				trait = army_artillery_2_mck
				slot = high_command
			}
			add_trait = {
				trait = army_artillery_2
				slot = high_command
			}
		}
		MCK_tsuji_masanobu = {
			remove_trait = {
				trait = army_regrouping_2_mck_tfv
				slot = high_command
			}
			remove_trait = {
				trait = army_regrouping_2_mck
				slot = high_command
			}
			add_trait = {
				trait = army_regrouping_2
				slot = high_command
			}
		}
		MCK_doihara_kenji = {
			remove_trait = {
				trait = lawrence_of_manchuria_tfv
				slot = political_advisor
			}
			remove_trait = {
				trait = lawrence_of_manchuria
				slot = political_advisor
			}
			add_trait = {
				trait = lawrence_of_manchuria_kta
				slot = political_advisor
			}
		}
		MCK_yoshisuke_aikawa = {
			remove_trait = {
				trait = captain_of_industry_mck_tfv
				slot = political_advisor
			}
			remove_trait = {
				trait = captain_of_industry_mck
				slot = political_advisor
			}
			add_trait = {
				trait = founder_of_nissan
				slot = political_advisor
			}
		}
		MCK_naoki_hoshino = {
			remove_trait = {
				trait = war_industrialist_mck_tfv
				slot = political_advisor
			}
			remove_trait = {
				trait = war_industrialist_mck
				slot = political_advisor
			}
			add_trait = {
				trait = militaristic_economies
				slot = political_advisor
			}
		}
		MCK_amakasu_masahiko = {
			remove_trait = {
				trait = MCK_head_of_manei_tfv
				slot = political_advisor
			}
			remove_trait = {
				trait = MCK_head_of_manei
				slot = political_advisor
			}
			add_trait = {
				trait = MCK_head_of_state_media
				slot = political_advisor
			}
		}
		MCK_itagaki_seishiro = {
			remove_trait = {
				trait = military_theorist_mck_tfv
				slot = theorist
			}
			remove_trait = {
				trait = military_theorist_mck
				slot = theorist
			}
			add_trait = {
				trait = military_theorist
				slot = theorist
			}
		}
		MCK_kawabata_masaharu = {
			remove_trait = {
				trait = naval_theorist_mck_tfv
				slot = theorist
			}
			remove_trait = {
				trait = naval_theorist_mck
				slot = theorist
			}
			add_trait = {
				trait = naval_theorist
				slot = theorist
			}
		}
	}
}
	
update_reorganised_army_dm = {
	set_temp_variable = { KMT_reorganised_army_num_div = num_divisions }
	subtract_from_temp_variable = { KMT_reorganised_army_num_div = 50 }
	clamp_variable = { 
		var = KMT_reorganised_army_num_div 
		max = 50
		min = 0
	}
	set_temp_variable = { KMT_reorganised_army_stat_reduction = 50 }
	subtract_from_temp_variable = { KMT_reorganised_army_stat_reduction = KMT_reorganised_army_num_div }
	multiply_temp_variable = { KMT_reorganised_army_stat_reduction = 0.02 }
	
	set_temp_variable = { KMT_reorganised_army_att_temp = KMT_reorganised_army_att_base }
	multiply_temp_variable = { KMT_reorganised_army_att_temp = KMT_reorganised_army_stat_reduction }
	set_variable = { KMT_reorganised_army_att = KMT_reorganised_army_att_temp }
	
	set_temp_variable = { KMT_reorganised_army_def_temp = KMT_reorganised_army_def_base }
	multiply_temp_variable = { KMT_reorganised_army_def_temp = KMT_reorganised_army_stat_reduction }
	set_variable = { KMT_reorganised_army_def = KMT_reorganised_army_def_temp }
	
	set_temp_variable = { KMT_reorganised_army_breakthru_temp = KMT_reorganised_army_breakthru_base }
	multiply_temp_variable = { KMT_reorganised_army_breakthru_temp = KMT_reorganised_army_stat_reduction }
	set_variable = { KMT_reorganised_army_breakthru = KMT_reorganised_army_breakthru_temp }
	
	set_temp_variable = { KMT_reorganised_army_org_temp = KMT_reorganised_army_org_base }
	multiply_temp_variable = { KMT_reorganised_army_org_temp = KMT_reorganised_army_stat_reduction }
	set_variable = { KMT_reorganised_army_org = KMT_reorganised_army_org_temp }
	
	set_temp_variable = { KMT_reorganised_army_morale_temp = KMT_reorganised_army_morale_base }
	multiply_temp_variable = { KMT_reorganised_army_morale_temp = KMT_reorganised_army_stat_reduction }
	set_variable = { KMT_reorganised_army_morale = KMT_reorganised_army_morale_temp }
	
	set_temp_variable = { KMT_reorganised_army_reinforce_rate_temp = KMT_reorganised_army_reinforce_rate_base }
	multiply_temp_variable = { KMT_reorganised_army_reinforce_rate_temp = KMT_reorganised_army_stat_reduction }
	set_variable = { KMT_reorganised_army_reinforce_rate = KMT_reorganised_army_reinforce_rate_temp }
	
}

update_reorganised_army_dm_prc = {
	set_temp_variable = { KMT_reorganised_army_num_div = num_divisions }
	subtract_from_temp_variable = { KMT_reorganised_army_num_div = 10 }
	clamp_variable = { 
		var = KMT_reorganised_army_num_div 
		max = 10
		min = 0
	}
	set_temp_variable = { KMT_reorganised_army_stat_reduction = 10 }
	subtract_from_temp_variable = { KMT_reorganised_army_stat_reduction = KMT_reorganised_army_num_div }
	multiply_temp_variable = { KMT_reorganised_army_stat_reduction = 0.1 }
	
	set_temp_variable = { KMT_reorganised_army_att_temp = KMT_reorganised_army_att_base }
	multiply_temp_variable = { KMT_reorganised_army_att_temp = KMT_reorganised_army_stat_reduction }
	set_variable = { KMT_reorganised_army_att = KMT_reorganised_army_att_temp }
	
	set_temp_variable = { KMT_reorganised_army_def_temp = KMT_reorganised_army_def_base }
	multiply_temp_variable = { KMT_reorganised_army_def_temp = KMT_reorganised_army_stat_reduction }
	set_variable = { KMT_reorganised_army_def = KMT_reorganised_army_def_temp }
	
	set_temp_variable = { KMT_reorganised_army_breakthru_temp = KMT_reorganised_army_breakthru_base }
	multiply_temp_variable = { KMT_reorganised_army_breakthru_temp = KMT_reorganised_army_stat_reduction }
	set_variable = { KMT_reorganised_army_breakthru = KMT_reorganised_army_breakthru_temp }
	
	set_temp_variable = { KMT_reorganised_army_org_temp = KMT_reorganised_army_org_base }
	multiply_temp_variable = { KMT_reorganised_army_org_temp = KMT_reorganised_army_stat_reduction }
	set_variable = { KMT_reorganised_army_org = KMT_reorganised_army_org_temp }
	
	set_temp_variable = { KMT_reorganised_army_morale_temp = KMT_reorganised_army_morale_base }
	multiply_temp_variable = { KMT_reorganised_army_morale_temp = KMT_reorganised_army_stat_reduction }
	set_variable = { KMT_reorganised_army_morale = KMT_reorganised_army_morale_temp }
	
	set_temp_variable = { KMT_reorganised_army_reinforce_rate_temp = KMT_reorganised_army_reinforce_rate_base }
	multiply_temp_variable = { KMT_reorganised_army_reinforce_rate_temp = KMT_reorganised_army_stat_reduction }
	set_variable = { KMT_reorganised_army_reinforce_rate = KMT_reorganised_army_reinforce_rate_temp }
	
}