ICE_referendum_gui_container = {
ICE_independence_referendum = {
        allowed = { tag = ICE }

        icon = GFX_decision_revolt
        is_good = no
        fire_only_once = yes

        cancel_trigger = {

        }

        available = {
            hidden_trigger = { always = no }
        }

        days_mission_timeout = 140

        activation = {
           has_country_flag = activate_icelandndependence_decision_category
        }
        timeout_effect = {
            country_event = iceland_events.28
        }
    } 
	ICE_improve_coastal_infrastructure = {
		allowed = { tag = ICE }

		icon = GFX_decision_generic_merge_plant_ship

		visible = {
            has_completed_focus = ICE_utilize_politics
        }
		available = {
			has_completed_focus = ICE_utilize_politics
			check_variable = { ref_ice < 100 }
		}

		complete_effect = {
            random_owned_state = {
                 add_building_construction = { type = infrastructure level = 2 instant_build = yes }
            }
		}
		cost = 50

		days_remove = 35

		fire_only_once = yes

		add_to_variable = {
 	     var = ref_ice
  	     value = 10
  	     tooltip = add_10_to_ICE
        }

  	    hidden_effect = {
  	    add_to_variable = {
   	     var = ref_den
   	     value = -10
        }
        }

    }
	ICE_sway_non_voters = {
		allowed = { tag = ICE }

		icon = GFX_decision_generic_speech

		visible = {
            has_completed_focus = ICE_utilize_politics
        }
		available = {
			has_completed_focus = ICE_utilize_politics
			check_variable = { ref_ice < 100 } 
		}
		cost = 20

		days_remove = 10

		fire_only_once = yes

		add_to_variable = {
 	     var = ref_ice
  	     value = 5
  	     tooltip = add_5_to_ICE
        }
    }

}


#Economic Policy
economy_decisions = {

	#Drilling for oil around Iceland
	ICE_drilling_for_oil_off_shore  = { 
		
		icon = oil

		allowed = {
			tag = ICE
		}

		highlight_states = { 
			highlight_state_targets = {
				state = 100 
			}
		}

		available = {
			has_tech = excavation1
			has_tech = excavation2
			num_of_civilian_factories_available_for_projects > 1
			100 = {
				is_owned_and_controlled_by = ROOT
				NOT = { has_state_flag = no_more_oil_flag }
			}
			has_completed_focus = ICE_off_shore_oil_drilling 
		}

		visible = { 
			100 = {
				is_owned_and_controlled_by = ROOT
				NOT = { has_state_flag = no_more_oil_flag }
			}
			has_completed_focus = ICE_off_shore_oil_drilling 
		}

		fire_only_once = no

		cost = ICE_black_gold_cost

		days_remove = 90

		#days_re_enable = 180

		modifier = { 
		    civilian_factory_use = 2
		}

        ai_will_do = {
			base = 0.3
			modifier = {  # Too low PP
				factor = 0.5
				has_political_power < 80
			}
			modifier = { #We have plenty of PP, avanti!
				factor = 3
				has_political_power > 200
			}
			modifier = { #Running out of the stuff, need more!
				factor = 5
				has_resources_in_country = {
					resource = oil
					amount < 1
				}
			}
			modifier = {
				factor = 0
				is_historical_focus_on = yes
				check_variable = { ICE_black_gold_runs_dry_chance > 20 } #Chill out on historical pls AI
			}
			modifier = {
				add = 500 
				is_historical_focus_on = no #Because why not
			}
		}
		fixed_random_seed = no 
		remove_effect = {
			random_list = {
				ICE_black_gold_success_chance = {
					100 = {
						add_resource = {
							type = oil
							amount = 4
						}
					}
				}
				ICE_black_gold_success_chance = {
					100 = {
						add_resource = {
							type = oil
							amount = 2
						}
					}
				}
				ICE_black_gold_runs_dry_chance = {
					100 = {
						add_resource = {
							type = oil
							amount = 8
						}
						custom_effect_tooltip = no_more_oil_tt
						set_state_flag = no_more_oil_flag
					}
					country_event = {
						id = iceland_events.26
						hours = 0
					}	
				}
			}  
			add_to_variable = { ICE_black_gold_cost = 30 }
			if = {
				limit = { check_variable = { ICE_black_gold_runs_dry_chance < 45 } }
				add_to_variable = { ICE_black_gold_runs_dry_chance = 5 }
				subtract_from_variable = { ICE_black_gold_success_chance = 2.5 }
			}			
        }
	}
}

ICE_infiltrate_the_british_isles_category = {
	ICE_incite_communist_uprising_scotland = {
		icon = GFX_decision_generic_ignite_civil_war
		fire_only_once = yes
		available = {
			custom_trigger_tooltip = {
				tooltip = ICE_uprising_scotland_tt
				121 = { owner = { communism > ICE.communism_support_needed } }
			}	
			SCO = {	exists = no }		
			ENG = {
				NOT = {
					has_government = communism
				}
			}
		}
	
		visible = {
			SCO = {	exists = no }
			ENG = {
				NOT = {
					has_government = communism
				}
			}
		}
		
		cost = 50

		complete_effect = {
			custom_effect_tooltip = ICE_incite_communist_uprising_scotland_tt
			hidden_effect = {
				set_country_flag = achivement_started_uprising_scotland
				# Set targets for independence wargoal
				every_other_country = {
					limit = {
						any_owned_state = {
							is_core_of = SCO
						}
					}
					add_to_array = { ICE.scottish_uprising_enemies = THIS }
				}
				SCO = { transfer_state = 121 }
				for_each_scope_loop = {
					array = ICE.scottish_uprising_enemies
					SCO = {
						declare_war_on = {
							target = PREV
							type = independence_wargoal
						}
					}
					121 = {
						teleport_armies = { 
							# just teleport everyone home
						}
					}
				}
				SCO = {
					division_template = {
						name = "Workers' Militias"
						is_locked = no
						regiments = {
							infantry = { x = 0 y = 0 }
							infantry = { x = 0 y = 1 }
							infantry = { x = 0 y = 2 }							
						}
						support = {
							
						}
					}
					121 = {
						create_unit = {
							division = "name = \"Workers' Militia\" division_template = \"Workers' Militias\" start_experience_factor = 0.1 start_equipment_factor = 1 start_manpower_factor = 1"
							owner = SCO
							allow_spawning_on_enemy_provs = yes 
							count = 1 
						}
					}
					add_popularity = {
						ideology = communism
						popularity = 0.25
					}
					set_politics = {
						ruling_party = communism
						elections_allowed = no
					}
				}
			}	
		}

		ai_will_do = {
			base = 0
			modifier = {
				add = 100
				has_war_support > 0.25
			}
			modifier = {
				add = 100 
				has_government = communism
			}
		}
	}
	ICE_incite_communist_uprising_wales = {
		icon = GFX_decision_generic_ignite_civil_war
		fire_only_once = yes
		available = {
			custom_trigger_tooltip = {
				tooltip = ICE_uprising_wales_tt
				122 = { owner = { communism > ICE.communism_support_needed } }
			}	
			WLS = {	exists = no }		
			ENG = {
				NOT = {
					has_government = communism
				}
			}
		}
	
		visible = {
			WLS = {	exists = no }
			ENG = {
				NOT = {
					has_government = communism
				}
			}
		}
		
		cost = 50

		complete_effect = {
			
			custom_effect_tooltip = ICE_incite_communist_uprising_wales_tt
			hidden_effect = {
				set_country_flag = achivement_started_uprising_wales
				# Set targets for independence wargoal
				every_other_country = {
					limit = {
						any_owned_state = {
							is_core_of = WLS
						}
					}
					add_to_array = { ICE.welsh_uprising_enemies = THIS }
				}
				WLS = { transfer_state = 122 }
				for_each_scope_loop = {
					array = ICE.welsh_uprising_enemies
					WLS = {
						declare_war_on = {
							target = PREV
							type = independence_wargoal
						}
					}
					122 = {
						teleport_armies = { 
							# just teleport everyone home
						}
					}
				}
				WLS = {
					division_template = {
						name = "Workers' Militias"
						is_locked = no
						regiments = {
							infantry = { x = 0 y = 0 }
							infantry = { x = 0 y = 1 }
							infantry = { x = 0 y = 2 }							
						}
						support = {
							
						}
					}
					122 = {
						create_unit = {
							division = "name = \"Workers' Militia\" division_template = \"Workers' Militias\" start_experience_factor = 0.1 start_equipment_factor = 1 start_manpower_factor = 1"
							owner = WLS
							allow_spawning_on_enemy_provs = yes 
							count = 1 
						}
					}
					add_popularity = {
						ideology = communism
						popularity = 0.25
					}
					set_politics = {
						ruling_party = communism
						elections_allowed = no
					}
				}
			}	
		}

		ai_will_do = {
			base = 0
			modifier = {
				add = 100
				has_war_support > 0.25
			}
			modifier = {
				add = 100 
				has_government = communism
			}
		}
	}

	ICE_incite_communist_uprising_ni = {
		icon = GFX_decision_generic_ignite_civil_war
		fire_only_once = yes
		available = {
			custom_trigger_tooltip = {
				tooltip = ICE_uprising_ni_tt
				122 = { owner = { communism > ICE.communism_support_needed } }
			}	
			NIR = {	exists = no }	
			ENG = {
				NOT = {
					has_government = communism
				}
			}	
		}
	
		visible = {
			NIR = {	exists = no }
			ENG = {
				NOT = {
					has_government = communism
				}
			}
		}
		
		cost = 50

		complete_effect = {

			custom_effect_tooltip = ICE_incite_communist_uprising_ni_tt
			hidden_effect = {
				set_country_flag = achivement_started_uprising_northen_ireland
				# Set targets for independence wargoal
				every_other_country = {
					limit = {
						any_owned_state = {
							is_core_of = NIR
						}
					}
					add_to_array = { ICE.ni_uprising_enemies = THIS }
				}
				NIR = { transfer_state = 119 }
				for_each_scope_loop = {
					array = ICE.ni_uprising_enemies
					NIR = {
						declare_war_on = {
							target = PREV
							type = independence_wargoal
						}
					}
					119 = {
						teleport_armies = { 
							# just teleport everyone home
						}
					}
				}
				NIR = {
					division_template = {
						name = "Workers' Militias"
						is_locked = no
						regiments = {
							infantry = { x = 0 y = 0 }
							infantry = { x = 0 y = 1 }
							infantry = { x = 0 y = 2 }							
						}
						support = {
							
						}
					}
					119 = {
						create_unit = {
							division = "name = \"Workers' Militia\" division_template = \"Workers' Militias\" start_experience_factor = 0.1 start_equipment_factor = 1 start_manpower_factor = 1"
							owner = NIR
							allow_spawning_on_enemy_provs = yes 
							count = 1 
						}
					}
					add_popularity = {
						ideology = communism
						popularity = 0.25
					}
					set_politics = {
						ruling_party = communism
						elections_allowed = no
					}
				}
			}	
		}

		ai_will_do = {
			base = 0
			modifier = {
				add = 100
				has_war_support > 0.25
			}
			modifier = {
				add = 100 
				has_government = communism
			}
		}
	}

}